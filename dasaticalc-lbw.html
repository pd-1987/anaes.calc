<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="styles.css">
  <title>DAS ATI Calculator</title>
  <link
    href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700&display=swap"
    rel="stylesheet"
  />
  <link
    href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap"
    rel="stylesheet"
  />
    <title>DAS ATI Topicalisation</title>
    <style>
      header.banner {
        background: linear-gradient(
          to right,
          #b71c1c 0%,
          #8e0000 100%
        );
      }
      .flex-container {
        display: flex;
        flex-wrap: wrap;
        margin: 0 auto 0rem;
        padding: 10px 15px 10px;
   border: 1px solid #ccc;
      border-radius: 10px;
        background-color: #fff;
        row-gap: 0.25rem;      /* vertical space */
    column-gap: 0rem; /* horizontal space */
      }
           /* make full-row items span 100% of the container */
  .flex-item.full-row {
    flex: 0 0 100%;
    max-width: 100%;
    margin: 0px auto 0px;
  }
      .flex-item {
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        flex: 0 0 50%;
        box-sizing: border-box;
        border: none;
        border-radius: 6px;
        padding: 0 0.5rem;     /* 0 on top/bottom, 0.5rem left/right */
        text-align: center;
        margin: 0px auto 3px;
      }
      .flex-item button {
        flex: 1;
    font-size: 16px;
    padding: 10px;
   margin: 5px;
    cursor: pointer;
    border: 1px solid #ccc;
    border-radius: 5px;
    background-color: #f0f0f0;
    transition: background-color 0.2s ease;
      }
      .flex-item button.active {
    background-color: #575757;
    color: white;
  }
      .input-group {
        display: flex;
        align-items: center;
        margin: 0px 0;
         gap: 0.25rem;
      }
      .input-group label {
        font-size: 16px;
        margin: 0;
        font-weight: 400;
        width: auto;
        flex-shrink: 0;
      }
      .input-group input {
        width: 50px;
        padding: 5px;
        font-size: 16px;
        box-sizing: border-box;
        margin: 0px;
      }
      /* Button Groups */
  .button-group {
    display: flex;
    flex-direction: row;
    align-items: center;
    gap: 0.5rem;              /* space between the button, input & bubble */
    flex-direction: row;
    margin: 0.3rem 0;     /* 0.25rem top _and_ bottom, instead of 20px top */
  }
  .button-group button {
    border: 1px solid #ccc;   /* light grey */
    box-sizing: border-box;    /* so padding stays consistent */
    width: 100%;
  }
  button small {
    display: block;
    font-size: 12px;
    color: #555;
    margin-bottom: 0px;
  }
      .results-section {
        display: flex;
        flex-direction: column;
        row-gap: 0.25rem;
        box-sizing: border-box;
        width: 100%;
        max-width: 600px;
        margin: 20px auto 20px;
        padding: 0px 10px;
        background-color: #fff;
      }
      .result {
    font-size: 16px;
    font-weight: 700;
    color: #000;
    margin-top: 0px;
    margin-bottom: 0rem;
    text-align: center;
  }
      .instruction-header {
    margin-top: 15px;
        margin-bottom: 5px;
  }
      .spray-row {
    display: flex;
    justify-content: center;  /* center horizontally */
    align-items: center;      /* center vertically */
    gap: 0.25rem;             /* space between input & text (tweak to taste) */
  }
  
  /* optional: remove any stray margins */
  .spray-row input,
  .spray-row .spray-units {
    margin: 3px 0;
  }
      .result.max-dose {
    /* adjust this value to taste */
    padding-bottom: 0rem;
  }

    </style>
  </head>
  <body>
    <header class="banner">DAS ATI Topicalisation</header>
  
    <div class="flex-container">
      <div class="flex-item">
        <button id="maleButton">Male</button>
      </div>
      <div class="flex-item">
        <button id="femaleButton">Female</button>
      </div>
      <div class="flex-item">
        <div class="input-group">
          <label for="weight">Weight (kg):</label>
          <input type="number" id="weight" min="0">
        </div>
      </div>
      <div class="flex-item">
        <div class="input-group">
          <label for="height">Height (cm):</label>
          <input type="number" id="height" min="0">
        </div>
      </div>
     <!-- two full-width rows -->
    <div class="flex-item full-row">
      <!-- put whatever you need here -->
      <div class="result">
      Lean Body Weight: <span id="leanBodyWeight">0</span>
        <span class="unit">kg</span>
    </div>
      </div>
    <div class="flex-item full-row">
      <!-- another full-width input or content -->
      <div class="result max-dose">
   Max Lidocaine (9 mg/kg): 
        <span id="maxLidoDose">0</span>
        <span class="unit">mg</span>
      </div>
    </div>
  </div>
     
   <div class="instruction-header">
      <u>Topicalise</u>:
    </div>
      <div class="button-group">
      <button id="coPhenylcaineButton">Co-phenylcaine Spray<br><small>If nasal route</small></button>
   <span class="bubble"><span id="coPhenylcaineBubble">125</span> <span class="unit">mg</span></span>
    </div>
    
     <div class="button-group">
      <button id="lidocaineSprayButton">Lidocaine 10%<br><small>20–30 sprays to the oropharynx, tonsillar pillars and tongue base</small></button>
           <input type="number" id="lidocaineInput" value="20" min="0">
      <span class="spray-units" id="sprayUnits">sprays</span>
       <span class="bubble"><span id="lidocaineOutput">200</span> <span class="unit">mg</span></span>
    </div>
      <div class="instruction-header">
      <u>If inadequate</u>:
    </div> 
      <div class="button-group">
      <button id="additionalLidocaineButton">Lidocaine 10%<br><small>Give a further 5 sprays to tongue base</small></button>
      <span class="bubble"><span id="additionalLidocaineBubble">50</span> <span class="unit">mg</span></span>
    </div>
    
      <div class="button-group">
      <button id="lidocaine2Button">Lidocaine 2% 2ml<br><small>Spray as you go: Above vocal cords</small></button>
      <span class="bubble"><span id="lidocaine2Bubble">40</span> <span class="unit">mg</span></span>
    </div>
    
       <div class="button-group">
      <button id="lidocaine2VocalButton">Lidocaine 2% 2ml<br><small>Spray as you go: At vocal cords</small></button>
      <span class="bubble"><span id="lidocaine2VocalBubble">40</span> <span class="unit">mg</span></span>
    </div>
  
      <div class="button-group">
      <button id="lidocaine2BelowButton">Lidocaine 2% 2ml<br><small>Spray as you go: Below vocal cords</small></button>
      <span class="bubble"><span id="lidocaine2BelowBubble">40</span> <span class="unit">mg</span></span>
    </div>
  </div>  
    </div>
   
    <div class="results-section">
      <div class="result">
      Total Dose Given: <span id="doseGiven">0</span>
        <span class="unit">mg</span></div>
        <div class="result">
          Dose Remaining: <span id="doseRemaining">0</span>
            <span class="unit">mg</span>
      </div></div>
  
     <div class="button-container">
      <button type="button" class="reset-btn" onclick="resetForm()">Reset</button>
      <button type="button" class="home-btn" onclick="goHome()">Home</button>
    </div>
  
    <footer>
      <small>
        <p><a href="https://das.uk.com/guidelines/das-guidelines-for-awake-tracheal-intubation-ati-in-adults/#" target="_blank" rel="noopener noreferrer">
          Difficult Airway Society guidelines for awake tracheal intubation (ATI) in adults (2019).</a></p>
      <p>&copy; 2025 #OneTeam Anaesthesia. All rights reserved.</p></small>
    </footer>  
  
    <script>
    // === State variables ===
    let selectedGender = null;
    let coPhenylDose = 0, lidoSprayDose = 0, extraLidoDose = 0;
    let lido2Dose = 0, lido2VocalDose = 0, lido2BelowDose = 0;
  
    // === Element references ===
    const maleBtn        = document.getElementById('maleButton');
    const femaleBtn      = document.getElementById('femaleButton');
    const wtInput        = document.getElementById('weight');
    const htInput        = document.getElementById('height');
    const lbwSpan        = document.getElementById('leanBodyWeight');
    const maxSpan        = document.getElementById('maxLidoDose');
    const givenSpan      = document.getElementById('doseGiven');
    const remSpan        = document.getElementById('doseRemaining');
  
    const coBtn          = document.getElementById('coPhenylcaineButton');
    const coDoseSpan     = document.getElementById('coPhenylcaineBubble');
  
    const lidBtn         = document.getElementById('lidocaineSprayButton');
    const lidInput       = document.getElementById('lidocaineInput');
    const lidDoseSpan    = document.getElementById('lidocaineOutput');
  
    const addBtn         = document.getElementById('additionalLidocaineButton');
    const extraDoseSpan  = document.getElementById('additionalLidocaineBubble');
  
    const l2Btn          = document.getElementById('lidocaine2Button');
    const l2DoseSpan     = document.getElementById('lidocaine2Bubble');
  
    const l2vBtn         = document.getElementById('lidocaine2VocalButton');
    const l2vDoseSpan    = document.getElementById('lidocaine2VocalBubble');
  
    const l2bBtn         = document.getElementById('lidocaine2BelowButton');
    const l2bDoseSpan    = document.getElementById('lidocaine2BelowBubble');
  
    // === Event bindings ===
    maleBtn.addEventListener('click', () => selectGender('male'));
    femaleBtn.addEventListener('click', () => selectGender('female'));
    wtInput.addEventListener('input', calculateAll);
    htInput.addEventListener('input', calculateAll);
  
    coBtn.addEventListener('click', () => toggleDose('co'));
    lidBtn.addEventListener('click', () => toggleDose('spray'));
    lidInput.addEventListener('input', () => { updateLidoSpray(); calculateAll(); });
    addBtn.addEventListener('click', () => toggleDose('extra'));
    l2Btn.addEventListener('click', () => toggleDose('l2'));
    l2vBtn.addEventListener('click', () => toggleDose('l2v'));
    l2bBtn.addEventListener('click', () => toggleDose('l2b'));
    // resetForm() and goHome() are called via inline onclick attributes
  
    // === Functions ===
  
    function selectGender(g) {
      selectedGender = g;
      maleBtn.classList.toggle('active', g === 'male');
      femaleBtn.classList.toggle('active', g === 'female');
      calculateAll();
    }
  
    function calculateAll() {
      const w = parseFloat(wtInput.value) || 0;
      const h = parseFloat(htInput.value) || 0;
      if (!selectedGender || w <= 0 || h <= 0) {
       lbwSpan.textContent = formatValue(0, 1); // → "0"
maxSpan.textContent = formatValue(0, 1); // → "0"
        updateTotal();
        return;
      }
      let lbw = selectedGender === 'male'
        ? 0.407 * w + 0.267 * h - 19.2
        : 0.252 * w + 0.473 * h - 48.3;
        lbw = Math.max(lbw, 0);
// 1) format & display LBW
const formattedLBW = formatValue(lbw, 1);
lbwSpan.textContent = formattedLBW;

// 2) re-parse that displayed LBW and compute max off *exactly* what the user sees
const displayedLBW = parseFloat(formattedLBW) || 0;
// multiply first, then floor to drop any fraction
const maxDose = Math.floor(displayedLBW * 9);
maxSpan.textContent = maxDose;
      updateTotal();
    }
  
    function toggleDose(type) {
      switch (type) {
        case 'co':
          if (coPhenylDose) {
            coPhenylDose = 0;
            coBtn.classList.remove('active');
          } else {
            coPhenylDose = 125;
            coBtn.classList.add('active');
            coDoseSpan.textContent = coPhenylDose;
          }
          break;
  
        case 'spray':
          const sprayVal = (parseFloat(lidInput.value) || 0) * 10;
          if (lidoSprayDose) {
            lidoSprayDose = 0;
            lidBtn.classList.remove('active');
          } else {
            lidoSprayDose = sprayVal;
            lidBtn.classList.add('active');
            lidDoseSpan.textContent = sprayVal;
          }
          break;
  
        case 'extra':
          if (extraLidoDose) {
            extraLidoDose = 0;
            addBtn.classList.remove('active');
          } else {
            extraLidoDose = 50;
            addBtn.classList.add('active');
            extraDoseSpan.textContent = extraLidoDose;
          }
          break;
  
        case 'l2':
          if (lido2Dose) {
            lido2Dose = 0;
            l2Btn.classList.remove('active');
          } else {
            lido2Dose = 40;
            l2Btn.classList.add('active');
            l2DoseSpan.textContent = lido2Dose;
          }
          break;
  
        case 'l2v':
          if (lido2VocalDose) {
            lido2VocalDose = 0;
            l2vBtn.classList.remove('active');
          } else {
            lido2VocalDose = 40;
            l2vBtn.classList.add('active');
            l2vDoseSpan.textContent = lido2VocalDose;
          }
          break;
  
        case 'l2b':
          if (lido2BelowDose) {
            lido2BelowDose = 0;
            l2bBtn.classList.remove('active');
          } else {
            lido2BelowDose = 40;
            l2bBtn.classList.add('active');
            l2bDoseSpan.textContent = lido2BelowDose;
          }
          break;
      }
      updateTotal();
    }
  
    function updateLidoSpray() {
      const sprays = parseFloat(lidInput.value) || 0;
      const dose   = sprays * 10;
      lidDoseSpan.textContent = dose;
      if (lidBtn.classList.contains('active')) {
        lidoSprayDose = dose;
        updateTotal();
      }
    }
  
    function updateTotal() {
      const total   = coPhenylDose + lidoSprayDose + extraLidoDose
                    + lido2Dose + lido2VocalDose + lido2BelowDose;
      const maxSafe = parseInt(maxSpan.textContent, 10) || 0;
      givenSpan.textContent = total;
      const remain = maxSafe - total;
      remSpan.textContent = remain;
      remSpan.style.color = remain < 0 ? 'darkred' : '';
    }
  
   function resetForm() {
  // --- 1) Zero out all internal dose counters (but NOT gender or demographics) ---
  coPhenylDose = lidoSprayDose = extraLidoDose = 0;
  lido2Dose = lido2VocalDose = lido2BelowDose = 0;

  // --- 2) Clear all the active classes on your dosing buttons ---
  [coBtn, lidBtn, addBtn, l2Btn, l2vBtn, l2bBtn].forEach(b => 
    b.classList.remove('active')
  );

  // --- 3) Reset any dosing inputs/bubbles to their defaults ---
  lidInput.value        = 20;    // sprays back to 20
  lidDoseSpan.textContent    = '200';  // 20 × 10  
  coDoseSpan.textContent     = '125';
  extraDoseSpan.textContent  = '50';
  l2DoseSpan.textContent     = '40';
  l2vDoseSpan.textContent    = '40';
  l2bDoseSpan.textContent    = '40';

  // --- 4) Recalculate totals (uses the existing LBW & max-dose) ---
  updateTotal();
}

      
      function formatValue(num, decimals = 1) {
  // always format to the requested number of decimals
  const str = num.toFixed(decimals);
  // if it ends in “.0” (or “.00”, etc.), strip off the decimal part
  const regex = new RegExp(`\\.0{1,${decimals}}$`);
  return regex.test(str)
    ? parseInt(str, 10).toString()     // “54.0” → “54”
    : str;                            // “54.3” → “54.3”
}
  
    function goHome() {
      window.location.href = 'index.html';
    }
  
    // Initialize on load
    resetForm();
  </script>
  
  
  </body>
  </html>