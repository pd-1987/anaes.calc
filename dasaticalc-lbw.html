<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="styles.css">
  <title>DAS ATI Calculator</title>
  <link
    href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700&display=swap"
    rel="stylesheet"
  />
  <link
    href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap"
    rel="stylesheet"
  />
    <title>DAS ATI Topicalisation</title>
    <style>
      header.banner {
        background: linear-gradient(
          to right,
          #b71c1c 0%,
          #8e0000 100%
        );
      }
      .flex-container {
        display: flex;
        flex-wrap: wrap;
        margin: 0 auto;
        padding: 10px 15px;
        background-color: #fff;
      }
      .flex-item {
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        flex: 0 0 50%;
        box-sizing: border-box;
        border: none;
        border-radius: 6px;
        padding: 0 0.5rem;     /* 0 on top/bottom, 0.5rem left/right */
        text-align: center;
      }
      .flex-item button {
        flex: 1;
    font-size: 16px;
    padding: 10px;
   margin: 5px;
    cursor: pointer;
    border: 1px solid #ccc;
    border-radius: 5px;
    background-color: #f0f0f0;
    transition: background-color 0.2s ease;
      }
      .flex-item button.active {
    background-color: #575757;
    color: white;
  }
      .input-group {
        display: flex;
        align-items: center;
        margin: 0px 0;
      }
      .input-group label {
        font-size: 16px;
        margin: 5px 10px 5px 0;
        font-weight: 700;
        width: auto;
        flex-shrink: 0;
      }
      .input-group input {
        width: 50px;
        padding: 5px;
        font-size: 16px;
        box-sizing: border-box;
        margin: 5px;
      }
      /* Button Groups */
  .button-group {
    display: flex;
    flex-direction: row;
    align-items: center;
    gap: 0.5rem;              /* space between the button, input & bubble */
    flex-direction: row;
    margin: 0.3rem 0;     /* 0.25rem top _and_ bottom, instead of 20px top */
  }
  .button-group button {
    border: 1px solid #ccc;   /* light grey */
    box-sizing: border-box;    /* so padding stays consistent */
    width: 100%;
  }
  button small {
    display: block;
    font-size: 12px;
    color: #555;
    margin-bottom: 0px;
  }
    </style>
  </head>
  <body>
    <header class="banner">DAS ATI Topicalisation</header>
  
    <div class="flex-container">
      <div class="flex-item">
        <button id="maleButton">Male</button>
      </div>
      <div class="flex-item">
        <button id="femaleButton">Female</button>
      </div>
      <div class="flex-item">
        <div class="input-group">
          <label for="weight">Weight (kg):</label>
          <input type="number" id="weight" min="0">
        </div>
      </div>
      <div class="flex-item">
        <div class="input-group">
          <label for="height">Height (cm):</label>
          <input type="number" id="height" min="0">
        </div>
      </div>
    </div>
  
    <div class="result">
      <u>Lean Body Weight</u>: <span id="leanBodyWeight">0.0</span>
        <span class="unit">kg</span>
      <p><u>Max Safe Lidocaine Dose (9 mg/kg)</u>: <span id="maxLidoDose">0</span> mg</p>
    </div>
  
    <!-- Drug/dose buttons -->
    <div class="button-group">
      <button id="coPhenylcaineButton">Co-phenylcaine Spray<br><small>If nasal route</small></button>
    <span class="bubble" id="coPhenylcaineBubble">125 mg</span>
    </div>
    <div class="button-group">
      <button id="lidocaineSprayButton">Lidocaine 10%<br><small>20â€“30 sprays to the oropharynx, tonsillar pillars and tongue base</small></button>
      <input type="number" id="lidocaineInput" value="20" min="0">
      <span class="bubble" id="lidocaineBubble">200 mg</span>
    </div>
     <div class="instruction-header">
      If inadequate:
    </div>
    <div class="button-group">
      <button id="additionalLidocaineButton">Lidocaine 10%<br><small>Give a further 5 sprays to tongue base</small></button>
     <span class="bubble" id="additionalLidocaineBubble">50 mg</span>
    </div>
    <div class="button-group">
      <button id="lidocaine2Button">Lidocaine 2% 2ml<br><small>Spray as you go: Above vocal cords</small></button>
      <span class="bubble" id="lidocaine2Bubble">40 mg</span>
    </div>
    <div class="button-group">
      <button id="lidocaine2VocalButton">Lidocaine 2% 2ml<br><small>Spray as you go: At vocal cords</small></button>
      <span class="bubble" id="lidocaine2VocalBubble">40 mg</span>
    </div>
    <div class="button-group">
      <button id="lidocaine2BelowButton">Lidocaine 2% 2ml<br><small>Spray as you go: Below vocal cords</small></button>
      <span class="bubble" id="lidocaine2BelowBubble">40 mg</span>
    </div>
    
      <div class="result">
      <p><u>Total Dose Given</u>: <span id="doseGiven">0</span> mg</p>
      <p><u>Dose Remaining</u>: <span id="doseRemaining">0</span> mg</p>
    </div>
  
     <div class="button-container">
      <button type="button" class="reset-btn" onclick="resetForm()">Reset</button>
      <button type="button" class="home-btn" onclick="goHome()">Home</button>
    </div>
  
    <footer>
      <small>
        <p><a href="https://das.uk.com/guidelines/das-guidelines-for-awake-tracheal-intubation-ati-in-adults/#" target="_blank" rel="noopener noreferrer">
          Difficult Airway Society guidelines for awake tracheal intubation (ATI) in adults (2019).</a></p>
      <p>&copy; 2025 #OneTeam Anaesthesia. All rights reserved.</p></small>
    </footer>  
  
    <script>
      let selectedGender = null;
      let coPhenylDose = 0, lidoSprayDose = 0, extraLidoDose = 0;
      let lido2Dose = 0, lido2VocalDose = 0, lido2BelowDose = 0;
  
      const maleBtn = document.getElementById('maleButton');
      const femaleBtn = document.getElementById('femaleButton');
      const wtInput = document.getElementById('weight');
      const htInput = document.getElementById('height');
      const lbwSpan = document.getElementById('leanBodyWeight');
      const maxSpan = document.getElementById('maxLidoDose');
      const givenSpan = document.getElementById('doseGiven');
      const remSpan = document.getElementById('doseRemaining');
      const coBtn = document.getElementById('coPhenylcaineButton');
      const coBubble = document.getElementById('coPhenylcaineBubble');
      const lidBtn = document.getElementById('lidocaineSprayButton');
      const lidInput = document.getElementById('lidocaineInput');
      const lidBubble = document.getElementById('lidocaineBubble');
      const addBtn = document.getElementById('additionalLidocaineButton');
      const addBubble = document.getElementById('additionalLidocaineBubble');
      const l2Btn = document.getElementById('lidocaine2Button');
      const l2Bubble = document.getElementById('lidocaine2Bubble');
      const l2vBtn = document.getElementById('lidocaine2VocalButton');
      const l2vBubble = document.getElementById('lidocaine2VocalBubble');
      const l2bBtn = document.getElementById('lidocaine2BelowButton');
      const l2bBubble = document.getElementById('lidocaine2BelowBubble');
      const resetBtn = document.getElementById('resetBtn');
  
      // Bind events
      maleBtn.addEventListener('click', () => selectGender('male'));
      femaleBtn.addEventListener('click', () => selectGender('female'));
      wtInput.addEventListener('input', calculateAll);
      htInput.addEventListener('input', calculateAll);
      coBtn.addEventListener('click', () => toggleDose('co'));
      lidBtn.addEventListener('click', () => toggleDose('spray'));
      lidInput.addEventListener('input', () => { updateLidoSpray(); calculateAll(); });
      addBtn.addEventListener('click', () => toggleDose('extra'));
      l2Btn.addEventListener('click', () => toggleDose('l2'));
      l2vBtn.addEventListener('click', () => toggleDose('l2v'));
      l2bBtn.addEventListener('click', () => toggleDose('l2b'));
      resetBtn.addEventListener('click', resetForm);
  
      function selectGender(g) {
        selectedGender = g;
        maleBtn.classList.toggle('active', g === 'male');
        femaleBtn.classList.toggle('active', g === 'female');
        calculateAll();
      }
  
      function calculateAll() {
        const w = parseFloat(wtInput.value) || 0;
        const h = parseFloat(htInput.value) || 0;
        if (!selectedGender || w <= 0 || h <= 0) {
          lbwSpan.textContent = '0.0'; maxSpan.textContent = '0'; updateTotal(); return;
        }
        let lbw = selectedGender === 'male'
          ? 0.407 * w + 0.267 * h - 19.2
          : 0.252 * w + 0.473 * h - 48.3;
        lbw = Math.max(lbw, 0);
        lbwSpan.textContent = lbw.toFixed(1);
        maxSpan.textContent = (lbw * 9).toFixed(1);
        updateTotal();
      }
  
      function toggleDose(type) {
        switch (type) {
          case 'co':
            coPhenylDose = coPhenylDose ? 0 : 125;
            coBtn.classList.toggle('active', coPhenylDose > 0);
            coBubble.textContent = coPhenylDose + ' mg';
            break;
          case 'spray':
            lidoSprayDose = lidoSprayDose ? 0 : (parseFloat(lidInput.value) || 0) * 10;
            lidBtn.classList.toggle('active', lidoSprayDose > 0);
            lidBubble.textContent = lidoSprayDose + ' mg';
            break;
          case 'extra':
            extraLidoDose = extraLidoDose ? 0 : 50;
            addBtn.classList.toggle('active', extraLidoDose > 0);
            addBubble.textContent = extraLidoDose + ' mg';
            break;
          case 'l2':
            lido2Dose = lido2Dose ? 0 : 40;
            l2Btn.classList.toggle('active', lido2Dose > 0);
            l2Bubble.textContent = lido2Dose + ' mg';
            break;
          case 'l2v':
            lido2VocalDose = lido2VocalDose ? 0 : 40;
            l2vBtn.classList.toggle('active', lido2VocalDose > 0);
            l2vBubble.textContent = lido2VocalDose + ' mg';
            break;
          case 'l2b':
            lido2BelowDose = lido2BelowDose ? 0 : 40;
            l2bBtn.classList.toggle('active', lido2BelowDose > 0);
            l2bBubble.textContent = lido2BelowDose + ' mg';
            break;
        }
        updateTotal();
      }
  
  function updateLidoSpray() {
    // compute the new dose
    const sprays = parseFloat(lidInput.value) || 0;
    const dose   = sprays * 10;
  
    // always update the blue bubble
    lidBubble.textContent = dose + ' mg';
  
    // if the spray-button is toggled on, update your total
    if (lidBtn.classList.contains('active')) {
      lidoSprayDose = dose;
      updateTotal();
    }
  }
  
      function updateTotal() {
        const total = coPhenylDose + lidoSprayDose + extraLidoDose + lido2Dose + lido2VocalDose + lido2BelowDose;
        const maxSafe = parseInt(maxSpan.textContent) || 0;
        givenSpan.textContent = total;
        const remain = maxSafe - total;
        remSpan.textContent = remain;
        remSpan.style.color = remain < 0 ? 'darkred' : '';
      }
  
      function resetForm() {
        selectedGender = null;
        maleBtn.classList.remove('active'); femaleBtn.classList.remove('active');
        wtInput.value = ''; htInput.value = '';
        lbwSpan.textContent = '0.0'; maxSpan.textContent = '0';
        coPhenylDose = lidoSprayDose = extraLidoDose = 0;
        lido2Dose = lido2VocalDose = lido2BelowDose = 0;
        [coBtn, lidBtn, addBtn, l2Btn, l2vBtn, l2bBtn].forEach(b => b.classList.remove('active'));
         coBubble.textContent  = '125 mg';
    lidBubble.textContent = (parseFloat(lidInput.value)||20) * 10 + ' mg'; // default spray
    addBubble.textContent = '50 mg';
    l2Bubble.textContent  = '40 mg';
    l2vBubble.textContent = '40 mg';
    l2bBubble.textContent = '40 mg';
        updateTotal();
      }
  
      // Initialize on load
      resetForm();
      
       function goHome() {
        window.location.href = "index.html";
      }
    </script>
  </body>
  </html>