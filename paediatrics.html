<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Paediatric anaesthetic calculator</title>
  <link rel="stylesheet" href="styles.css" />
  <link
    href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700&display=swap"
    rel="stylesheet"
  />
  <link
    href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap"
    rel="stylesheet"
  />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <style>
    header.banner {
      background: linear-gradient(130deg, #E38BA3 0%, #B94874 100%);
    }
    .unit-toggle, .estimate-btn {
      font-size: 16px;
      margin: 5px;
      padding: 4px 8px;
      cursor: pointer;
    }
    .estimate-btn {
      background: #f0f0f0;
      border: 1px solid #ccc;
      border-radius: 5px;
      width: 80px;
    }
    .unit-toggle {
      width: 80px;
    }
    /* new styles for the calculation display */
    #weight-calculations {
      margin: 8px 5px;
      font-family: inherit;
      line-height: 1.4;
      font-size: 12px;
    }
    #weight-calculations p {
      margin: 2px 0;
    }
    .unit {
      font-weight: 400;
      color: #000;
    }
    .normal-values {
  font-family: inherit;
      margin: 0 auto 20px auto;
      padding: 15px;
      border: 1px solid #ccc;
      border-radius: 10px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      background-color: #fff;
      box-sizing: border-box;
}
     .airway-section {
  font-family: inherit;
      margin: 0 auto 20px auto;
      padding: 15px;
      border: 1px solid #ccc;
      border-radius: 10px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      background-color: #fff;
      box-sizing: border-box;
}
    .emergency-section {
  font-family: inherit;
      margin: 0 auto 20px auto;
      padding: 15px;
      border: 1px solid #ccc;
      border-radius: 10px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      background-color: #fff;
      box-sizing: border-box;
}
    .section {
      margin: 0 auto 16px auto;
      padding: 10px;
      border: 1px solid #FFB6C1;
      border-radius: 10px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      box-sizing: border-box;
      background: linear-gradient(to right, #fff5f7, #ffeef2);
    }
      .section-header {
      font-weight: 700;
        text-align: center;
        margin: 0 0 10px;
    }
    .normal-values .static {
  display: none;
}
.result {
  font-size: 16px;
  font-weight: 400;
  color: #000;
  margin: 5px;
}
    .normal-values .result:first-child {
  margin-top: 0;
}
    .input-group {
  display: flex;
  align-items: center;
  margin: 5px;
}
.accordion {
    font-family: 'Roboto', sans-serif;
    max-width: 600px;
    margin: 0px auto;
  }
  .accordion-item {
    margin-bottom: 16px;
    border: 1px solid #FFB6C1;
    border-radius: 12px;
    background: linear-gradient(to right, #fff5f7, #ffeef2);
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
    overflow: hidden;
  }
  .accordion-header {
    background: transparent;
    color: #000;
    padding: 16px 18px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    cursor: pointer;
    font-weight: 700;
    font-size: 1.05em;
    transition: background 0.3s ease;
  }
  .accordion-header.active {
    background:rgba(214, 101, 140, 0.15);
  }
  .accordion-title {
    display: flex;
    align-items: center;
    gap: 10px;
  }
  .accordion-title i:first-child {
    color: #E37383;
    font-size: 1.2em;
  }
  .accordion-header .fa-plus,
  .accordion-header .fa-minus {
    color: #E37383;
    transition: opacity 0.3s ease;
  }
  .accordion-header .fa-minus {
    display: none;
  }
  .accordion-header.active .fa-plus {
    display: none;
  }
  .accordion-header.active .fa-minus {
    display: inline;
  }
  .accordion-content {
    max-height: 0;
    opacity: 0;
    overflow: hidden;
    background: #fffaf5;
    transition: max-height 0.4s ease, opacity 0.3s ease;
    font-size: 0.95em;
    color: #000;
    padding: 0 18px;
  }
  .accordion-content-inner {
    padding: 16px 0;
  }
  .accordion-content.show {
    opacity: 1;
  }
    .airway-note {
  margin: 4px 0 8px 5px;
  font-size: 12px;
  font-style: italic;
  color: #444;
}
.estimate-toggle {
  display: inline-flex;
  align-items: center;
  cursor: pointer;
  user-select: none;
  margin: 5px;             /* adjust spacing as needed */
}

/* Hide the native checkbox */
.estimate-toggle input[type="checkbox"] {
  opacity: 0;
  width: 0;
  height: 0;
  position: absolute;
}

/* The track + the round knob together live in this span */
.estimate-toggle .slider {
  position: relative;
  width: 40px;    /* total width of the switch */
  height: 20px;   /* total height of the switch */
  background-color: #ccc;
  border-radius: 10px;
  transition: background-color 0.2s ease;
  margin-right: 0px;  /* spacing between switch and text */
  flex-shrink: 0;
}

/* The white circular knob inside the track */
.estimate-toggle .slider::before {
  content: "";
  position: absolute;
  top: 2px;
  left: 2px;
  width: 16px;
  height: 16px;
  background-color: white;
  border-radius: 50%;
  transition: transform 0.2s ease;
}

/* When the checkbox is checked, turn track green */
.estimate-toggle input:checked + .slider {
  background-color: #4caf50;
}

/* When checked, move the knob to the right */
.estimate-toggle input:checked + .slider::before {
  transform: translateX(20px);
}

/* The visible text next to the slider */
.estimate-toggle .toggle-label {
  font-size: 14px;
  color: #000;
   margin-left: -8px;
}
    #weight {
  margin-right: 12px;
}
    .result table {
      font-size:12px;
    }
    .reversal-text {
  background-color: #fff;      /* text on solid white so it’s readable */
  padding: 0px 6px;
}
  </style>
</head>
<body>
  <header class="banner">Paediatric anaesthesia</header>
  <div class="section">
  <div class="input-group">
    <label for="age">Age:</label>
    <input type="number" id="age" min="0" placeholder="0" />
    <button class="unit-toggle" id="AgeUnitBtn">years</button>
  </div>
  
  <div class="input-group">
  <label for="weight">Weight (kg):</label>
  <input type="number" id="weight" min="0" placeholder="0" />
     <label class="estimate-toggle">
    <input type="checkbox" id="EstimateToggle" checked>
    <span class="slider"></span>
    <span class="toggle-label">Estimate weight</span>
  </label>
</div>

  <!-- new container for showing the two formula lines -->
  <div id="weight-calculations"></div>
    <p style="text-align: center;">
      <small>In Obesity, use <a href="https://www.paedspro.com/">Paeds Prescribing Pro Drug Calculator.</a></small>
      </p>
  </div>
    
  <div class="accordion">

  <div class="accordion-item">

    <div class="accordion-header">

      <span class="accordion-title">

        <i class="fa-solid fa-heart-pulse"></i> Normal Physiological Values

      </span>

      <span>

        <i class="fas fa-plus"></i>

        <i class="fas fa-minus"></i>

      </span>

    </div>

    <div class="accordion-content">

      <div class="accordion-content-inner">

 <table style="width:100%; border-collapse: collapse; font-size: 14px;">
  <tr>
    <td style="border: 1px solid #ccc; padding: 8px;"><strong>SBP</strong></td>
    <td style="border: 1px solid #ccc; padding: 8px;">
      <span id="sbp-50"></span>
      <span class="static unit"> mmHg</span>
      (<span id="sbp-5"></span>–<span id="sbp-95"></span><span class="static unit"> mmHg</span>)<sup>*</sup>
    </td>
  </tr>
  <tr>
    <td style="border: 1px solid #ccc; padding: 8px;"><strong>HR</strong></td>
    <td style="border: 1px solid #ccc; padding: 8px;">
      <span id="hr-5"></span>–<span id="hr-95"></span>
      <span class="static unit"> bpm</span><sup>†</sup>
    </td>
  </tr>
  <tr>
    <td style="border: 1px solid #ccc; padding: 8px;"><strong>RR</strong></td>
    <td style="border: 1px solid #ccc; padding: 8px;">
      <span id="rr-5"></span>–<span id="rr-95"></span>
      <span class="static unit"> bpm</span><sup>†</sup>
    </td>
  </tr>
</table>

        <small><sup>*</sup>50th centile (5th – 95th)<br><sup>†</sup>5th – 95th centile</small>
      </div>
      </div>
    </div>
  
  <div class="accordion-item">

    <div class="accordion-header">

      <span class="accordion-title">

        <i class="fa-solid fa-mask-ventilator"></i> Airway and Ventilation

      </span>

      <span>

        <i class="fas fa-plus"></i>

        <i class="fas fa-minus"></i>

      </span>

    </div>

    <div class="accordion-content">

      <div class="accordion-content-inner">
<div class="result">
  <table style="width:100%; border-collapse: collapse; font-size: 14px;">
    <thead>
      <tr>
        <th colspan="2" style="border:1px solid #ccc; padding:8px;">
          Endotracheal tube (ETT)
        </th>
      </tr>
    </thead>
    <tbody>
           <tr>
        <th style="border:1px solid #ccc; padding:8px; text-align:center;">Laryngoscope</th>
        <td style="border:1px solid #ccc; padding:8px; text-align:center;">
          <span id="laryngoscope"></span>
        </td>
      </tr>
      <tr>
        <th style="border:1px solid #ccc; padding:8px; text-align:center;">Cuffed ETT</th>
        <td style="border:1px solid #ccc; padding:8px; text-align:center;">
          <span id="ett-cuffed"></span>
        </td>
      </tr>
      <tr>
        <th style="border:1px solid #ccc; padding:8px; text-align:center;">Uncuffed ETT</th>
        <td style="border:1px solid #ccc; padding:8px; text-align:center;">
          <span id="ett-uncuffed"></span>
        </td>
      </tr>
         <tr>
        <th style="border:1px solid #ccc; padding:8px; text-align:center;">Depth at lips</th>
        <td style="border:1px solid #ccc; padding:8px; text-align:center;">
          <span id="ett-depth-lips"></span>
          <span class="static unit">cm</span>
        </td>
      </tr>
 
    </tbody>
  </table>
</div>  
   <br> 
 <table style="width:100%; border-collapse: collapse; font-size: 14px;">
    <thead>
      <tr>
        <th colspan="2" style="border:1px solid #ccc; padding:8px;">
          Supraglottic airway device (SAD)
        </th>
      </tr>
    </thead>
    <tbody>
           <tr>
        <th style="border:1px solid #ccc; padding:8px; text-align:center;">LMA</th>
        <td style="border:1px solid #ccc; padding:8px; text-align:center;">
          <span id="lma"></span>
        </td>
      </tr>
      <tr>
        <th style="border:1px solid #ccc; padding:8px; text-align:center;">i-Gel</th>
        <td style="border:1px solid #ccc; padding:8px; text-align:center;">
          <span id="igel"></span>
        </td>
      </tr>
    </tbody>
  </table>        
    <br>
        
         <table style="width:100%; border-collapse: collapse; font-size: 14px;">
    <thead>
      <tr>
        <th colspan="2" style="border:1px solid #ccc; padding:8px;">
         Ventilation
        </th>
      </tr>
    </thead>
    <tbody>
           <tr>
        <th style="border:1px solid #ccc; padding:8px; text-align:center;">Tidal volume (6-8 ml/kg)</th>
        <td style="border:1px solid #ccc; padding:8px; text-align:center;">
          <span id="tidalvolume"></span>
        </td>
      </tr>
      <tr>
        <th style="border:1px solid #ccc; padding:8px; text-align:center;">Neonates/ARDS (4-6 ml/kg)</th>
        <td style="border:1px solid #ccc; padding:8px; text-align:center;">
          <span id="tv-neonates-ards"></span>
        </td>
      </tr>
    </tbody>
  </table>
  </div>
      </div>      
</div>
  
<div class="accordion-item">

    <div class="accordion-header">

      <span class="accordion-title">

        <i class="fas fa-syringe"></i> Emergency Intubation

      </span>

      <span>

        <i class="fas fa-plus"></i>

        <i class="fas fa-minus"></i>

      </span>

    </div>

  <div class="accordion-content">
  <div class="accordion-content-inner">
      <div class="result">
    <table style="width: 100%; border-collapse: collapse;">
  <!-- Fentanyl -->
  <tr style="background-color: #98c9ee;">
    <td style="padding: 8px; border: 1px solid #ccc;">
      <strong>Fentanyl</strong>
    </td>
    <td style="padding: 8px; border: 1px solid #ccc;">
      1–2 mcg/kg
    </td>
    <td style="padding: 8px; border: 1px solid #ccc; text-align: right;">
      <span id="fentanyl"></span><span class="static unit">mcg</span>
    </td>
  </tr>
  <tr style="background-color: #e0effa;">
    <td colspan="3" style="padding: 8px; border: 1px solid #ccc; text-align: center;">
      <small id="fentanyl-vol-extra"></small>
    </td>
  </tr>

  <!-- Ketamine -->
  <tr style="background-color: #ffe733;">
    <td style="padding: 8px; border: 1px solid #ccc;">
      <strong>Ketamine</strong>
    </td>
    <td style="padding: 8px; border: 1px solid #ccc;">
      1–2 mg/kg
    </td>
    <td style="padding: 8px; border: 1px solid #ccc; text-align: right;">
      <span id="ketamine"></span><span class="static unit">mg</span>
    </td>
  </tr>
  <tr style="background-color: #fff9bf;">
    <td colspan="3" style="padding: 8px; border: 1px solid #ccc; text-align: center;">
      <small id="ketamine-vol-extra"></small>
    </td>
  </tr>

  <!-- Rocuronium -->
  <tr style="background-color: #ec6f73;">
    <td style="padding: 8px; border: 1px solid #ccc;">
      <strong>Rocuronium</strong>
    </td>
    <td style="padding: 8px; border: 1px solid #ccc;">
      1 mg/kg
    </td>
    <td style="padding: 8px; border: 1px solid #ccc; text-align: right;">
      <span id="rocuronium"></span><span class="static unit">mg</span>
    </td>
  </tr>
  <tr style="background-color: #f8d5d5;">
    <td colspan="3" style="padding: 8px; border: 1px solid #ccc; text-align: center;">
      <small id="rocuronium-vol-extra"></small>
    </td>
  </tr>
</table>

<br>

<table style="width: 100%; border-collapse: collapse;">
  <!-- Atropine -->
  <tr style="background-color: #a3ce6f;">
    <td style="padding: 8px; border: 1px solid #ccc;">
      <strong>Atropine</strong>
    </td>
    <td style="padding: 8px; border: 1px solid #ccc;">
      20 mcg/kg
    </td>
    <td style="padding: 8px; border: 1px solid #ccc; text-align: right;">
      <span id="atropine"></span><span class="static unit">mcg</span>
    </td>
  </tr>
  <tr style="background-color: #e3f0d4;">
    <td colspan="3" style="padding: 8px; border: 1px solid #ccc; text-align: center;">
      <small id="atropine-vol-extra"></small>
    </td>
  </tr>

  <!-- Adrenaline IV 1:10,000 -->
  <tr style="background-color: #d3ace5;">
    <td style="padding: 8px; border: 1px solid #ccc;">
      <strong>Adrenaline IV 1:10,000</strong>
    </td>
    <td style="padding: 8px; border: 1px solid #ccc;">
      0.1 mL/kg
    </td>
    <td style="padding: 8px; border: 1px solid #ccc; text-align: right;">
      <span id="adrenalineiv"></span><span class="static unit">mL</span>
    </td>
  </tr>
  <tr style="background-color: #f2e6f7;">
    <td colspan="3" style="padding: 8px; border: 1px solid #ccc; text-align: center;">
      <small id="adrenalineiv-vol-extra"></small>
    </td>
  </tr>
</table>

<br>

<table style="width: 100%; border-collapse: collapse;">
  <!-- Suxamethonium IV -->
  <tr style="background-color: #ec6f73;">
    <td style="padding: 8px; border: 1px solid #ccc;">
      <strong>Suxamethonium IV</strong>
    </td>
    <td style="padding: 8px; border: 1px solid #ccc;">
      1–2 mg/kg
    </td>
    <td style="padding: 8px; border: 1px solid #ccc; text-align: right;">
      <span id="sux-iv"></span><span class="static unit">mg</span>
    </td>
  </tr>
  <tr style="background-color: #f8d5d5;">
    <td colspan="3" style="padding: 8px; border: 1px solid #ccc; text-align: center;">
      <small id="sux-iv-vol-extra"></small>
    </td>
  </tr>

  <!-- Suxamethonium IM -->
  <tr style="background-color: #ec6f73;">
    <td style="padding: 8px; border: 1px solid #ccc;">
      <strong>Suxamethonium IM</strong>
    </td>
    <td style="padding: 8px; border: 1px solid #ccc;">
      4 mg/kg<br>(Max 150 mg)
    </td>
    <td style="padding: 8px; border: 1px solid #ccc; text-align: right;">
      <span id="sux-im"></span><span class="static unit">mg</span>
    </td>
  </tr>
  <tr style="background-color: #f8d5d5;">
    <td colspan="3" style="padding: 8px; border: 1px solid #ccc; text-align: center;">
      <small id="sux-im-vol-extra"></small>
    </td>
  </tr>
</table>

<br>

<table style="width: 100%; border-collapse: collapse;">
  <!-- Non‐drug items (single rows) -->
  <tr>
    <td style="padding: 8px; border: 1px solid #ccc; background-color: #bcbdc0;">
      <strong>Fluid bolus</strong>
    </td>
    <td style="padding: 8px; border: 1px solid #ccc; background-color: #e8e6e4;">
      10–20 mL/kg
    </td>
    <td style="padding: 8px; border: 1px solid #ccc; text-align: right; background-color: #e8e6e4;">
      <span id="fluidbolus"></span><span class="static unit">mL</span>
    </td>
  </tr>
  <tr>
    <td style="padding: 8px; border: 1px solid #ccc; background-color: #bcbdc0;">
      <strong>Glucose 10%</strong>
    </td>
    <td style="padding: 8px; border: 1px solid #ccc; background-color: #e8e6e4;">
      2 mL/kg
    </td>
    <td style="padding: 8px; border: 1px solid #ccc; text-align: right; background-color: #e8e6e4;">
      <span id="glucose10"></span><span class="static unit">mL</span>
    </td>
  </tr>
  <tr>
    <td style="padding: 8px; border: 1px solid #ccc; background-color: #bcbdc0;">
      <strong>Defibrillation energy</strong>
    </td>
    <td style="padding: 8px; border: 1px solid #ccc; background-color: #e8e6e4;">
      4 J/kg
    </td>
    <td style="padding: 8px; border: 1px solid #ccc; text-align: right; background-color: #e8e6e4;">
      <span id="defib"></span><span class="static unit">J</span>
    </td>
  </tr>
</table>
  </div>
</div>
    </div>
  </div>
  
    <div class="accordion-item">

    <div class="accordion-header">

      <span class="accordion-title">

        <i class="fas fa-pills"></i> Premedication & Sedation

      </span>

      <span>

        <i class="fas fa-plus"></i>

        <i class="fas fa-minus"></i>

      </span>

    </div>

    <div class="accordion-content">

      <div class="accordion-content-inner general-section">      
 
  <div class="result">
    
    <table style="width: 100%; border-collapse: collapse;">

          <tr style="background-color: #fa770a;">
            <td style="padding: 8px; border: 1px solid #ccc;">
              <strong>Midazolam - PO</strong>
            </td>
            <td style="padding: 8px; border: 1px solid #ccc;">
              0.5 mg/kg
            </td>
            <td style="padding: 8px; border: 1px solid #ccc; text-align: right;">
              <span id="premed-midaz"></span>
              <span class="static unit">mg</span>
            </td>
          </tr>
          <tr style="background-color: #fff3e0;">
            <td colspan="3" style="padding: 8px; border: 1px solid #ccc; text-align: center;">
              <small>Max 20 mg per dose; 6 months - 14 years. Peak effect at 20-30 mins.</small>
            </td>
          </tr>
      
      <tr style="background-color: #fa770a;">
            <td style="padding: 8px; border: 1px solid #ccc;">
              <strong>Midazolam - NAS</strong>
            </td>
            <td style="padding: 8px; border: 1px solid #ccc;">
              0.2 mg/kg
            </td>
            <td style="padding: 8px; border: 1px solid #ccc; text-align: right;">
              <span id="premed-midaz-intranasal"></span>
              <span class="static unit">mg</span>
            </td>
          </tr>
          <tr style="background-color: #fff3e0;">
            <td colspan="3" style="padding: 8px; border: 1px solid #ccc; text-align: center;">
              <small>Max 10 mg. Given via short atomiser: 0.1 ml dead space. Peak effect at 10 mins.</small>
            </td>
          </tr>
      
      <tr style="background-color: #fff;">
            <td style="padding: 8px; border: 1px solid #ccc;">
              <strong>Dexmedetomidine - NAS</strong>
            </td>
            <td style="padding: 8px; border: 1px solid #ccc;">
              2–4 mcg/kg
            </td>
            <td style="padding: 8px; border: 1px solid #ccc; text-align: right;">
              <span id="premed-dexmed"></span>
              <span class="static unit">mcg</span>
            </td>
          </tr>
          <tr style="background-color: #f5f5f5;">
            <td colspan="3" style="padding: 8px; border: 1px solid #ccc; text-align: center;">
              <small>Max 200 mcg per dose. Given 30 mins before intervention.</small>
            </td>
          </tr>
      
      </table>
  </div>
  </div>
    </div>
  </div>
      
    
<div class="accordion-item">

    <div class="accordion-header">

      <span class="accordion-title">

        <i class="fa-solid fa-bed"></i> Routine General Anaesthetic

      </span>

      <span>

        <i class="fas fa-plus"></i>

        <i class="fas fa-minus"></i>

      </span>

    </div>

    <div class="accordion-content">

      <div class="accordion-content-inner general-section">      
 
  <div class="result">
    
    <table style="width: 100%; border-collapse: collapse;">
<thead>
      <tr>
        <th colspan="3" style="border:1px solid #ccc; padding:8px;">
          Induction
        </th>
      </tr>
    </thead>
          <!-- Fentanyl GA -->
          <tr style="background-color: #98c9ee;">
            <td style="padding: 8px; border: 1px solid #ccc;">
              <strong>Fentanyl</strong>
            </td>
            <td style="padding: 8px; border: 1px solid #ccc;">
              1–2 mcg/kg
            </td>
            <td style="padding: 8px; border: 1px solid #ccc; text-align: right;">
              <span id="fentanyl-ga"></span>
              <span class="static unit">mcg</span>
            </td>
          </tr>
          <tr style="background-color: #e0f0ff;">
            <td colspan="3" style="padding: 8px; border: 1px solid #ccc; text-align: center;">
              <small id="fentanyl-ga-extra"></small>
            </td>
          </tr>

          <!-- Propofol GA -->
          <tr style="background-color: #ffe733;">
            <td style="padding: 8px; border: 1px solid #ccc;">
              <strong>Propofol</strong>
            </td>
            <td style="padding: 8px; border: 1px solid #ccc;">
              3–5 mg/kg
            </td>
            <td style="padding: 8px; border: 1px solid #ccc; text-align: right;">
              <span id="propofol"></span>
              <span class="static unit">mg</span>
            </td>
          </tr>
          <tr style="background-color: #fff8cc;">
            <td colspan="3" style="padding: 8px; border: 1px solid #ccc; text-align: center;">
              <small id="propofol-ga-extra"></small>
            </td>
          </tr>

          <!-- Rocuronium GA -->
          <tr style="background-color: #ec6f73;">
            <td style="padding: 8px; border: 1px solid #ccc;">
              <strong>Rocuronium</strong>
            </td>
            <td style="padding: 8px; border: 1px solid #ccc;">
              0.6 mg/kg
            </td>
            <td style="padding: 8px; border: 1px solid #ccc; text-align: right;">
              <span id="rocuronium-ga"></span>
              <span class="static unit">mg</span>
            </td>
          </tr>
          <tr style="background-color: #ffdada;">
            <td colspan="3" style="padding: 8px; border: 1px solid #ccc; text-align: center;">
              <small id="rocuronium-ga-extra"></small>
            </td>
          </tr>
    </table>
<br>
      <table style="width: 100%; border-collapse: collapse;">
        <thead>
      <tr>
        <th colspan="3" style="border:1px solid #ccc; padding:8px;">
          Antiemetics
        </th>
      </tr>
    </thead>  
        <!-- Ondansetron GA -->
          <tr style="background-color: #fdd7a0;">
            <td style="padding: 8px; border: 1px solid #ccc;">
              <strong>Ondansetron</strong>
            </td>
            <td style="padding: 8px; border: 1px solid #ccc;">
              0.15 mg/kg
            </td>
            <td style="padding: 8px; border: 1px solid #ccc; text-align: right;">
              <span id="ondansetron"></span>
              <span class="static unit">mg</span>
            </td>
          </tr>
          <tr style="background-color: #fff3e0;">
            <td colspan="3" style="padding: 8px; border: 1px solid #ccc; text-align: center;">
              <small id="ondansetron-ga-extra"></small>
            </td>
          </tr>

          <!-- Dexamethasone GA -->
          <tr style="background-color: #ffffff;">
            <td style="padding: 8px; border: 1px solid #ccc;">
              <strong>Dexamethasone</strong>
            </td>
            <td style="padding: 8px; border: 1px solid #ccc;">
              0.15 mg/kg
            </td>
            <td style="padding: 8px; border: 1px solid #ccc; text-align: right;">
              <span id="dexamethasone"></span>
              <span class="static unit">mg</span>
            </td>
          </tr>
          <tr style="background-color: #f5f5f5;">
            <td colspan="3" style="padding: 8px; border: 1px solid #ccc; text-align: center;">
              <small id="dexamethasone-ga-extra"></small>
            </td>
          </tr>
        <tr style="background-color: #fdd7a0;">
            <td style="padding: 8px; border: 1px solid #ccc;">
              <strong>Cyclizine</strong>
            </td>
            <td style="padding: 8px; border: 1px solid #ccc;">
              0.5–1 mg/kg
            </td>
            <td style="padding: 8px; border: 1px solid #ccc; text-align: right;">
              <span id="cyclizine"></span>
              <span class="static unit">mg</span>
            </td>
          </tr>
          <tr style="background-color: #fff3e0;">
            <td colspan="3" style="padding: 8px; border: 1px solid #ccc; text-align: center;">
              <small id="cyclizine-ga-extra"></small>
            </td>
          </tr>
    </table>
<br>
        <table style="width: 100%; border-collapse: collapse;">
          <thead>
      <tr>
        <th colspan="3" style="border:1px solid #ccc; padding:8px;">
          Intraoperative analgesia
        </th>
      </tr>
    </thead>
          <tr style="background-color: #ffffff;">
  <td style="padding: 8px; border: 1px solid #ccc;">
    <strong>Paracetamol IV</strong>
  </td>
  <td style="padding: 8px; border: 1px solid #ccc;">
   
  </td>
  <td style="padding: 8px; border: 1px solid #ccc; text-align: right;">
    <span id="paracetamol-iv"></span><span class="static unit">mg</span>
  </td>
</tr>
<tr style="background-color: #f5f5f5;">
  <td colspan="3" style="padding: 8px; border: 1px solid #ccc; text-align: center;">
    <small id="paracetamol-iv-note"></small>
  </td>
</tr>

<!-- Ibuprofen IV -->
<tr style="background-color: #ffffff;">
  <td style="padding: 8px; border: 1px solid #ccc;">
    <strong>Ibuprofen IV</strong>
  </td>
  <td style="padding: 8px; border: 1px solid #ccc;">
   
  </td>
  <td style="padding: 8px; border: 1px solid #ccc; text-align: right;">
    <span id="ibuprofeniv"></span><span class="static unit">mg</span>
  </td>
</tr>
<tr style="background-color: #f5f5f5;">
  <td colspan="3" style="padding: 8px; border: 1px solid #ccc; text-align: center;">
    <small id="ibuprofeniv-note"></small>
  </td>
</tr>
          <!-- Ketorolac -->
<tr style="background-color: #ffffff;">
  <td style="padding: 8px; border: 1px solid #ccc;">
    <strong>Ketorolac</strong>
  </td>
  <td style="padding: 8px; border: 1px solid #ccc;">
    0.5–1 mg/kg
  </td>
  <td style="padding: 8px; border: 1px solid #ccc; text-align: right;">
    <span id="ketorolac"></span><span class="static unit">mg</span>
  </td>
</tr>
<tr style="background-color: #f5f5f5;">
  <td colspan="3" style="padding: 8px; border: 1px solid #ccc; text-align: center;">
    <small id="ketorolac-extra"></small>
  </td>
</tr>
           <!-- Morphine IV -->
<tr style="background-color: #98c9ee;">
  <td style="padding: 8px; border: 1px solid #ccc;">
    <strong>Morphine</strong>
  </td>
  <td style="padding: 8px; border: 1px solid #ccc;">
    0.05–0.1 mg/kg
  </td>
  <td style="padding: 8px; border: 1px solid #ccc; text-align: right;">
    <span id="morphineiv"></span><span class="static unit">mg</span>
  </td>
</tr>
<tr style="background-color: #e0f0ff;">
  <td colspan="3" style="padding: 8px; border: 1px solid #ccc; text-align: center;">
    <small id="morphine-iv-extra"></small>
  </td>
</tr>
    </table>
  
    <br>
    <table style="width: 100%; border-collapse: collapse;">
      <thead>
      <tr>
        <th colspan="3" style="border:1px solid #ccc; padding:8px;">
          Reversal of neuromuscular blockade
        </th>
      </tr>
    </thead>     
       <tr style="background: repeating-linear-gradient(
    135deg,
    #d6658c4d,
    #d6658c4d 8px,
    #fff     1px,
    #fff     16px
  );">
  <td style="padding: 8px; border: 1px solid #ccc;">
      <strong>Neostigmine &<br> Glycopyrulate</strong>
  </td>
  <td style="padding: 8px; border: 1px solid #ccc;">
    
      <span class="neo-dose">0.02 mL/kg</span>
  </td>
  <td style="padding: 8px; border: 1px solid #ccc; text-align: right;">
   <span class="neos-dose"></span><span class="static unit">mg</span>
  </td>
</tr>
<tr style="background-color: #fff5f7;">
  <td colspan="3" style="padding: 8px; border: 1px solid #ccc; text-align: center;">
    <small class="neos-extra"></small>
  </td>
</tr> 
       <tr style="background: repeating-linear-gradient(
    135deg,
    #d6658c4d,
   #d6658c4d 8px,
    #fff     2px,
    #fff     16px
  );">
        <td style="padding: 8px; border: 1px solid #ccc;">
   <strong>Sugammadex</strong>
  </td>
  <td style="padding: 8px; border: 1px solid #ccc;">
    2 mg/kg
  </td>
  <td style="padding: 8px; border: 1px solid #ccc; text-align: right;">
    <span class="sug-2-dose"></span><span class="static unit">mg</span>
  </td>
</tr>
<tr style="background-color: #fff5f7;">
  <td colspan="3" style="padding: 8px; border: 1px solid #ccc; text-align: center;">
    <small class="sug-2-extra"></small>
    <br><small>Moderate block: Return of T<sub>2</sub> in response to TOF.</small>
  </td>
</tr> 
      
      <tr style="background: repeating-linear-gradient(
    135deg,
    #d6658c4d,
    #d6658c4d 8px,
    #fff     2px,
    #fff     16px
  );">
  <td style="padding: 8px; border: 1px solid #ccc;">
   <strong>Sugammadex</strong>
  </td>
  <td style="padding: 8px; border: 1px solid #ccc;">
    4 mg/kg
  </td>
  <td style="padding: 8px; border: 1px solid #ccc; text-align: right;">
    
    <span class="sug-4-dose"></span><span class="static unit">mg</span>
  </td>
</tr>
<tr style="background-color: #fff5f7;">
  <td colspan="3" style="padding: 8px; border: 1px solid #ccc; text-align: center;">
    <small class="sug-4-extra"></small>
    <br><small>Deep block: 1-2 PTCs, no twitch responses to TOF.</small>
  </td>
</tr>
        </table>
    
    <br>
    <table style="width: 100%; border-collapse: collapse;">
      <thead>
      <tr>
        <th colspan="3" style="border:1px solid #ccc; padding:8px;">
          Postoperative analgesia
        </th>
      </tr>
    </thead>     
      <tr style="background-color: #ffffff;">
  <td style="padding: 8px; border: 1px solid #ccc;">
    <strong>Paracetamol PO</strong>
  </td>
  <td style="padding: 8px; border: 1px solid #ccc;">
    Per age/weight
  </td>
  <td style="padding: 8px; border: 1px solid #ccc; text-align: right;">
    <span id="paracetamol-po"></span><span class="static unit">mg</span>
  </td>
</tr>
<tr style="background-color: #f5f5f5;">
  <td colspan="3" style="padding: 8px; border: 1px solid #ccc; text-align: center;">
    <small id="paracetamol-po-note"></small>
  </td>
</tr>
          
<!-- Ibuprofen PO -->
<tr style="background-color: #ffffff;">
  <td style="padding: 8px; border: 1px solid #ccc;">
    <strong>Ibuprofen PO</strong>
  </td>
  <td style="padding: 8px; border: 1px solid #ccc;">
    5–10 mg/kg
  </td>
  <td style="padding: 8px; border: 1px solid #ccc; text-align: right;">
    <span id="ibuprofenpo"></span><span class="static unit">mg</span>
  </td>
</tr>
<tr style="background-color: #f5f5f5;">
  <td colspan="3" style="padding: 8px; border: 1px solid #ccc; text-align: center;">
    <small id="ibuprofenpo-note"></small>
  </td>
</tr>
          
          <!-- Morphine PO -->
<tr style="background-color: #98c9ee;">
  <td style="padding: 8px; border: 1px solid #ccc;">
    <strong>Morphine PO</strong>
  </td>
  <td style="padding: 8px; border: 1px solid #ccc;">
    
  </td>
  <td style="padding: 8px; border: 1px solid #ccc; text-align: right;">
    <span id="morphinepo"></span><span class="static unit">mg</span>
  </td>
</tr>
<tr style="background-color: #e0f0ff;">
            <td colspan="3" style="padding: 8px; border: 1px solid #ccc; text-align: center;">
              <small id="morphine-po-extra"></small>
  </td>
</tr>
    </table>
    <br>
<table style="width: 100%; border-collapse: collapse;">
      <thead>
      <tr>
        <th colspan="3" style="border:1px solid #ccc; padding:8px;">
          Emergency Drugs
        </th>
      </tr>
    </thead>     
      <tr style="background-color: #a3ce6f;">
  <td style="padding: 8px; border: 1px solid #ccc;">
    <strong>Atropine</strong>
  </td>
  <td style="padding: 8px; border: 1px solid #ccc;">
    20 mcg/kg
  </td>
  <td style="padding: 8px; border: 1px solid #ccc; text-align: right;">
    <span class="atropine-dose"></span><span class="static unit">mg</span>
  </td>
</tr>
<tr style="background-color: #e3f0d4;">
  <td colspan="3" style="padding: 8px; border: 1px solid #ccc; text-align: center;">
    <small class="atropine-extra"></small>
  </td>
</tr>
          
<tr style="background-color: #ec6f73;">
  <td style="padding: 8px; border: 1px solid #ccc;">
    <strong>Suxamethonium IV</strong>
  </td>
  <td style="padding: 8px; border: 1px solid #ccc;">
    1-2 mg/kg
  </td>
  <td style="padding: 8px; border: 1px solid #ccc; text-align: right;">
    <span class="sux-iv-dose"></span><span class="static unit">mg</span>
  </td>
</tr>
<tr style="background-color: #ffdada;">
  <td colspan="3" style="padding: 8px; border: 1px solid #ccc; text-align: center;">
    <small class="sux-iv-extra"></small>
  </td>
</tr>
          
<tr style="background-color: #ec6f73;">
  <td style="padding: 8px; border: 1px solid #ccc;">
    <strong>Suxamethonium IM</strong>
  </td>
  <td style="padding: 8px; border: 1px solid #ccc;">
    4 mg/kg<br>(Max 150 mg)
  </td>
  <td style="padding: 8px; border: 1px solid #ccc; text-align: right;">
    <span class="sux-im-dose"></span><span class="static unit">mg</span>
  </td>
</tr>
<tr style="background-color: #ffdada;">
            <td colspan="3" style="padding: 8px; border: 1px solid #ccc; text-align: center;">
              <small class="sux-im-extra"></small>
  </td>
</tr>
    </table>    
    
  </div>
  </div>
    </div>
  </div>
    
        <div class="accordion-item">

    <div class="accordion-header">

      <span class="accordion-title">

        <i class="fa-solid fa-prescription-bottle-medical"></i> Antibiotics - Surgical prophylaxis

      </span>

      <span>

        <i class="fas fa-plus"></i>

        <i class="fas fa-minus"></i>

      </span>

    </div>

    <div class="accordion-content">

      <div class="accordion-content-inner general-section">      
 
  <div class="result">
    
<table style="width: 100%; border-collapse: collapse;"> 
          <tr style="background-color: #fff;">
            <td style="padding: 8px; border: 1px solid #ccc;">
              <strong>Amoxicillin</strong>
            </td>
            <td style="padding: 8px; border: 1px solid #ccc;">
              30 mg/kg (Max 1 g)
            </td>
            <td style="padding: 8px; border: 1px solid #ccc; text-align: right;">
              <span id="amoxicillin"></span>
              <span class="static unit">mg</span>
            </td>
          </tr>
          <tr style="background-color: #f5f5f5;">
            <td colspan="3" style="padding: 8px; border: 1px solid #ccc; text-align: center;">
              <small></small>
            </td>
          </tr>
          <tr style="background-color: #fff;">
            <td style="padding: 8px; border: 1px solid #ccc;">
              <strong>Cefuroxime</strong>
            </td>
            <td style="padding: 8px; border: 1px solid #ccc;">
              50 mg/kg (Max 1.5g)
            </td>
            <td style="padding: 8px; border: 1px solid #ccc; text-align: right;">
              <span id="cefuroxime"></span>
              <span class="static unit">mg</span>
            </td>
          </tr>
          <tr style="background-color: #f5f5f5;">
            <td colspan="3" style="padding: 8px; border: 1px solid #ccc; text-align: center;">
              <small></small>
            </td>
          </tr>

          <tr style="background-color: #fff;">
            <td style="padding: 8px; border: 1px solid #ccc;">
              <strong>Co-Amoxiclav</strong>
            </td>
            <td style="padding: 8px; border: 1px solid #ccc;">
              30 mg/kg (Max 1.2 g)
            </td>
            <td style="padding: 8px; border: 1px solid #ccc; text-align: right;">
              <span id="co-amoxiclav"></span>
              <span class="static unit">mg</span>
            </td>
          </tr>
          <tr style="background-color: #f5f5f5;">
            <td colspan="3" style="padding: 8px; border: 1px solid #ccc; text-align: center;">
              <small></small>
            </td>
          </tr>
  <tr style="background-color: #fff;">
            <td style="padding: 8px; border: 1px solid #ccc;">
              <strong>Flucloxacillin</strong>
            </td>
            <td style="padding: 8px; border: 1px solid #ccc;">
              12.5–25 mg/kg (Max 1 g)
            </td>
            <td style="padding: 8px; border: 1px solid #ccc; text-align: right;">
              <span id="flucloxacillin"></span>
              <span class="static unit">mg</span>
            </td>
          </tr>
          <tr style="background-color: #f5f5f5;">
            <td colspan="3" style="padding: 8px; border: 1px solid #ccc; text-align: center;">
              <small></small>
            </td>
          </tr>
    <tr style="background-color: #fff;">
            <td style="padding: 8px; border: 1px solid #ccc;">
              <strong>Gentamicin</strong>
            </td>
            <td style="padding: 8px; border: 1px solid #ccc;">
              2.5 mg/kg (Max 480 mg)
            </td>
            <td style="padding: 8px; border: 1px solid #ccc; text-align: right;">
              <span id="gentamicin"></span>
              <span class="static unit">mg</span>
            </td>
          </tr>
          <tr style="background-color: #f5f5f5;">
            <td colspan="3" style="padding: 8px; border: 1px solid #ccc; text-align: center;">
              <small></small>
            </td>
          </tr>
  
    </table>
  </div>
  </div>
    </div>
  </div>
   
     <div class="accordion-item">
    <div class="accordion-header">
      <span class="accordion-title">
        <i class="fa-solid fa-grip-lines"></i> Lines
      </span>
      <span>
        <i class="fas fa-plus"></i>
        <i class="fas fa-minus"></i>
      </span>
    </div>    
     <div class="accordion-content">
      <div class="accordion-content-inner general-section">       
  <div class="result">    
    
<table style="width: 100%; border-collapse: collapse;"> 
      <thead>
      <tr>
        <th colspan="2" style="border:1px solid #ccc; padding:8px;">
         Arterial lines - Radial
        </th>
      </tr>
    </thead>        
  <tr>
            <td style="padding: 8px; border: 1px solid #ccc;">
              <strong>Neonates/Infants &lt;10 kg</strong>
            </td>
            <td style="padding: 8px; border: 1px solid #ccc;">
              24G<br>Pressure transducer: 150 mmHg (generates a flow rate of 1.5 mL/hr)
            </td>
          </tr>
   
          <tr>
            <td style="padding: 8px; border: 1px solid #ccc;">
              <strong>Children &gt;10 kg</strong>
            </td>
            <td style="padding: 8px; border: 1px solid #ccc;">
              22G<br>Pressure transducer: 300 mmHg (generates a flow rate of 3 mL/hr)
            </td>
          </tr>

          <tr>
            <td style="padding: 8px; border: 1px solid #ccc;">
              <strong>Children &gt;50 kg</strong>
            </td>
            <td style="padding: 8px; border: 1px solid #ccc;">
              20G
            </td>

          </tr>
    </table>
  <br>
    <table>
      <table style="width: 100%; border-collapse: collapse;"> 
      <thead>
      <tr>
        <th colspan="2" style="border:1px solid #ccc; padding:8px;">
         Arterial lines - Femoral
        </th>
      </tr>
    </thead>        
  <tr>
            <td style="padding: 8px; border: 1px solid #ccc;">
              <strong>Neonates</strong>
            </td>
            <td style="padding: 8px; border: 1px solid #ccc;">
              22G, 8cm
            </td>
          </tr>

    <tr>
            <td style="padding: 8px; border: 1px solid #ccc;">
              <strong>Children</strong>
            </td>
            <td style="padding: 8px; border: 1px solid #ccc;">
              20G, 8cm
            </td>
          </tr>
    </table>
      <br>
        <table>
      <table style="width: 100%; border-collapse: collapse;"> 
      <thead>
      <tr>
        <th colspan="2" style="border:1px solid #ccc; padding:8px;">
         Central venous access - Femoral
        </th>
      </tr>
    </thead>        
  <tr>
            <td style="padding: 8px; border: 1px solid #ccc;">
              <strong>Infants &lt;6 months</strong>
            </td>
            <td style="padding: 8px; border: 1px solid #ccc;">
              4–5	Fr, triple lumen, 6–8cm lines	
            </td>
          </tr>

    <tr>
            <td style="padding: 8px; border: 1px solid #ccc;">
              <strong>Children 6m–5y</strong>
            </td>
            <td style="padding: 8px; border: 1px solid #ccc;">
              5	Fr triple lumen, 8–12 cm
            </td>
          </tr>
            <tr>
            <td style="padding: 8px; border: 1px solid #ccc;">
              <strong>Children &gt;5y/&gt;40 kg</strong>
            </td>
            <td style="padding: 8px; border: 1px solid #ccc;">
              7 fr, triple lumen, 15 cm
            </td>
          </tr>
    </table>
          <br>
            <table>
      <table style="width: 100%; border-collapse: collapse;"> 
      <thead>
      <tr>
        <th colspan="2" style="border:1px solid #ccc; padding:8px;">
         Central venous access - Internal jugular
        </th>
      </tr>
    </thead>        
  <tr>
            <td style="padding: 8px; border: 1px solid #ccc;">
              <strong>&lt;15 kg</strong>
            </td>
            <td style="padding: 8px; border: 1px solid #ccc;">
              	5 cm		
            </td>
          </tr>

    <tr>
            <td style="padding: 8px; border: 1px solid #ccc;">
              <strong>16–40 kg</strong>
            </td>
            <td style="padding: 8px; border: 1px solid #ccc;">
              8 cm
            </td>
          </tr>
            <tr>
            <td style="padding: 8px; border: 1px solid #ccc;">
              <strong>Children &gt;5y/&gt;40 kg</strong>
            </td>
            <td style="padding: 8px; border: 1px solid #ccc;">
              13 cm
            </td>
          </tr>
    </table>
      
  </div>
  </div>
    </div>
  </div>
    
     <div class="accordion-item">

    <div class="accordion-header">

      <span class="accordion-title">

        <i class="fa-solid fa-book"></i> Links and Guidelines

      </span>

      <span>

        <i class="fas fa-plus"></i>

        <i class="fas fa-minus"></i>

      </span>

    </div>

    <div class="accordion-content">

      <div class="accordion-content-inner general-section">      
 <p><a href="https://www.paedspro.com/">Paeds Prescribing Pro Drug Calculator</a></p>
        <p><a href="/guidelines/paediatrics/apls-2021-paediatric-emergency-drug-chart.pdf">APLS Paediatric emergency drug chart 2021</a></p>
        <p><a href="https://www.evelinalondon.nhs.uk/our-services/hospital/south-thames-retrieval-service/clinical-guidelines.aspx">South Thames Retrieval Service (STRS) Clinical Guidelines and Drug Calculators</a></p>
        <p><a href="https://cats.nhs.uk/clinical-guidelines/">Children’s Acute Transport Service (CATS) Clinical Guidelines</a></p>
        <p><a href="https://www.resus.org.uk/library/2021-resuscitation-guidelines/paediatric-advanced-life-support-guidelines">Paediatric Advanced Life Support Guidelines (Resuscitation Council UK)</a></p>
        
  </div>
    </div>
  </div>
    
     <div class="accordion-item">

    <div class="accordion-header">

      <span class="accordion-title">
       <i class="fa-solid fa-calculator"></i> Calculations and tables
      </span>
      <span>
        <i class="fas fa-plus"></i>
        <i class="fas fa-minus"></i>
      </span>
    </div>
    <div class="accordion-content">
      <div class="accordion-content-inner general-section"> 
       <table style="width:100%; border-collapse: collapse; font-size: 14px;">
    <thead>
      <tr>
        <th colspan="2" style="border:1px solid #ccc; padding:8px;">
         Weight (kg)
        </th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <th style="border:1px solid #ccc; padding:8px; text-align:center;">Age 1-12 months</th>
        <td style="border:1px solid #ccc; padding:8px; text-align:center;">
          <p>0.5 x Age (months) + 4</p> 
        </td>
      </tr>
         <tr>
        <th style="border:1px solid #ccc; padding:8px; text-align:center;">Age 1-5 years</th>
        <td style="border:1px solid #ccc; padding:8px; text-align:center;">
          <p>2 x Age (years) + 8</p> 
        </td>
      </tr>
          <tr>
        <th style="border:1px solid #ccc; padding:8px; text-align:center;">Age 6-14 years</th>
        <td style="border:1px solid #ccc; padding:8px; text-align:center;">
          <p>2 x Age (years) + 8</p> 
          <p>3 x Age (years) + 7</p>
        </td>
      </tr>
    </tbody>
  </table>        
        <br>
        <table style="width:100%; border-collapse: collapse; font-size: 14px;">
    <thead>
      <tr>
        <th colspan="2" style="border:1px solid #ccc; padding:8px;">
         Airway and Ventilation
        </th>
      </tr>
    </thead>
    <tbody>
           <tr>
        <th style="border:1px solid #ccc; padding:8px; text-align:center;">ETT size</th>
        <td style="border:1px solid #ccc; padding:8px; text-align:center;">
          <p>Uncuffed ETT size = (Age/4) + 4</p>
          <p>Decrease by 0.5 for Cuffed ETT</p>
        </td>
      </tr>
      <tr>
        <th style="border:1px solid #ccc; padding:8px; text-align:center;">ETT depth</th>
        <td style="border:1px solid #ccc; padding:8px; text-align:center;">
          <p>Above 1 year: Depth ≈ Age/2+12</p> 
          <p>Neonates: Depth ≈ 1.17 × Birth weight (kg) + 5.58 (“7-8-9” rule)</p>
        </td>
      </tr>
    </tbody>
  </table>        
         </div>
    </div>
  </div>
    
   <div class="button-container" style="text-align: center; margin-bottom: 20px;">
    <button type="button" class="reset-btn" onclick="resetForm()">Reset</button>
    <button type="button" class="home-btn" onclick="goHome()">Home</button>
  </div>
  
  <footer>
    <small> 
    <p>SBP: Systolic blood pressure; HR: Heart rate; RR: Respiratory rate; ETT: Endotracheal tube; LMA: Laryngeal mask airway; RSI: Rapid sequence intubation; PO: By mouth; NAS: Intranasal; TOF: Train-of-four; PTC: Post-tetanic count</p>
      <p>
        <a href="references.html">References</a> - 
        <a href="disclaimer.html">Disclaimer</a>
      </p>
      <p>&copy; 2025 #OneTeam Anaesthesia. All rights reserved.</p>
    </small>
  </footer>

<script>
    function stripZeros(str) {
    return str
      .replace(/(\.\d*?[1-9])0+$/ , '$1')   // drop extra zeroes after a significant decimal
      .replace(/\.0+$/            , ''   );// drop ".0", ".00", etc.
  }
  
  let ageUnit = 'years';
  let autoEstimate = true;

  // grab your nodes once
  const ageInput = document.getElementById('age');
  const weightIn = document.getElementById('weight');
  const unitBtn  = document.getElementById('AgeUnitBtn');
  const estToggle = document.getElementById('EstimateToggle');
  const calcDiv  = document.getElementById('weight-calculations');

  // clear everything and hide all outputs
  function clearWeight() {
  // 1) remove any old small notes (EM, calc, analgesic)
  document
    .querySelectorAll('.airway-note')
    .forEach(el => el.remove());

    [
  'fentanyl-vol-extra',
  'ketamine-vol-extra',
  'rocuronium-vol-extra',
  'atropine-vol-extra',
  'adrenalineiv-vol-extra',
  'sux-iv-vol-extra',
  'sux-im-vol-extra'
].forEach(id => {
  const el = document.getElementById(id);
  if (el) el.textContent = '';
});
    
  // 2) clear the weight-calculation formulas
  calcDiv.innerHTML = '';
    
    [
    'fentanyl-ga-extra',
    'propofol-ga-extra',
    'rocuronium-ga-extra',
    'ondansetron-ga-extra',
    'dexamethasone-ga-extra'
  ].forEach(id => {
    const el = document.getElementById(id);
    if (el) el.textContent = '';
  });

  // 3) hide uncuffed/cuffed ETT
  ['ett-uncuffed', 'ett-cuffed']
    .forEach(id => {
      const el = document.getElementById(id);
      if (el) el.style.display = 'none';
    });
    
// 3a) hide old depth values
 ['ett-depth-lips'].forEach(id => {
  const el = document.getElementById(id);
   if (!el) return;
   el.textContent = '';
   el.style.display = 'none';
   const unit = el.nextElementSibling;
   if (unit && unit.classList.contains('unit')) {
     unit.style.display = 'none';
   }
  });    

  // 4) clear laryngoscope
  const laryngoscopeEl = document.getElementById('laryngoscope');
  laryngoscopeEl.textContent = '';
  laryngoscopeEl.style.display = 'none';

  // 5) clear normal/airway numeric spans (just text)
  [
    'sbp-5','sbp-50','sbp-95',
    'hr-5','hr-95','rr-5','rr-95',
    'ett-uncuffed','ett-cuffed',
    'lma','fentanyl','ketamine','rocuronium'
  ].forEach(id => {
    document.getElementById(id).textContent = '';
  });

  // 6) hide emergency drug values + units
  [
    'fentanyl','ketamine','rocuronium',
    'atropine','sux-iv','sux-im',
    'defib','adrenalineiv','fluidbolus','glucose10'
  ].forEach(id => {
    const el   = document.getElementById(id);
    const unit = el.nextElementSibling;
    el.textContent     = '';
    el.style.display   = 'none';
    if (unit && unit.classList.contains('unit')) {
      unit.style.display = 'none';
    }
  });

  // 7) hide GA drug values + units
  [
    'propofol','fentanyl-ga','rocuronium-ga',
    'dexamethasone','ondansetron','paracetamol-iv','paracetamol-po','ibuprofeniv','ibuprofenpo','ketorolac','morphineiv','morphinepo'
  ].forEach(id => {
    const el   = document.getElementById(id);
    const unit = el.nextElementSibling;
    el.textContent     = '';
    el.style.display   = 'none';
    if (unit && unit.classList.contains('unit')) {
      unit.style.display = 'none';
    }
  });
    
    const ketExtra = document.getElementById('ketorolac-extra');
if (ketExtra) ketExtra.textContent = '';
    
 const mIvNote = document.getElementById('morphine-iv-extra');
if (mIvNote) mIvNote.textContent = '';
    
    const mPoNote = document.getElementById('morphine-po-extra');
if (mPoNote) mPoNote.textContent = '';
    
['paracetamol-iv-note','paracetamol-po-note'].forEach(id => {
  const noteEl = document.getElementById(id);
  if (noteEl) {
    noteEl.textContent = '';
    noteEl.style.display = 'none';
   }
 });
    
    const midazEl   = document.getElementById('premed-midaz');
const midazUnit = midazEl.nextElementSibling; // the “ mg” span

midazEl.textContent   = '';
midazEl.style.display = 'none';

if (midazUnit && midazUnit.classList.contains('unit')) {
  midazUnit.style.display = 'none';
}
    
    // Clear Midazolam NAS
const nasEl   = document.getElementById('premed-midaz-intranasal');
const nasUnit = nasEl.nextElementSibling;
nasEl.textContent   = '';
nasEl.style.display = 'none';
if (nasUnit && nasUnit.classList.contains('unit')) {
  nasUnit.style.display = 'none';
}
      // Clear Dexmedetomidine NAS
  const dexEl   = document.getElementById('premed-dexmed');
  const dexUnit = dexEl.nextElementSibling;
  dexEl.textContent   = '';
  dexEl.style.display = 'none';
  if (dexUnit && dexUnit.classList.contains('unit')) {
    dexUnit.style.display = 'none';
  }
  // 8) hide i-gel & tidal-volume
  const igelEl = document.getElementById('igel');
  igelEl.innerHTML = '';
  igelEl.style.display = 'none';

  const tvEl = document.getElementById('tidalvolume');
  tvEl.textContent = '';
  tvEl.style.display = 'none';
    
    const tvArdsEl = document.getElementById('tv-neonates-ards');
if (tvArdsEl) {
  tvArdsEl.textContent = '';
  tvArdsEl.style.display = 'none';
}

  // 10) hide static text in normals
  document.querySelectorAll('.normal-values .static')
    .forEach(el => el.style.display = 'none');
    
    ['lma', 'igel'].forEach(id => {
    const span = document.getElementById(id);
    if (!span) return;
    span.parentElement.style.display = ''; // back to table-cell
  });

// hide the GA copies of emergency drugs (class-based spans and their units)
document.querySelectorAll('.atropine-dose, .sux-iv-dose, .sux-im-dose').forEach(el => {
  el.textContent   = '';
  el.style.display = 'none';
  const unit = el.nextElementSibling;
  if (unit && unit.classList.contains('unit')) {
    unit.style.display = 'none';
  }
});
    
  const cyclEl = document.getElementById('cyclizine');
  if (cyclEl) {
    cyclEl.textContent   = '';
    cyclEl.style.display = 'none';
    const unit = cyclEl.nextElementSibling;
    if (unit && unit.classList.contains('unit')) unit.style.display = 'none';
  }
  const cyclExtra = document.getElementById('cyclizine-ga-extra');
  if (cyclExtra) cyclExtra.textContent = '';    
    
document.querySelectorAll('.atropine-extra, .sux-iv-extra, .sux-im-extra')
  .forEach(el => el.textContent = '');

document.querySelectorAll(
  '.sug-2-dose, .sug-4-dose, .neos-dose'
).forEach(el => {
  el.textContent   = '';
  el.style.display = 'none';
  const unit = el.nextElementSibling;
  if (unit && unit.classList.contains('unit')) unit.style.display = 'none';
});
document.querySelectorAll(
  '.sug-2-extra, .sug-4-extra, .neos-extra'
).forEach(el => el.textContent = '');    
}

function updatePremedication(w) {
  // Midazolam PO…
  const midazEl   = document.getElementById('premed-midaz');
const midazUnit = midazEl.nextElementSibling; // the “ mg” span
if (w > 0) {
  let dose = 0.5 * w;
  if (dose > 20) dose = 20;
  midazEl.textContent   = stripZeros(dose.toFixed(2));
  midazEl.style.display = 'inline';
  if (midazUnit && midazUnit.classList.contains('unit')) {
    midazUnit.style.display = 'inline';
  }
} else {
  midazEl.textContent   = '';
  midazEl.style.display = 'none';
  if (midazUnit && midazUnit.classList.contains('unit')) {
    midazUnit.style.display = 'none';
  }
}
  
  // — Midazolam NAS (0.2–0.3 mg/kg; max 10 mg) —
const nasEl   = document.getElementById('premed-midaz-intranasal');
const nasUnit = nasEl.nextElementSibling; // the “ mg” span
if (w > 0) {
  // calculate 0.2–0.3 mg/kg and cap at 10 mg
  const minDose = Math.min(0.2 * w, 10);
  const maxDose = Math.min(0.3 * w, 10);
  const doseText = (Math.abs(minDose - maxDose) < 0.001)
    ? stripZeros(minDose.toFixed(2))
    : `${stripZeros(minDose.toFixed(2))}–${stripZeros(maxDose.toFixed(2))}`;
  nasEl.textContent   = doseText;
  nasEl.style.display = 'inline';
  if (nasUnit && nasUnit.classList.contains('unit')) {
    nasUnit.style.display = 'inline';
  }
} else {
  nasEl.textContent   = '';
  nasEl.style.display = 'none';
  if (nasUnit && nasUnit.classList.contains('unit')) {
    nasUnit.style.display = 'none';
  }
}
  
    // — Dexmedetomidine NAS (2–4 mcg/kg; max 200 mcg) —
  const dexEl   = document.getElementById('premed-dexmed');
  const dexUnit = dexEl.nextElementSibling; // the “ mcg” span
  if (w > 0) {
    // calculate 2–4 mcg/kg and cap at 200 mcg
    const minDose = Math.min(2 * w, 200);
    const maxDose = Math.min(4 * w, 200);
    const doseText = (Math.abs(minDose - maxDose) < 0.001)
      ? stripZeros(minDose.toFixed(2))
      : `${stripZeros(minDose.toFixed(2))}–${stripZeros(maxDose.toFixed(2))}`;
    dexEl.textContent   = doseText;
    dexEl.style.display = 'inline';
    if (dexUnit && dexUnit.classList.contains('unit')) {
      dexUnit.style.display = 'inline';
    }
  } else {
    dexEl.textContent   = '';
    dexEl.style.display = 'none';
    if (dexUnit && dexUnit.classList.contains('unit')) {
      dexUnit.style.display = 'none';
    }
  }
}  
  
function updateReversal(w) {
  // -- 1) clear all previous doses + extras --
  [
    '.sug-2-dose', '.sug-4-dose', '.neos-dose',
    '.sug-2-extra', '.sug-4-extra', '.neos-extra'
  ].forEach(sel => {
    document.querySelectorAll(sel).forEach(el => {
      el.textContent = '';
      // hide dose spans (they share the same unit <span>)
      if (sel.endsWith('-dose')) el.style.display = 'none';
    });
  });

  if (w > 0 && !isNaN(w)) {
    // -- 2) Sugammadex 2 mg/kg @100 mg/mL --
    document.querySelectorAll('.sug-2-dose').forEach(el => {
      const dose = 2 * w;
      el.textContent   = stripZeros(dose.toFixed(2));
      el.style.display = 'inline';
      // show its unit
      const u = el.nextElementSibling;
      if (u && u.classList.contains('unit')) u.style.display = 'inline';
    });
    document.querySelectorAll('.sug-2-extra').forEach(el => {
      const vol = (2 * w) / 100;
      el.textContent = `${stripZeros(vol.toFixed(2))} mL of 100 mg/mL`;
    });

    // -- 3) Sugammadex 4 mg/kg @100 mg/mL --
    document.querySelectorAll('.sug-4-dose').forEach(el => {
      const dose = 4 * w;
      el.textContent   = stripZeros(dose.toFixed(2));
      el.style.display = 'inline';
      const u = el.nextElementSibling;
      if (u && u.classList.contains('unit')) u.style.display = 'inline';
    });
    document.querySelectorAll('.sug-4-extra').forEach(el => {
      const vol = (4 * w) / 100;
      el.textContent = `${stripZeros(vol.toFixed(2))} mL of 100 mg/mL`;
    });

    // -- 4) Neostigmine/Glycopyrulate 0.02 mL/kg (2.5 + 0.5 mg/mL) --
    document.querySelectorAll('.neos-dose').forEach(el => {
      const vol = 0.02 * w;
      el.textContent   = stripZeros(vol.toFixed(2));
      el.style.display = 'inline';
      const u = el.nextElementSibling;
      if (u && u.classList.contains('unit')) u.style.display = 'inline';
    });
    document.querySelectorAll('.neos-extra').forEach(el => {
      const vol   = 0.02 * w;
      const neo   = vol * 2.5;
      const gly   = vol * 0.5;
      el.textContent =
        `${stripZeros(vol.toFixed(2))} mL ` +
        `(contains ${stripZeros(neo.toFixed(2))} mg neostigmine + ` +
         `${stripZeros(gly.toFixed(2))} mg glycopyrulate)`;
    });
  }
}
  
  function updateAnalgesics(w) {
  // 2) Clear out the “-note” cells for Paracetamol & Ibuprofen
  [
    'paracetamol-po-note',
    'paracetamol-iv-note',
    'ibuprofeniv-note',
    'ibuprofenpo-note',
    'ketorolac-extra'
  ].forEach(extraId => {
    const el = document.getElementById(extraId);
    if (el) el.textContent = '';
  });

// — PARACETAMOL dosing & note —

  // 1) Calculate IV dose & note
  let paraIVDose, paraIVNote;
  if (w > 0 && w <= 10) {
    paraIVDose = 10 * w;
    const maxDailyLowIV = stripZeros((30 * w).toFixed(2));
    paraIVNote = `10 mg/kg every 4–6 h; max 30 mg/kg/day = ${maxDailyLowIV} mg`;
  } else if (w <= 50) {
    paraIVDose = 15 * w;
    const maxDailyHighIV = stripZeros((60 * w).toFixed(2));
    paraIVNote = `15 mg/kg every 4–6 h; max 60 mg/kg/day = ${maxDailyHighIV} mg`;
  } else if (w > 50) {
    paraIVDose = 1000;
    paraIVNote = `1 g every 4–6 h; max 4 g/day`;
  } else {
    paraIVDose = 0;
    paraIVNote = '';
  }

  // 2) Calculate PO dose & note
  let paraPODose, paraPONote;
  if (w > 0 && w <= 10) {
    paraPODose = 10 * w;
    const maxDailyLowPO = stripZeros((30 * w).toFixed(2));
    paraPONote = `10 mg/kg every 4–6 h; max 30 mg/kg/day = ${maxDailyLowPO} mg`;
  } else if (w <= 50) {
    paraPODose = 15 * w;
    const maxDailyHighPO = stripZeros((60 * w).toFixed(2));
    paraPONote = `15 mg/kg every 4–6 h; max 60 mg/kg/day = ${maxDailyHighPO} mg`;
  } else if (w > 50) {
    paraPODose = 1000;
    paraPONote = `1 g every 4–6 h; max 4 g/day`;
  } else {
    paraPODose = 0;
    paraPONote = '';
  }

  // 3) Update IV span & note for Paracetamol
  const pIvEl     = document.getElementById('paracetamol-iv');
  const pIvUnit   = pIvEl.nextElementSibling; // the “ mg” span
  const pIvNoteEl = document.getElementById('paracetamol-iv-note');

  if (paraIVDose > 0) {
    pIvEl.textContent   = stripZeros(paraIVDose.toFixed(2));
    pIvEl.style.display = 'inline';
    if (pIvUnit) pIvUnit.style.display = 'inline';

    pIvNoteEl.innerHTML     = `<em>${paraIVNote}</em>`;
    pIvNoteEl.style.display = 'inline';
  } else {
    pIvEl.textContent     = '';
    pIvEl.style.display   = 'none';
    if (pIvUnit) pIvUnit.style.display = 'none';

    pIvNoteEl.textContent     = '';
    pIvNoteEl.style.display   = 'none';
  }

  // 4) Update PO span & note for Paracetamol
  const pPoEl     = document.getElementById('paracetamol-po');
  const pPoUnit   = pPoEl.nextElementSibling; // the “ mg” span
  const pPoNoteEl = document.getElementById('paracetamol-po-note');

  if (paraPODose > 0) {
    pPoEl.textContent   = stripZeros(paraPODose.toFixed(2));
    pPoEl.style.display = 'inline';
    if (pPoUnit) pPoUnit.style.display = 'inline';

    pPoNoteEl.innerHTML     = `<em>${paraPONote}</em>`;
    pPoNoteEl.style.display = 'inline';
  } else {
    pPoEl.textContent     = '';
    pPoEl.style.display   = 'none';
    if (pPoUnit) pPoUnit.style.display = 'none';

    pPoNoteEl.textContent     = '';
    pPoNoteEl.style.display   = 'none';
  }
  
  // — IBUPROFEN IV dosing & note —
  const iEl   = document.getElementById('ibuprofeniv');
  const iUnit = iEl.nextElementSibling; // “ mg”
  let ibuText = '', ibuNote = '';

  const rawAge = parseFloat(ageInput.value) || 0;
  const ageY   = ageUnit === 'months' ? rawAge/12 : rawAge;

  if (ageY < 6 || w < 20) {
    // Not recommended under 20 kg or below 6 years
    ibuNote = 'Not recommended for children under 20 kg or below 6 years of age.';
    ibuText = ''; 
  } else if (ageY < 18) {
    if (w <= 29) {
      ibuText = '200';
      ibuNote = '200 mg TDS, 6–8 h; max 600 mg/day';
    } else if (w <= 39) {
      ibuText = '200';
      ibuNote = '200 mg QDS, 6 h; max 800 mg/day';
    } else {
      ibuText = '200–400';
      ibuNote = '200–400 mg TDS, 6–8 h; max 1200 mg/day';
    }
  }

  if (ibuText) {
    iEl.textContent   = ibuText;
    iEl.style.display = 'inline';
    if (iUnit) iUnit.style.display = 'inline';
  } else {
    iEl.textContent   = '';
    iEl.style.display = 'none';
    if (iUnit) iUnit.style.display = 'none';
  }

  // Write the Ibuprofen IV note into its colspan cell:
  const ibuivCell = document.getElementById('ibuprofeniv-note');
  ibuivCell.innerHTML = ibuNote ? `<em>${ibuNote}</em>` : '';

  // — IBUPROFEN PO dosing & note —
  const poEl   = document.getElementById('ibuprofenpo');
  const poUnit = poEl.nextElementSibling; // “ mg”
  let poText = '', poNote = '';

  const ageMonths = ageUnit === 'months' ? rawAge : rawAge * 12;
  if (ageMonths > 3 && w > 0) {
    const dMin = Math.min(5 * w, 400);
    const dMax = Math.min(10 * w, 400);
    poText = `${dMin.toFixed(0)}–${dMax.toFixed(0)}`;
    poNote = 'Maximum 30 mg/kg/day in 3–4 divided doses';
  }

  if (poText) {
    poEl.textContent   = poText;
    poEl.style.display = 'inline';
    if (poUnit) poUnit.style.display = 'inline';
  } else {
    poEl.textContent   = '';
    poEl.style.display = 'none';
    if (poUnit) poUnit.style.display = 'none';
  }

  // Write the Ibuprofen PO note into its colspan cell:
  const ibupopc = document.getElementById('ibuprofenpo-note');
  ibupopc.innerHTML = poNote ? `<em>${poNote}</em>` : '';
    
// — KETOROLAC dosing & volume (30 mg/mL) —
  //
  const kEl      = document.getElementById('ketorolac');
  const kUnit    = kEl.nextElementSibling;     // “ mg”
  const extraEl  = document.getElementById('ketorolac-extra');

  // If age < 0.5 yrs → “Not licensed”
  if (ageY < 0.5) {
    kEl.textContent   = 'Not licensed';
    kEl.style.display = 'inline';
    if (kUnit) kUnit.style.display = 'none';
    extraEl.textContent = '';
    return;
  }

  // If age ≥ 16 yrs → flat 30 mg (adults)
  if (ageY >= 16) {
    kEl.textContent   = '30';
    kEl.style.display = 'inline';
    if (kUnit) kUnit.style.display = 'inline';

    // 30 mg at 30 mg/mL = 1 mL
    extraEl.innerHTML = `<em>1.00 mL of 30 mg/mL</em>`;
    return;
  }

  // Otherwise (age 0.5 – 15 yrs): calculate 0.5–1 mg/kg, cap at 15 mg
  if (w > 0 && !isNaN(w)) {
    let kDoseMin = 0.5 * w;
    let kDoseMax = 1.0 * w;

    // Cap both min/max at 15 mg
    if (kDoseMin > 15) {
      kDoseMin = 15;
      kDoseMax = 15;
    } else if (kDoseMax > 15) {
      kDoseMax = 15;
    }

    // Build dose text (if min === max, show “15 (m​ax)”)
    let doseText;
    if (Math.abs(kDoseMin - kDoseMax) < 0.001) {
  // capped exactly at 15 mg → show "15" in kEl and "mg (max)" in kUnit
  kEl.textContent = stripZeros(kDoseMin.toFixed(2));
  kEl.style.display = 'inline';
  if (kUnit) {
    kUnit.textContent = ' mg (max)';
    kUnit.style.display = 'inline';
  }
} else {
  // normal 0.5–1 mg/kg without cap
  kEl.textContent   = `${stripZeros(kDoseMin.toFixed(2))}–${stripZeros(kDoseMax.toFixed(2))}`;
  kEl.style.display = 'inline';
  if (kUnit) {
    kUnit.textContent = ' mg';
    kUnit.style.display = 'inline';
  }
}

    // Compute volume at 30 mg/mL
    const vMin = (Math.min(kDoseMin, 15) / 30).toFixed(2);
    const vMax = (Math.min(kDoseMax, 15) / 30).toFixed(2);

    let volText;
    if (Math.abs(kDoseMin - kDoseMax) < 0.001) {
      // capped: show “0.50 mL (max) of 30 mg/mL”
      volText = `${stripZeros(vMin)} (max)`;
    } else {
      volText = `${stripZeros(vMin)}–${stripZeros(vMax)}`;
    }

    extraEl.innerHTML = `<em>${volText} mL of 30 mg/mL</em>`;
  } else {
    // If weight is invalid or zero: hide everything
    kEl.textContent   = '';
    kEl.style.display = 'none';
    if (kUnit) kUnit.style.display = 'none';
    extraEl.textContent = '';
  }
   // — MORPHINE IV (0.05–0.1 mg/kg up to 12 y; ≥12 y → 5 mg) —
  const mIvEl   = document.getElementById('morphineiv');
  const mIvUnit = mIvEl.nextElementSibling; // “ mg”
  const mNoteEl = document.getElementById('morphine-iv-extra');

  if (w > 0 && !isNaN(w)) {
    // calculate age in years
    const rawAge = parseFloat(ageInput.value) || 0;
    const ageY   = (ageUnit === 'months') ? (rawAge / 12) : rawAge;

    let doseText;
    if (ageY < 12) {
      // 0.05–0.1 mg/kg
      const minDose = 0.05 * w;
      const maxDose = 0.10 * w;
      doseText = `${stripZeros(minDose.toFixed(2))}–${stripZeros(maxDose.toFixed(2))}`;
    } else {
      // ≥ 12 years → flat 5 mg
      doseText = '5';
    }

    // Write dose into the span and show its unit
    mIvEl.textContent   = doseText;
    mIvEl.style.display = 'inline';
    if (mIvUnit && mIvUnit.classList.contains('unit')) {
      mIvUnit.style.display = 'inline';
    }

    // Put the note into the <small id="morphine-iv-extra"> cell:
    mNoteEl.innerHTML = `<em>Every 4 hours, adjusted according to response</em>`;
  } else {
    // hide Morphine IV span & unit, clear note
    mIvEl.textContent   = '';
    mIvEl.style.display = 'none';
    if (mIvUnit && mIvUnit.classList.contains('unit')) {
      mIvUnit.style.display = 'none';
    }
    mNoteEl.textContent = '';
  }
// — MORPHINE PO (age-stratified µg/kg → mg) —
  const mPoEl    = document.getElementById('morphinepo');
  const mPoUnit  = mPoEl.nextElementSibling; // “ mg”
  const mPoNote  = document.getElementById('morphine-po-extra');

  if (w > 0 && !isNaN(w)) {
    const rawAge = parseFloat(ageInput.value) || 0;
    // convert age to months
    const ageMonths = ageUnit === 'months' ? rawAge : rawAge * 12;
    // convert age to years (decimal)
    const ageY = ageMonths / 12;

    let doseMinMg = 0, doseMaxMg = 0;
    let noteText = '';

    if (ageMonths >= 1 && ageMonths <= 2) {
      // 50–100 µg/kg → (50/1000)–(100/1000) mg/kg
      doseMinMg  = (50  * w) / 1000;
      doseMaxMg  = (100 * w) / 1000;
      noteText   = 'Initially 50–100 µg/kg every 4 hours, adjust per response';
    }
    else if (ageMonths > 2 && ageMonths <= 5) {
      // 100–150 µg/kg
      doseMinMg  = (100 * w) / 1000;
      doseMaxMg  = (150 * w) / 1000;
      noteText   = '100–150 µg/kg every 4 hours, adjust per response';
    }
    else if (ageMonths > 5 && ageMonths < 12) {
      // 200 µg/kg exactly
      doseMinMg  = (200 * w) / 1000;
      doseMaxMg  = doseMinMg;
      noteText   = '200 µg/kg every 4 hours, adjust per response';
    }
    else if (Math.floor(ageY) === 1) {
      // exactly 1 year → 200–300 µg/kg
      doseMinMg  = (200 * w) / 1000;
      doseMaxMg  = (300 * w) / 1000;
      noteText   = '200–300 µg/kg every 4 hours, adjust per response';
    }
    else if (ageY >= 2 && ageY < 12) {
      // 2–11 years → 200–300 µg/kg, max per dose 10 mg
      const rawMin = (200 * w) / 1000;
      const rawMax = (300 * w) / 1000;
      doseMinMg    = Math.min(rawMin, 10);
      doseMaxMg    = Math.min(rawMax, 10);
      noteText     = '200–300 µg/kg every 4 hours (max 10 mg/dose), adjust per response';
    }
    else if (ageY >= 12 && ageY < 18) {
      // 12–17 years → 5–10 mg every 4 hours
      doseMinMg  = 5;
      doseMaxMg  = 10;
      noteText   = '5–10 mg every 4 hours, adjust per response';
    }
    else {
      // if <1 month or ≥18 years, hide
      doseMinMg = doseMaxMg = 0;
      noteText = '';
    }

    if (doseMinMg > 0) {
      // Format “min–max” or single value
      const doseText = Math.abs(doseMaxMg - doseMinMg) < 0.01
        ? stripZeros(doseMinMg.toFixed(2))
        : `${stripZeros(doseMinMg.toFixed(2))}–${stripZeros(doseMaxMg.toFixed(2))}`;

      mPoEl.textContent   = doseText;
      mPoEl.style.display = 'inline';
      if (mPoUnit && mPoUnit.classList.contains('unit')) {
        mPoUnit.style.display = 'inline';
      }
      mPoNote.innerHTML = `<em>${noteText}</em>`;
    } else {
      mPoEl.textContent   = '';
      mPoEl.style.display = 'none';
      if (mPoUnit && mPoUnit.classList.contains('unit')) {
        mPoUnit.style.display = 'none';
      }
      mPoNote.textContent = '';
    }
  } else {
    // no weight → hide Morphine PO entirely
    mPoEl.textContent   = '';
    mPoEl.style.display = 'none';
    if (mPoUnit && mPoUnit.classList.contains('unit')) {
      mPoUnit.style.display = 'none';
    }
    mPoNote.textContent = '';
  }    
}

  // toggle years ↔ months
  function toggleAgeUnit() {
    clearWeight();
    const raw = ageInput.value.trim();
    const n   = parseFloat(raw);
    if (ageUnit === 'years') {
      ageUnit = 'months';
      unitBtn.textContent = 'months';
      ageInput.value = raw!=='' && !isNaN(n) ? Math.round(n*12) : '';
    } else {
      ageUnit = 'years';
      unitBtn.textContent = 'years';
      ageInput.value = raw!=='' && !isNaN(n) ? Math.round((n/12)*10)/10 : '';
    }
  }

  function estimateWeight() {
  clearWeight();
  const a = parseFloat(ageInput.value);
    
    const ageY = (ageUnit === 'months') ? (a / 12) : a;
  if (ageY > 14) {
    estToggle.checked    = false;
    autoEstimate         = false;
    weightIn.disabled    = false;
    weightIn.value       = '';             // clear any auto-filled weight
    weightIn.placeholder = '0';
    clearWeight();
    return;
  }
    
    
  if (isNaN(a) || a < 0) {
    alert('Please enter a valid age.');
    return;
  }

  // ── SPECIAL CASE for exactly 0 months/years ──
  if (a === 0) {
  const w = 3.5;
  weightIn.value = w;
  calcDiv.innerHTML = `<p>Estimated weight for a neonate = ${w} <span class="unit">kg</span></p>`;

  if (autoEstimate) {                          // ← ADD this block
    const y = ageUnit === 'months' ? 0/12 : 0;
    const normals = getNormalValues(a, ageUnit);
    if (normals) updateNormalCentiles(normals);
    if (!isNaN(y)) updateAirwayCalculations(y);
    expandOpenAccordion();
  }
  return;
}

  const m = ageUnit === 'months' ? a : a * 12;
  
    if (m < 12) {
  const w     = 0.5 * m + 4;
  const wDisp = stripZeros(w.toFixed(2));
  weightIn.value  = wDisp;
  calcDiv.innerHTML =
    `<p>(0.5 × Age in months) + 4 = ${wDisp} <span class="unit">kg</span></p>`;

  if (autoEstimate) {                          // ← ADD this block
    const y = ageUnit === 'months' ? (a/12) : a;
    const normals = getNormalValues(a, ageUnit);
    if (normals) updateNormalCentiles(normals);
    if (!isNaN(y)) updateAirwayCalculations(y);
    expandOpenAccordion();
  }
  return;
}
    
  const y = m / 12;
if (y <= 14) {
  const w1 = Math.round((2 * y + 8) * 10) / 10;
  let html = `<p>(2 × Age) + 8 = ${w1} <span class="unit">kg</span></p>`;
  if (y >= 6) {
    const w2 = Math.round((3 * y + 7) * 10) / 10;
    html += `<p>(3 × Age) + 7 = ${w2} <span class="unit">kg</span></p>`;
  }
  weightIn.value = w1;
  calcDiv.innerHTML = html;

  if (autoEstimate) {                          // ← ADD this block
    const normals = getNormalValues(a, ageUnit);
    if (normals) updateNormalCentiles(normals);
    if (!isNaN(y)) updateAirwayCalculations(y);
    expandOpenAccordion();
  }
  return;
}
  }

  // paediatric normals table
  const paediatricNormals = {
    0:   { respRate:[25,50], heartRate:[120,170], bp:{p5:65, p50:85, p95:105} },
    1:   { respRate:[25,50], heartRate:[120,170], bp:{p5:65, p50:85, p95:105} },
    3:   { respRate:[25,45], heartRate:[115,160], bp:{p5:65, p50:85, p95:105} },
    6:   { respRate:[20,40], heartRate:[110,160], bp:{p5:65, p50:85, p95:105} },
    12:  { respRate:[20,40], heartRate:[110,160], bp:{p5:70, p50:90, p95:105} },
    18:  { respRate:[20,35], heartRate:[100,155], bp:{p5:70, p50:90, p95:105} },
    24:  { respRate:[20,30], heartRate:[100,150], bp:{p5:70, p50:90, p95:110} },
    36:  { respRate:[20,30], heartRate:[90,140],  bp:{p5:70, p50:90, p95:110} },
    48:  { respRate:[20,30], heartRate:[80,135],  bp:{p5:70, p50:90, p95:110} },
    60:  { respRate:[20,30], heartRate:[80,135],  bp:{p5:80, p50:95, p95:120} },
    72:  { respRate:[20,30], heartRate:[80,130],  bp:{p5:80, p50:95, p95:120} },
    84:  { respRate:[20,30], heartRate:[80,130],  bp:{p5:80, p50:95, p95:120} },
    96:  { respRate:[15,25], heartRate:[70,120],  bp:{p5:80, p50:95, p95:120} },
    108: { respRate:[15,25], heartRate:[70,120],  bp:{p5:80, p50:95, p95:120} },
    120: { respRate:[15,25], heartRate:[70,120],  bp:{p5:80, p50:95, p95:120} },
    132: { respRate:[15,25], heartRate:[70,120],  bp:{p5:80, p50:95, p95:120} },
    144: { respRate:[12,24], heartRate:[65,115],  bp:{p5:90, p50:110,p95:140} },
    168: { respRate:[12,24], heartRate:[60,110],  bp:{p5:90, p50:110,p95:140} }
  };

  // pick the nearest key
  function getNormalValues(age, unit) {
    const months = unit==='months'? age : age*12;
    const keys = Object.keys(paediatricNormals).map(k=>+k).sort((a,b)=>a-b);
    if (months < 12) {
      const mks = keys.filter(k=>k<12);
      return paediatricNormals[mks.reduce((a,b)=>Math.abs(b-months)<Math.abs(a-months)?b:a, mks[0])];
    } else {
      const ideal = Math.floor(months/12)*12;
      const below = keys.filter(k=>k<=ideal);
      const key   = below.length? below.pop() : keys.find(k=>k>=12);
      return paediatricNormals[key];
    }
  }

  // show centiles
  function updateNormalCentiles(n) {
    document.getElementById('sbp-5').textContent   = n.bp.p5;
    document.getElementById('sbp-50').textContent  = n.bp.p50;
    document.getElementById('sbp-95').textContent  = n.bp.p95;
    document.getElementById('hr-5').textContent    = n.heartRate[0];
    document.getElementById('hr-95').textContent   = n.heartRate[1];
    document.getElementById('rr-5').textContent    = n.respRate[0];
    document.getElementById('rr-95').textContent   = n.respRate[1];
    document.querySelectorAll('.normal-values .static')
      .forEach(el => el.style.display='inline');
  }

  function updateAirwayCalculations(ageYears) {
  // 1) clear out any old notes
  document.querySelectorAll('.airway-note, .depth-note-row').forEach(el => el.remove());

  // 2) grab weight and convert age→months
  const w      = parseFloat(weightIn.value) || 0;
  const months = ageUnit === 'months'
    ? parseFloat(ageInput.value)
    : ageYears * 12;

  // 3) calculate uncuffed/cuffed sizes + length
  let unc, cuff, len;
  if (isNaN(months) || months < 0) {
    unc = cuff = len = null;
  } else if (months < 12) {
    // neonate/infant rule
    if      (w < 1) { unc = 2.5; len = 6.5; }
    else if (w < 2) { unc = 3.0; len = 7.0; }
    else if (w < 3) { unc = 3.5; len = 8.0; }
    else if (w < 4) { unc = 3.5; len = 9.0; }
    else            { unc = 4.0; len = 10.0; }
    cuff = unc - 0.5;
  } else {
    // older child
    unc  = ageYears / 4 + 4;
    cuff = ageYears / 4 + 3.5;
    len  = ageYears / 2 + 12;
  }

  const uncText  = unc  != null ? stripZeros(unc.toFixed(2))  : '';
  const cuffText = (cuff != null && w >= 3.5) 
                     ? stripZeros(cuff.toFixed(2)) 
                     : '';
  const lenText  = len  != null ? stripZeros(len.toFixed(2))  : '';

  // 4) inject ETT *size* values
  const uncSpan  = document.getElementById('ett-uncuffed');
  const cuffSpan = document.getElementById('ett-cuffed');
  

  uncSpan.textContent   = uncText;
  uncSpan.style.display = uncText  ? 'inline' : 'none';

  cuffSpan.textContent  = cuffText;
  cuffSpan.style.display = cuffText ? 'inline' : 'none';

  // 6) inject ETT *depth* table values
  const lipsEl      = document.getElementById('ett-depth-lips');
  const lipsUnit    = lipsEl.nextElementSibling;
  lipsEl.textContent      = lenText;
  lipsEl.style.display    = lenText ? 'inline' : 'none';
  if (lipsUnit && lipsUnit.classList.contains('unit')) {
    lipsUnit.style.display = lenText ? 'inline' : 'none';
  }

  // 8) now your i-Gel, LMA, tidal-volume & blade sizing exactly as before:
  // — i-Gel —
  const igelEl = document.getElementById('igel');
  let igelSize = '';
  if (w > 0) {
    if      (w <= 5)  igelSize = '1.0 <small>(2–5 kg)</small>';
    else if (w <= 10) igelSize = '1.5 <small>(5–12 kg)</small>';
    else if (w <= 25) igelSize = '2.0 <small>(10–25 kg)</small>';
    else if (w <= 35) igelSize = '2.5 <small>(25–35 kg)</small>';
    else if (w <= 60) igelSize = '3.0 <small>(30–60 kg)</small>';
    else if (w <= 90) igelSize = '4.0 <small>(50–90 kg)</small>';
    else              igelSize = '5.0 <small>(≥90 kg)</small>';
  }
  igelEl.innerHTML          = igelSize;
  igelEl.style.display      = igelSize ? 'inline' : 'none';

  // — LMA —
  const lmaEl = document.getElementById('lma');
  let lmaSize = '';
  if (w > 0) {
    if      (w <= 5)   lmaSize = '1.0 <small>(&lt;5 kg)</small>';
    else if (w <= 10)  lmaSize = '1.5 <small>(5–10 kg)</small>';
    else if (w <= 20)  lmaSize = '2.0 <small>(10–20 kg)</small>';
    else if (w <= 30)  lmaSize = '2.5 <small>(20–30 kg)</small>';
    else if (w <= 50)  lmaSize = '3.0 <small>(30–50 kg)</small>';
    else if (w <= 70)  lmaSize = '4.0 <small>(50–70 kg)</small>';
    else if (w <= 100) lmaSize = '5.0 <small>(70–100 kg)</small>';
  }
  lmaEl.innerHTML             = lmaSize;
  display = lmaSize ? 'block' : 'nolmaEl.parentElement.style.ne';

  // — Tidal volume —
  const tvEl = document.getElementById('tidalvolume');
  if (w > 0) {
    const tvMin = Math.round(6 * w),
          tvMax = Math.round(8 * w);
    tvEl.textContent   = `${tvMin}–${tvMax} mL`;
    tvEl.style.display = 'inline';
  } else {
    tvEl.style.display = 'none';
  }
    
    // — Neonates/ARDS tidal volume (4-6 mL/kg) —
const tvArdsEl = document.getElementById('tv-neonates-ards');
if (tvArdsEl) {
  if (w > 0) {
    const tvArdsMin = Math.round(4 * w),
          tvArdsMax = Math.round(6 * w);
    tvArdsEl.textContent   = `${tvArdsMin}–${tvArdsMax} mL`;
    tvArdsEl.style.display = 'inline';
  } else {
    tvArdsEl.textContent   = '';
    tvArdsEl.style.display = 'none';
  }
}

  // — Laryngoscope blade (replace your existing blade logic) —
const laryEl = document.getElementById('laryngoscope');
// 1) clear any previous content
laryEl.innerHTML = '';

if (w > 0) {
  // 2) decide main vs. note text
  let mainText = '';
  let noteText = '';

  if      (w < 1.5) { 
    mainText = 'Miller 00 or 0'; 
    noteText = '(extremely preterm)';
  }
  else if (w < 2.5) { 
    mainText = 'Mac 0 / Miller 0'; 
    noteText = '(preterm)';
  }
  else if (w < 4)   { 
    mainText = 'Mac 0–1 / Miller 0–1'; 
  }
  else if (w < 6)   { 
    mainText = 'Mac 1 / Miller 1'; 
    noteText = '(1–6 mo)';
  }
  else if (w < 12)  { 
    mainText = 'Mac 1–2 / Miller 1–2'; 
    noteText = '(6 mo–2 y)';
  }
  else if (w < 30)  { mainText = 'Mac 2';    noteText = '(2–10 y)'; }
  else if (w <= 60) { mainText = 'Mac 3';    noteText = '()>10 y)'; }
  else              { mainText = 'Mac 3–4';  noteText = '(adult)'; }

  // 3) show container as inline-block so it can stack children
  laryEl.style.display = 'inline-block';

  // 4) append the main line
  laryEl.appendChild(document.createTextNode(mainText));

  // 5) if there’s a note, force a break and a styled <small>
  if (noteText) {
    laryEl.appendChild(document.createElement('br'));
    const small = document.createElement('small');
    small.textContent = noteText;
    // inline styles (or move to CSS if you prefer)
    small.style.display   = 'block';    
    small.style.marginTop = '2px';
    small.style.fontSize  = '0.8em';
    small.style.color     = '#000000';
    laryEl.appendChild(small);
  }
} else {
  // hide if no weight
  laryEl.style.display = 'none';
}

  // 9) finally, update the drug tables
  updateEmergencyDrugs(w);
  updateGADrugs(w);
  updateAnalgesics(w);
    updatePremedication(w);
    updateReversal(w);
    updateAntibiotics(w);
}
  
function updateEmergencyDrugs(w) {
  // Helper that removes any old <em>…</em> from previous runs
  function clearOldLine(id) {
    const el = document.getElementById(id);
    if (el) {
      el.textContent = '';
    }
  }

  // 1) Clear out all “-vol-extra” <small> cells first
  [
    'fentanyl-vol-extra',
    'ketamine-vol-extra',
    'rocuronium-vol-extra',
    'atropine-vol-extra',
    'adrenalineiv-vol-extra',
    'sux-iv-vol-extra',
    'sux-im-vol-extra'
  ].forEach(clearOldLine);

  // 2) Grab all the numeric <span> elements for the emergency drugs
  const fentanylEl   = document.getElementById('fentanyl'),
        ketamineEl   = document.getElementById('ketamine'),
        rocuroniumEl = document.getElementById('rocuronium'),
        atropineEl   = document.getElementById('atropine'),
        suxIvEl      = document.getElementById('sux-iv'),
        suxImEl      = document.getElementById('sux-im'),
        defibEl      = document.getElementById('defib'),
        adrenalineEl = document.getElementById('adrenalineiv');

  // 3) Grab each “vol-extra” <small> placeholder
  const fentanylExtra   = document.getElementById('fentanyl-vol-extra'),
        ketamineExtra   = document.getElementById('ketamine-vol-extra'),
        rocuroniumExtra = document.getElementById('rocuronium-vol-extra'),
        atropineExtra   = document.getElementById('atropine-vol-extra'),
        adrenalineExtra = document.getElementById('adrenalineiv-vol-extra'),
        suxIvExtra      = document.getElementById('sux-iv-vol-extra'),
        suxImExtra      = document.getElementById('sux-im-vol-extra');

  if (w > 0 && !isNaN(w)) {
    // — FENTANYL: 1–2 mcg/kg @ 50 mcg/mL —
    const fMin     = 1   * w,                  // in mcg
          fMax     = 2   * w,                  // in mcg
          fVolMin  = (fMin   / 50).toFixed(2),  // in mL
          fVolMax  = (fMax   / 50).toFixed(2);  // in mL

    // Write the numeric dose (mcg) + unit
    fentanylEl.textContent   = `${stripZeros(fMin.toFixed(1))}–${stripZeros(fMax.toFixed(1))}`;
    fentanylEl.style.display = 'inline';
    fentanylEl.nextElementSibling.style.display = 'inline'; // “ mcg”

    // Put the “(X–Y mL of 50 mcg/mL)” inside <small id="fentanyl-vol-extra">
    fentanylExtra.innerHTML = `<em>${stripZeros(fVolMin)}–${stripZeros(fVolMax)} mL of 50 mcg/mL</em>`;

    // — KETAMINE: 1–2 mg/kg @ 10 mg/mL —
    const kMin     = 1   * w,                 // mg
          kMax     = 2   * w,                 // mg
          kVolMin  = (kMin   / 10).toFixed(2), // mL
          kVolMax  = (kMax   / 10).toFixed(2); // mL

    ketamineEl.textContent   = `${stripZeros(kMin.toFixed(1))}–${stripZeros(kMax.toFixed(1))}`;
    ketamineEl.style.display = 'inline';
    ketamineEl.nextElementSibling.style.display = 'inline'; // “ mg”

    ketamineExtra.innerHTML = `<em>${stripZeros(kVolMin)}–${stripZeros(kVolMax)} mL of 10 mg/mL</em>`;

    // — ROCURONIUM: 1 mg/kg @ 10 mg/mL —
    const rDose    = 1   * w,                 // mg
          rVol     = (rDose / 10).toFixed(2);  // mL

    rocuroniumEl.textContent   = stripZeros(rDose.toFixed(1));
    rocuroniumEl.style.display = 'inline';
    rocuroniumEl.nextElementSibling.style.display = 'inline'; // “ mg”

    rocuroniumExtra.innerHTML = `<em>${stripZeros(rVol)} mL of 10 mg/mL</em>`;

    // — ATROPINE: 20 mcg/kg @ 600 mcg/mL —
    const aDose    = 20  * w,                   // mcg
          aVol     = (aDose / 600).toFixed(2);    // mL

    atropineEl.textContent   = stripZeros(aDose.toFixed(1));
    atropineEl.style.display = 'inline';
    atropineEl.nextElementSibling.style.display = 'inline'; // “ mcg”

    atropineExtra.innerHTML = `<em>${stripZeros(aVol)} mL of 600 mcg/mL</em>`;

    // — SUXAMETHONIUM IV: 1–2 mg/kg @ 50 mg/mL —
    const sIVmin   = 1   * w,                // mg
          sIVmax   = 2   * w,                // mg
          ivVolMin = (sIVmin  / 50).toFixed(2), // mL
          ivVolMax = (sIVmax  / 50).toFixed(2); // mL

    suxIvEl.textContent   = `${stripZeros(sIVmin.toFixed(1))}–${stripZeros(sIVmax.toFixed(1))}`;
    suxIvEl.style.display = 'inline';
    suxIvEl.nextElementSibling.style.display = 'inline'; // “ mg”

    suxIvExtra.innerHTML = `<em>${stripZeros(ivVolMin)}–${stripZeros(ivVolMax)} mL of 50 mg/mL</em>`;

    // — SUXAMETHONIUM IM: 4 mg/kg (max 150 mg) @ 50 mg/mL —
    let imDose = 4 * w;
    if (imDose > 150) imDose = 150;
    const imVol = (imDose / 50).toFixed(2); // mL

    suxImEl.textContent   = stripZeros(imDose.toFixed(1));
    suxImEl.style.display = 'inline';
    suxImEl.nextElementSibling.style.display = 'inline'; // “ mg”

    suxImExtra.innerHTML = `<em>${stripZeros(imVol)} mL of 50 mg/mL</em>`;

    // — DEFIBRILLATION ENERGY 4 J/kg — (no “of X” needed; it’s joules)
    const defibDose = 4 * w; // J
    defibEl.textContent     = stripZeros(defibDose.toFixed(1));
    defibEl.style.display   = 'inline';
    defibEl.nextElementSibling.style.display = 'inline'; // “ J”

    // — ADRENALINE IV 1:10,000 is 0.1 mg/mL; dose = 0.1 mL/kg × w —
    const adrVol = (0.1 * w).toFixed(2), // mL
          adrMg  = (adrVol * 0.1).toFixed(2); // mg

    adrenalineEl.textContent   = stripZeros(adrVol); 
    adrenalineEl.style.display = 'inline';
    adrenalineEl.nextElementSibling.style.display = 'inline'; // “ mL”

    adrenalineExtra.innerHTML = `<em>${stripZeros(adrVol)} mL of 0.1 mg/mL</em>`;

// — FLUID BOLUS 10–20 mL/kg —
    const bolusEl   = document.getElementById('fluidbolus'),
          bolusUnit = bolusEl.nextElementSibling; // “ mL”
    const bolusMin  = Math.round(10 * w),
          bolusMax  = Math.round(20 * w);

    bolusEl.textContent    = `${bolusMin}–${bolusMax}`;
    bolusEl.style.display  = 'inline';
    if (bolusUnit && bolusUnit.classList.contains('unit')) {
      bolusUnit.style.display = 'inline';
    }

    // — GLUCOSE 10% 2 mL/kg —
    const glucoseEl   = document.getElementById('glucose10'),
          glucoseUnit = glucoseEl.nextElementSibling; // “ mL”
    const gluDose     = stripZeros((2 * w).toFixed(1));

    glucoseEl.textContent    = gluDose;
    glucoseEl.style.display  = 'inline';
    if (glucoseUnit && glucoseUnit.classList.contains('unit')) {
      glucoseUnit.style.display = 'inline';
    }
  }
  else {
    // hide fentanyl/ketamine/etc.
    [fentanylEl, ketamineEl, rocuroniumEl,
     atropineEl, suxIvEl, suxImEl,
     defibEl, adrenalineEl].forEach(el => {
      el.style.display = 'none';
      const unitSpan = el.nextElementSibling;
      if (unitSpan && unitSpan.classList.contains('unit')) {
        unitSpan.style.display = 'none';
      }
    });
    // clear all “-vol-extra” text
    [fentanylExtra, ketamineExtra, rocuroniumExtra,
     atropineExtra, adrenalineExtra, suxIvExtra, suxImExtra]
      .forEach(clearOldLine);

    // hide bolus/glucose
    const bolusEl   = document.getElementById('fluidbolus'),
          bolusUnit = bolusEl.nextElementSibling;
    bolusEl.style.display = 'none';
    if (bolusUnit && bolusUnit.classList.contains('unit')) {
      bolusUnit.style.display = 'none';
    }

    const glucoseEl   = document.getElementById('glucose10'),
          glucoseUnit = glucoseEl.nextElementSibling;
    glucoseEl.style.display = 'none';
    if (glucoseUnit && glucoseUnit.classList.contains('unit')) {
      glucoseUnit.style.display = 'none';
    }
  }
}
  
    function updateGADrugs(w) {
  // 1) first, clear out any old “extra” notes
  [
    'fentanyl-ga-extra',
    'propofol-ga-extra',
    'rocuronium-ga-extra',
    'ondansetron-ga-extra',
    'dexamethasone-ga-extra'
  ].forEach(extraId => {
    const el = document.getElementById(extraId);
    if (el) el.textContent = '';
  });
      
       const rawAge = parseFloat(ageInput.value) || 0;
  const ageY = ageUnit === 'months' ? rawAge/12 : rawAge;
      
 // ATROPINE
document.querySelectorAll('.atropine-dose').forEach(el => {
  // 20 mcg/kg @ 600 mcg/mL
  const doseMcg = 20 * w;                 // in mcg
  const doseText = stripZeros(doseMcg.toFixed(1));
  el.textContent   = doseText;
  el.style.display = 'inline';
  const unit = el.nextElementSibling;
  if (unit && unit.classList.contains('unit')) {
    unit.style.display = 'inline';
  }
});
document.querySelectorAll('.atropine-extra').forEach(el => {
  // volume in mL
  const vol = stripZeros(((20 * w) / 600).toFixed(2));
  el.textContent = `${vol} mL of 600 mcg/mL`;
});

// SUXAMETHONIUM IV (1–2 mg/kg @ 50 mg/mL)
document.querySelectorAll('.sux-iv-dose').forEach(el => {
  const minDose = 1 * w;   // mg
  const maxDose = 2 * w;
  const doseText = (Math.abs(minDose - maxDose) < 0.01)
    ? stripZeros(minDose.toFixed(1))
    : `${stripZeros(minDose.toFixed(1))}–${stripZeros(maxDose.toFixed(1))}`;
  el.textContent   = doseText;
  el.style.display = 'inline';
  const unit = el.nextElementSibling;
  if (unit && unit.classList.contains('unit')) {
    unit.style.display = 'inline';
  }
});
document.querySelectorAll('.sux-iv-extra').forEach(el => {
  const minVol = stripZeros(((1 * w) / 50).toFixed(2));
  const maxVol = stripZeros(((2 * w) / 50).toFixed(2));
  el.textContent = `${minVol}–${maxVol} mL of 50 mg/mL`;
});

// SUXAMETHONIUM IM (4 mg/kg, capped at 150 mg @ 50 mg/mL)
document.querySelectorAll('.sux-im-dose').forEach(el => {
  let dose = 4 * w;
  if (dose > 150) dose = 150;
  const doseText = stripZeros(dose.toFixed(1));
  el.textContent   = doseText;
  el.style.display = 'inline';
  const unit = el.nextElementSibling;
  if (unit && unit.classList.contains('unit')) {
    unit.style.display = 'inline';
  }
});
document.querySelectorAll('.sux-im-extra').forEach(el => {
  let dose = 4 * w;
  if (dose > 150) dose = 150;
  const vol = stripZeros((dose / 50).toFixed(2));
  el.textContent = `${vol} mL of 50 mg/mL`;
});
      
       // — Cyclizine (0.5–1 mg/kg; max 25 mg <12 y; 50 mg ≥12 y; 50 mg/mL) —
  const cylEl    = document.getElementById('cyclizine');
  const cylUnit  = cylEl.nextElementSibling;     // “mg”
  const cylNote  = document.getElementById('cyclizine-ga-extra');
  if (w > 0 && !isNaN(w)) {
    // compute uncapped range
    let minD = 0.5 * w;
    let maxD = 1.0 * w;
    // apply the caps
    const cap = ageY < 12 ? 25 : 50;
    if (minD > cap) minD = cap;
    if (maxD > cap) maxD = cap;
    // render dose text
    const doseText = (Math.abs(minD - maxD) < 0.01)
      ? stripZeros(minD.toFixed(2))
      : `${stripZeros(minD.toFixed(2))}–${stripZeros(maxD.toFixed(2))}`;
    cylEl.textContent   = doseText;
    cylEl.style.display = 'inline';
    if (cylUnit && cylUnit.classList.contains('unit')) {
      cylUnit.style.display = 'inline';
    }
    // volume at 50 mg/mL
    const vMin = (minD / 50).toFixed(2);
    const vMax = (maxD / 50).toFixed(2);
    const volText = (minD === maxD)
      ? `${stripZeros(vMin)} mL of 50 mg/mL`
      : `${stripZeros(vMin)}–${stripZeros(vMax)} mL of 50 mg/mL`;
    cylNote.textContent = volText;
  } else {
    // hide if no weight
    cylEl.textContent   = '';
    cylEl.style.display = 'none';
    if (cylUnit && cylUnit.classList.contains('unit')) {
      cylUnit.style.display = 'none';
    }
    cylNote.textContent = '';
  }

  // 2) list of GA drugs + their dosing/concentration info
  const drugs = [
    { 
      id:           'fentanyl-ga',
      minDose:      1,    // mcg/kg
      maxDose:      2,    // mcg/kg
      conc:         50,   // mcg per mL
      unitLabel:    'mcg',
      extraId:      'fentanyl-ga-extra'
    },
    {
      id:           'propofol',
      minDose:      3,    // mg/kg
      maxDose:      5,    // mg/kg
      conc:         10,   // mg per mL
      unitLabel:    'mg',
      extraId:      'propofol-ga-extra'
    },
    {
      id:           'rocuronium-ga',
      minDose:      0.6,  // mg/kg  (single‐value)
      maxDose:      0.6,  // same
      conc:         10,   // mg per mL
      unitLabel:    'mg',
      extraId:      'rocuronium-ga-extra'
    },
    {
      id:           'ondansetron',
      minDose:      0.15, // mg/kg
      maxDose:      0.15, // same
      conc:         2,    // mg per mL
      unitLabel:    'mg',
      extraId:      'ondansetron-ga-extra'
    },
    {
      id:           'dexamethasone',
      minDose:      0.15, // mg/kg
      maxDose:      0.15, // same
      conc:         3.3,  // mg per mL
      unitLabel:    'mg',
      extraId:      'dexamethasone-ga-extra'
    }
  ];

  // 3) if w > 0, populate each dose AND its colspan-3 “extra” cell
  if (w > 0 && !isNaN(w)) {
    drugs.forEach(({ id, minDose, maxDose, conc, unitLabel, extraId }) => {
      // a) compute dose text
      const dMin    = stripZeros((minDose * w).toFixed(1));
      const dMax    = stripZeros((maxDose * w).toFixed(1));
      const doseText = (minDose === maxDose) ? dMin : `${dMin}–${dMax}`;

      // b) write dose into the <span id="…"> and show its unit
      const spanEl  = document.getElementById(id);
      const unitSpan= spanEl.nextElementSibling; // the “ mg” or “ mcg”
      spanEl.textContent       = doseText;
      spanEl.style.display     = 'inline';
      if (unitSpan && unitSpan.classList.contains('unit')) {
        unitSpan.style.display = 'inline';
      }

      // c) compute volume (ml) text
      //    if min === max, single value; otherwise “X–Y”
      const vMin    = stripZeros((dMin / conc).toFixed(2));
      const vMax    = stripZeros((dMax / conc).toFixed(2));
      const volText = (minDose === maxDose) ? `${vMin}` : `${vMin}–${vMax}`;

      // d) write into the colspan-3 <small id="…-extra">
      const extraEl = document.getElementById(extraId);
      extraEl.innerHTML = `<em>${volText} mL of ${conc}${unitLabel}/mL</em>`;
    });
  }
  else {
    // 4) if no valid weight, hide all dose spans + units, leave extras blank
    drugs.forEach(({ id, extraId }) => {
      const spanEl = document.getElementById(id);
      spanEl.style.display = 'none';
      const unitSpan = spanEl.nextElementSibling;
      if (unitSpan && unitSpan.classList.contains('unit')) {
        unitSpan.style.display = 'none';
      }
      // extra cell was already cleared at top
    });
  }
}

function updateAntibiotics(w) {
  const meds = [
    { id: 'amoxicillin',    dosePerKg: 30, max: 1000 },
    { id: 'cefuroxime',     dosePerKg: 50, max: 1500 },
    { id: 'co-amoxiclav',   dosePerKg: 30, max: 1200 },
    { id: 'flucloxacillin', dosePerKgMin: 12.5, dosePerKgMax: 25, max: 1000 },
    { id: 'gentamicin',     dosePerKg: 2,  max: 480 }
  ];

  meds.forEach(m => {
    const el       = document.getElementById(m.id);
    const unitSpan = el.nextElementSibling; // the “mg” span
    let text        = '';

    if (w > 0 && !isNaN(w)) {
      if (m.dosePerKg) {
        let dose = m.dosePerKg * w;
        if (m.max) dose = Math.min(dose, m.max);
        text = stripZeros(dose.toFixed(2));
      } else {
        // flucloxacillin range
        const min = m.dosePerKgMin * w;
        const max = m.dosePerKgMax * w;
        let txt = `${stripZeros(min.toFixed(2))}–${stripZeros(max.toFixed(2))}`;
        if (m.max && max > m.max) {
          txt = `${stripZeros(Math.min(min, m.max).toFixed(2))}–${stripZeros(m.max.toFixed(2))}`;
        }
        text = txt;
      }
    }

    if (text) {
      el.textContent       = text;
      el.style.display     = 'inline';
      if (unitSpan) unitSpan.style.display = 'inline';
    } else {
      el.textContent       = '';
      el.style.display     = 'none';
      if (unitSpan) unitSpan.style.display = 'none';
    }
  });
}  
  
  // event wiring
  unitBtn.addEventListener('click', toggleAgeUnit);
  
 estToggle.addEventListener('change', () => {
   autoEstimate = estToggle.checked;

   if (autoEstimate) {
     weightIn.disabled = true;
     // Immediately estimate (if age is valid)
     const n = parseFloat(ageInput.value);
     if (!isNaN(n) && n >= 0) {
       estimateWeight();
     }
   } else {
     weightIn.disabled = false;
     // Do not clear existing outputs; user can manually type weight
   }
 });

 ageInput.addEventListener('input', () => {
  const rawAge = ageInput.value.trim();
  const rawW   = weightIn.value.trim();
   const n      = parseFloat(rawAge);
  const ageY   = (ageUnit === 'months') ? (n / 12) : n;

  // — IF age > 14: disable auto-estimate, clear weight, and bail out —
  if (!isNaN(ageY) && ageY > 14) {
    estToggle.checked    = false;
    autoEstimate         = false;
    weightIn.disabled    = false;
    weightIn.value       = '';
    weightIn.placeholder = '0';
    clearWeight();
    return;
  }

    if (autoEstimate) {                            // ← ADD this entire if‐block
    const n = parseFloat(rawAge);
    if (!isNaN(n) && n >= 0) {
      estimateWeight();
    } else {
      clearWeight();
    }
    return;
  }
   
  // ── If age is entered but weight is blank → clear everything and stop ──
  if (rawAge !== '' && rawW === '') {
    return clearWeight();
  }

  // ── If both age and weight are blank → clear everything and stop ──
  if (rawAge === '' && rawW === '') {
    return clearWeight();
  }

  // At this point: either both age & weight exist, or weight exists and age blank.

  // Parse age
  const a = parseFloat(rawAge);
  if (isNaN(a)) {
    return clearWeight();
  }

  // Convert age to “years” for airway/centiles
  const y = (ageUnit === 'months') ? (a / 12) : a;

  updateAirwayCalculations(y);

  const normals = getNormalValues(a, ageUnit);
  if (normals) {
    updateNormalCentiles(normals);
  }

  expandOpenAccordion();
});

  weightIn.addEventListener('input', () => {
     if (autoEstimate) {                            // ← ADD this line
    return;                                      // ← ADD: do nothing if Auto is ON
  }
    
    // 1) if no age has been entered, treat it as zero
  // ── NEW: if no age entered, assume age = 0 only if weight < 5kg ──
  const rawAge = ageInput.value.trim();
  const rawW   = weightIn.value.trim();

  if (rawW === '') {
    // if weight is blank, nothing to show
    return clearWeight();
  }

  // parse weight now that we know it's non‐blank
  const w = parseFloat(rawW);
  if (isNaN(w)) {
    return clearWeight();
  }

  if (rawAge === '') {
    // age was blank: only proceed if weight < 5 kg
    if (w < 5) {
      ageInput.value = '0';      // ← assume neonate
    } else {
      // if weight ≥ 5kg and no age → show nothing
      return clearWeight();
    }
  }
    const a    = parseFloat(ageInput.value),
      wnum = parseFloat(weightIn.value);
    if(isNaN(a)||isNaN(w)) return clearWeight();
    const y = ageUnit==='months'? a/12 : a;
    updateAirwayCalculations(y);
    const normals = getNormalValues(a, ageUnit);
    if(normals) updateNormalCentiles(normals);

    let disp = '', m = ageUnit==='months'? a : a*12;
    if(m<12) {
      const e = 0.5*m+4;
      if(Math.abs(e-w)<0.2) disp = `<p>(0.5 × Age in months) + 4 = ${stripZeros(w.toFixed(1))} <span class="unit">kg</span></p>`;
    } else {
      const e1 = 2*y+8;
      if(Math.abs(e1-w)<0.2) disp = `<p>(2 × Age) + 8 = ${stripZeros(w.toFixed(1))} <span class="unit">kg</span></p>`;
      else if(y>=6) {
        const e2 = 3*y+7;
        if(Math.abs(e2-w)<0.2) disp = `<p>(3 × Age) + 7 = ${stripZeros(w.toFixed(1))} <span class="unit">kg</span></p>`;
      }
    }
    calcDiv.innerHTML = disp;
     expandOpenAccordion();
  });

  document.addEventListener('DOMContentLoaded', () => {
  clearWeight();
  weightIn.disabled = true;          // ← ADD: make sure weight is editable by default
  estToggle.checked = true;    // ← ADD: initial button text
});
  
  // Reset everything back to the initial state
function resetForm() {
  // 1) clear the inputs
  ageInput.value = '';
  weightIn.value = '';
  // 2) reset the toggle back to years
  ageUnit = 'years';
  unitBtn.textContent = 'years';
  // 3) hide all existing outputs
  clearWeight();
  
   updateAntibiotics(0);
  
// 4) collapse any open accordion panels
  document.querySelectorAll('.accordion-header.active').forEach(header => {
    header.classList.remove('active');
    const content = header.nextElementSibling; // the .accordion-content
    content.classList.remove('show');
    content.style.maxHeight = null;
  });
  
}

// Optional: home button handler if you want
function goHome() {
  window.location.href = '/'; // or 'index.html'
}
  
  document.querySelectorAll('.accordion-header').forEach(header => {

    header.addEventListener('click', () => {

      const content = header.nextElementSibling;

      const isOpen = content.classList.contains('show');

      header.classList.toggle('active');

      content.classList.toggle('show');

      // Remove inline max-height after animation for better reset

      if (!isOpen) {

        content.style.maxHeight = content.scrollHeight + "px";

      } else {

        content.style.maxHeight = null;

      }

    });

  });

function expandOpenAccordion() {
  document.querySelectorAll('.accordion-content.show').forEach(content => {
    // clear any old inline height so the browser can re-measure
    content.style.maxHeight = null;
    // then set to its new scrollHeight
    content.style.maxHeight = content.scrollHeight + 'px';
  });
}
  
</script>

</body>
</html>
