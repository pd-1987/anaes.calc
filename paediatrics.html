<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Paediatric anaesthetic calculator</title>
  <link rel="stylesheet" href="styles.css" />
  <link
    href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700&display=swap"
    rel="stylesheet"
  />
  <link
    href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap"
    rel="stylesheet"
  />
  <style>
    header.banner {
      background: linear-gradient(130deg, #E65100 0%, #F57C00 100%);
    }
    .unit-toggle, .estimate-btn {
      font-size: 16px;
      margin: 5px;
      padding: 4px 8px;
      cursor: pointer;
    }
    .estimate-btn {
      background: #f0f0f0;
      border: 1px solid #ccc;
      border-radius: 5px;
      width: 80px;
    }
    .unit-toggle {
      width: 80px;
    }
    /* new styles for the calculation display */
    #weight-calculations {
      margin: 8px 5px;
      font-family: inherit;
      line-height: 1.4;
      font-size: 12px;
    }
    #weight-calculations p {
      margin: 2px 0;
    }
    .unit {
      font-weight: 700;
    }
    .normal-values {
  font-family: inherit;
      margin: 0 auto 20px auto;
      padding: 15px;
      border: 1px solid #ccc;
      border-radius: 10px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      background-color: #fff;
      box-sizing: border-box;
}
     .airway-section {
  font-family: inherit;
      margin: 0 auto 20px auto;
      padding: 15px;
      border: 1px solid #ccc;
      border-radius: 10px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      background-color: #fff;
      box-sizing: border-box;
}
    .section {
      margin: 0 auto 20px auto;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 10px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      background-color: #fff;
      box-sizing: border-box;
    }
      .section-header {
      font-weight: 700;
        text-align: center;
        margin: 0 0 10px;
    }
    .normal-values .static {
  display: none;
}
.result {
  font-size: 16px;
  font-weight: 400;
  color: #000;
  margin: 5px;
}
    .normal-values .result:first-child {
  margin-top: 0;
}
    .input-group {
  display: flex;
  align-items: center;
  margin: 5px;
}
  </style>
</head>
<body>
  <header class="banner">Paediatric anaesthesia</header>

  <div class="section">
  <div class="input-group">
    <label for="age">Age:</label>
    <input type="number" id="age" min="0" placeholder="0" />
    <button class="unit-toggle" id="AgeUnitBtn">years</button>
  </div>

  <div class="input-group">
    <label for="weight">Weight (kg):</label>
    <input type="number" id="weight" min="0" placeholder="0" />
    <button class="estimate-btn" id="EstimateBtn">Estimate</button>
  </div>

  <!-- new container for showing the two formula lines -->
  <div id="weight-calculations"></div>
  </div>
    
    <!-- Paediatric normal values -->
  <div class="normal-values">
    <div class="section-header"><u>Normal physiological values</u></div>
  <div class="result">
    <strong>SBP</strong>:
  <span id="sbp-50"></span>
    <span class="static unit"> mmHg</span>
  <span class="static">(</span>
    <span id="sbp-5"></span>
    <span class="static">–</span>
    <span id="sbp-95"></span>
    
  <span class="static"><span class="static unit"> mmHg</span>)</span>
</div>

  <div class="result">
    <strong>HR</strong>:
  <span id="hr-5"></span>
  <span class="static">–</span>
  <span id="hr-95"></span>
  <span class="static unit"> bpm</span>
</div>
    
  <div class="result">
    <strong>RR</strong>:
  <span id="rr-5"></span>
  <span class="static">–</span>
  <span id="rr-95"></span>
  <span class="static unit"> bpm</span>
</div>
</div>

  <div class="airway-section">
      <div class="section-header"><u>Airway and Ventilation</u></div>
<div class="result">
  <strong>ETT size</strong>:
  <div>
    <span id="ett-uncuffed"></span>
    <small id="uncuffed-label">(Uncuffed)</small>
  </div>
  <div>
    <span id="ett-cuffed"></span>
    <small id="cuffed-label">(Cuffed)</small>
  </div>
</div>
    <div class="result"><strong>ETT length at lips</strong>:
   <span id="ett-length"></span>
    <span class="static unit"> cm</span></div>
    
    <div class="result"><strong>LMA size</strong>:
  <span id="lma"></span></div>
    <div class="result">
  <strong>i-Gel size</strong>:
  <div><span id="igel"></span></div>
</div> 
  </div>
  
   <div class="section">
    Emergencies
  </div>
   <div class="section">
    Routine General Anaesthetic
  </div>
  
   <div class="button-container" style="text-align: center; margin-bottom: 20px;">
    <button type="button" class="reset-btn" onclick="resetForm()">Reset</button>
    <button type="button" class="home-btn" onclick="goHome()">Home</button>
  </div>
  
  <footer>
    <small>
      <p>SBP: Systolic blood pressure; HR: Heart rate; RR: Respiratory rate; ETT: Endotracheal tube; LMA: Laryngeal mask airway</p>
      <p>
        <a href="references.html">References</a> - 
        <a href="disclaimer.html">Disclaimer</a>
      </p>
      <p>&copy; 2025 #OneTeam Anaesthesia. All rights reserved.</p>
    </small>
  </footer>

<script>
  let ageUnit = 'years';

  // grab your nodes once
  const ageInput = document.getElementById('age');
  const weightIn = document.getElementById('weight');
  const unitBtn  = document.getElementById('AgeUnitBtn');
  const estBtn   = document.getElementById('EstimateBtn');
  const calcDiv  = document.getElementById('weight-calculations');

  // clear everything and hide all outputs
  function clearWeight() {
    calcDiv.innerHTML = '';
    ['sbp-5','sbp-50','sbp-95','hr-5','hr-95','rr-5','rr-95',
     'ett-uncuffed','ett-cuffed','ett-length','igel'
    ].forEach(id => document.getElementById(id).textContent = '');

    document.querySelectorAll('.normal-values .static')
    .forEach(el => el.style.display = 'none');

  }

  // toggle years ↔ months
  function toggleAgeUnit() {
    clearWeight();
    const raw = ageInput.value.trim();
    const n   = parseFloat(raw);
    if (ageUnit === 'years') {
      ageUnit = 'months';
      unitBtn.textContent = 'months';
      ageInput.value = raw!=='' && !isNaN(n) ? Math.round(n*12) : '';
    } else {
      ageUnit = 'years';
      unitBtn.textContent = 'years';
      ageInput.value = raw!=='' && !isNaN(n) ? Math.round((n/12)*10)/10 : '';
    }
  }

  // estimate weight button
  function estimateWeight() {
    clearWeight();
    const a = parseFloat(ageInput.value);
    if (isNaN(a) || a<0) { alert('Please enter a valid age.'); return; }
    const m = ageUnit==='months' ? a : a*12;
    if (m < 12) {
      const w = Math.round((0.5*m+4)*10)/10;
      weightIn.value = w;
      calcDiv.innerHTML = `<p>(0.5 × Age in months) + 4 = ${w} <span class="unit">kg</span></p>`;
      return;
    }
    const y = m/12;
    if (y <= 14) {
      const w1 = Math.round((2*y+8)*10)/10;
      let html = `<p>(2 × Age) + 8 = ${w1} <span class="unit">kg</span></p>`;
      if (y>=6) {
        const w2 = Math.round((3*y+7)*10)/10;
        html += `<p>(3 × Age) + 7 = ${w2} <span class="unit">kg</span></p>`;
      }
      weightIn.value = w1;
      calcDiv.innerHTML = html;
      return;
    }
    alert('Age must be between 0 months and 14 years to estimate weight.');
  }

  // paediatric normals table
  const paediatricNormals = {
    0:   { respRate:[25,50], heartRate:[120,170], bp:{p5:65, p50:85, p95:105} },
    1:   { respRate:[25,50], heartRate:[120,170], bp:{p5:65, p50:85, p95:105} },
    3:   { respRate:[25,45], heartRate:[115,160], bp:{p5:65, p50:85, p95:105} },
    6:   { respRate:[20,40], heartRate:[110,160], bp:{p5:65, p50:85, p95:105} },
    12:  { respRate:[20,40], heartRate:[110,160], bp:{p5:70, p50:90, p95:105} },
    18:  { respRate:[20,35], heartRate:[100,155], bp:{p5:70, p50:90, p95:105} },
    24:  { respRate:[20,30], heartRate:[100,150], bp:{p5:70, p50:90, p95:110} },
    36:  { respRate:[20,30], heartRate:[90,140],  bp:{p5:70, p50:90, p95:110} },
    48:  { respRate:[20,30], heartRate:[80,135],  bp:{p5:70, p50:90, p95:110} },
    60:  { respRate:[20,30], heartRate:[80,135],  bp:{p5:80, p50:95, p95:120} },
    72:  { respRate:[20,30], heartRate:[80,130],  bp:{p5:80, p50:95, p95:120} },
    84:  { respRate:[20,30], heartRate:[80,130],  bp:{p5:80, p50:95, p95:120} },
    96:  { respRate:[15,25], heartRate:[70,120],  bp:{p5:80, p50:95, p95:120} },
    108: { respRate:[15,25], heartRate:[70,120],  bp:{p5:80, p50:95, p95:120} },
    120: { respRate:[15,25], heartRate:[70,120],  bp:{p5:80, p50:95, p95:120} },
    132: { respRate:[15,25], heartRate:[70,120],  bp:{p5:80, p50:95, p95:120} },
    144: { respRate:[12,24], heartRate:[65,115],  bp:{p5:90, p50:110,p95:140} },
    168: { respRate:[12,24], heartRate:[60,110],  bp:{p5:90, p50:110,p95:140} }
  };

  // pick the nearest key
  function getNormalValues(age, unit) {
    const months = unit==='months'? age : age*12;
    const keys = Object.keys(paediatricNormals).map(k=>+k).sort((a,b)=>a-b);
    if (months < 12) {
      const mks = keys.filter(k=>k<12);
      return paediatricNormals[mks.reduce((a,b)=>Math.abs(b-months)<Math.abs(a-months)?b:a, mks[0])];
    } else {
      const ideal = Math.floor(months/12)*12;
      const below = keys.filter(k=>k<=ideal);
      const key   = below.length? below.pop() : keys.find(k=>k>=12);
      return paediatricNormals[key];
    }
  }

  // show centiles
  function updateNormalCentiles(n) {
    document.getElementById('sbp-5').textContent   = n.bp.p5;
    document.getElementById('sbp-50').textContent  = n.bp.p50;
    document.getElementById('sbp-95').textContent  = n.bp.p95;
    document.getElementById('hr-5').textContent    = n.heartRate[0];
    document.getElementById('hr-95').textContent   = n.heartRate[1];
    document.getElementById('rr-5').textContent    = n.respRate[0];
    document.getElementById('rr-95').textContent   = n.respRate[1];
    document.querySelectorAll('.normal-values .static')
      .forEach(el => el.style.display='inline');
  }

  // airway calcs (unchanged)
  function updateAirwayCalculations(ageYears) {
    const w = parseFloat(weightIn.value)||0;
    const m = ageUnit==='months'? parseFloat(ageInput.value) : ageYears*12;
    let unc='', cuff='', len='';
    const uncEl  = document.getElementById('ett-uncuffed').parentElement;
    const cuffEl = document.getElementById('ett-cuffed').parentElement;
    const lenUnit= document.querySelector('#ett-length + .unit');

    if (isNaN(m) || m <= 0) {
  uncEl.style.display = 'none';
  cuffEl.style.display = 'none';
  lenUnit && (lenUnit.style.display = 'none');
} else if (m<12) {
      if(w<1) unc=2.5,len=6.5;
      else if(w<2) unc=2.5,len=7;
      else if(w<3) unc=3,len=8;
      else if(w<4) unc=3.5,len=9;
      else unc=4,len=10;
    } else {
      unc  = Math.round((ageYears/4+4)*10)/10;
      cuff = Math.round((ageYears/4+3.5)*10)/10;
      len  = Math.round((ageYears/2+12)*10)/10;
    }

    document.getElementById('ett-uncuffed').textContent = unc;
    document.getElementById('ett-cuffed').textContent   = cuff;
    document.getElementById('ett-length').textContent   = len;
    uncEl.style.display  = unc  ? 'block':'none';
    cuffEl.style.display = cuff ? 'block':'none';
    lenUnit && (lenUnit.style.display = len ? 'inline':'none');

    const igel = (w<=0||isNaN(w))? '' :
      w<=5?'1.0 (Neonate)':
      w<=10?'1.5 (Infant)':
      w<=25?'2.0 (Small Paediatric)':
      w<=35?'2.5 (Large Paediatric)':
      w<=60?'3.0 (Small Adult)':
      w<=90?'4.0 (Medium Adult)':'5.0 (Large Adult)';

    document.getElementById('igel').textContent = igel;
    document.getElementById('igel').parentElement.style.display = igel? 'block':'none';
  }

  // event wiring
  unitBtn.addEventListener('click', toggleAgeUnit);
  estBtn .addEventListener('click', () => {
    estimateWeight();
    const a = parseFloat(ageInput.value)||0,
          y = ageUnit==='months'? a/12 : a;
    const normals = getNormalValues(a, ageUnit);
    if(normals) updateNormalCentiles(normals);
    if(!isNaN(y)) updateAirwayCalculations(y);
  });

  ageInput.addEventListener('input', () => {
    const a = parseFloat(ageInput.value);
    if(isNaN(a)) return clearWeight();
    const y = ageUnit==='months'? a/12 : a;
    updateAirwayCalculations(y);
    const normals = getNormalValues(a, ageUnit);
    if(normals) updateNormalCentiles(normals);
  });

  weightIn.addEventListener('input', () => {
    const a = parseFloat(ageInput.value),
          w = parseFloat(weightIn.value);
    if(isNaN(a)||isNaN(w)) return clearWeight();
    const y = ageUnit==='months'? a/12 : a;
    updateAirwayCalculations(y);
    const normals = getNormalValues(a, ageUnit);
    if(normals) updateNormalCentiles(normals);

    let disp = '', m = ageUnit==='months'? a : a*12;
    if(m<12) {
      const e = 0.5*m+4;
      if(Math.abs(e-w)<0.2) disp = `<p>(0.5 × Age in months) + 4 = ${w.toFixed(1)} <span class="unit">kg</span></p>`;
    } else {
      const e1 = 2*y+8;
      if(Math.abs(e1-w)<0.2) disp = `<p>(2 × Age) + 8 = ${w.toFixed(1)} <span class="unit">kg</span></p>`;
      else if(y>=6) {
        const e2 = 3*y+7;
        if(Math.abs(e2-w)<0.2) disp = `<p>(3 × Age) + 7 = ${w.toFixed(1)} <span class="unit">kg</span></p>`;
      }
    }
    calcDiv.innerHTML = disp;
  });

  document.addEventListener('DOMContentLoaded', clearWeight);
  
  // Reset everything back to the initial state
function resetForm() {
  // 1) clear the inputs
  ageInput.value = '';
  weightIn.value = '';
  // 2) reset the toggle back to years
  ageUnit = 'years';
  unitBtn.textContent = 'years';
  // 3) hide all existing outputs
  clearWeight();
}

// Optional: home button handler if you want
function goHome() {
  window.location.href = '/'; // or 'index.html'
}
  
</script>

</body>
</html>
