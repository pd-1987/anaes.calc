<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Paediatric anaesthetic calculator</title>
  <link rel="stylesheet" href="styles.css" />
  <link
    href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700&display=swap"
    rel="stylesheet"
  />
  <link
    href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap"
    rel="stylesheet"
  />
  <style>
    header.banner {
      background: linear-gradient(130deg, #E65100 0%, #F57C00 100%);
    }
    .unit-toggle, .estimate-btn {
      font-size: 16px;
      margin: 5px;
      padding: 4px 8px;
      cursor: pointer;
    }
    .estimate-btn {
      background: #f0f0f0;
      border: 1px solid #ccc;
      border-radius: 5px;
      width: 80px;
    }
    .unit-toggle {
      width: 80px;
    }
    /* new styles for the calculation display */
    #weight-calculations {
      margin: 8px 5px;
      font-family: inherit;
      line-height: 1.4;
      font-size: 12px;
    }
    #weight-calculations p {
      margin: 2px 0;
    }
    .unit {
      font-weight: 700;
    }
    .normal-values {
  font-family: inherit;
      margin: 0 auto 20px auto;
      padding: 15px;
      border: 1px solid #ccc;
      border-radius: 10px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      background-color: #fff;
      box-sizing: border-box;
}
     .airway-section {
  font-family: inherit;
      margin: 0 auto 20px auto;
      padding: 15px;
      border: 1px solid #ccc;
      border-radius: 10px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      background-color: #fff;
      box-sizing: border-box;
}
    .emergency-section {
  font-family: inherit;
      margin: 0 auto 20px auto;
      padding: 15px;
      border: 1px solid #ccc;
      border-radius: 10px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      background-color: #fff;
      box-sizing: border-box;
}
        .general-section {
  font-family: inherit;
      margin: 0 auto 20px auto;
      padding: 15px;
      border: 1px solid #ccc;
      border-radius: 10px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      background-color: #fff;
      box-sizing: border-box;
}
    .section {
      margin: 0 auto 20px auto;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 10px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      background-color: #fff;
      box-sizing: border-box;
    }
      .section-header {
      font-weight: 700;
        text-align: center;
        margin: 0 0 10px;
    }
    .normal-values .static {
  display: none;
}
.result {
  font-size: 16px;
  font-weight: 400;
  color: #000;
  margin: 5px;
}
    .normal-values .result:first-child {
  margin-top: 0;
}
    .input-group {
  display: flex;
  align-items: center;
  margin: 5px;
}
  </style>
</head>
<body>
  <header class="banner">Paediatric anaesthesia</header>

  <div class="section">
  <div class="input-group">
    <label for="age">Age:</label>
    <input type="number" id="age" min="0" placeholder="0" />
    <button class="unit-toggle" id="AgeUnitBtn">years</button>
  </div>

  <div class="input-group">
    <label for="weight">Weight (kg):</label>
    <input type="number" id="weight" min="0" placeholder="0" />
    <button class="estimate-btn" id="EstimateBtn">Estimate</button>
  </div>

  <!-- new container for showing the two formula lines -->
  <div id="weight-calculations"></div>
  </div>
    
    <!-- Paediatric normal values -->
  <div class="normal-values">
    <div class="section-header"><u>Normal physiological values</u></div>
  <div class="result">
    <strong>SBP</strong>:
  <span id="sbp-50"></span>
    <span class="static unit"> mmHg</span>
  <span class="static">(</span>
    <span id="sbp-5"></span>
    <span class="static">–</span>
    <span id="sbp-95"></span>
    
  <span class="static"><span class="static unit"> mmHg</span>)</span>
    <small>(50th centile, 5th–95th)</small>
</div>

  <div class="result">
    <strong>HR</strong>:
  <span id="hr-5"></span>
  <span class="static">–</span>
  <span id="hr-95"></span>
  <span class="static unit"> bpm</span>
    <small>(5th–95th centile)</small>
</div>
    
  <div class="result">
    <strong>RR</strong>:
  <span id="rr-5"></span>
  <span class="static">–</span>
  <span id="rr-95"></span>
  <span class="static unit"> bpm</span>
    <small>(5th–95th centile)</small>
</div>
</div>

  <div class="airway-section">
      <div class="section-header"><u>Airway and Ventilation</u></div>
<div class="result">
  <strong>ETT size</strong>:
  <span id="ett-uncuffed"></span>
  <small id="uncuffed-label">(Uncuffed)</small>
  <span id="ett-or" style="display:none; margin:0 4px;">or</span>
  <span id="ett-cuffed"></span>
  <small id="cuffed-label">(Cuffed)</small>
</div>

    <div class="result"><strong>ETT length at lips</strong>:
   <span id="ett-length"></span>
    <span class="static unit"> cm</span></div>
    <div class="result"><strong>Laryngoscope blade</strong>:
   <span id="laryngoscope"></span>
    </div>
   <br> 
    <div class="result"><strong>LMA size</strong>:
  <span id="lma"></span></div>
    <div class="result">
  <strong>i-Gel size</strong>:
  <span id="igel"></span>
</div>
    <br>
    <div class="result">
  <strong>Tidal volume (6-8 ml/kg)</strong>:
  <span id="tidalvolume"></span>
  </div>
  </div>
  
  <div class="emergency-section">
      <div class="section-header"><u>Emergencies / RSI</u></div>
     <div class="result">
  <strong>Fentanyl (1-2 mcg/kg)</strong>:
  <span id="fentanyl"></span><span class="static unit"> mcg</span>
</div>
    <div class="result">
  <strong>Ketamine (1-2 mg/kg)</strong>:
  <span id="ketamine"></span><span class="static unit"> mg</span>
</div>
    <div class="result">
  <strong>Rocuronium (1 mg/kg)</strong>:
  <span id="rocuronium"></span><span class="static unit"> mg</span>
</div>
    <br>
    <div class="result">
  <strong>Atropine (20 mcg/kg)</strong>:
  <span id="atropine"></span><span class="static unit"> mcg</span>
</div>
    <br>
    <div class="result">
  <strong>Suxamethonium IV (1-2 mg/kg)</strong>:
  <span id="sux-iv"></span><span class="static unit"> mg</span>
</div>
    <div class="result">
  <strong>Suxamethonium IM (4 mg/kg; Max 150 mg)</strong>:
  <span id="sux-im"></span><span class="static unit"> mg</span>
</div>
      <br>
      <div class="result">
  <strong>Defibrillation energy (4 J/kg)</strong>:
  <span id="defib"></span><span class="static unit"> J</span>
</div>
    <div class="result">
  <strong>Adrenaline IV 1:10,000 (0.1 ml/kg)</strong>:
  <span id="adrenalineiv"></span><span class="static unit"> ml</span>
</div>
      <div class="result">
  <strong>Fluid bolus (10-20 ml/kg)</strong>:
  <span id="fluidbolus"></span><span class="static unit"> ml</span>
</div>
      <div class="result">
  <strong>Glucose 10% (2 ml/kg)</strong>:
  <span id="glucose10"></span><span class="static unit"> ml</span>
</div>
  </div>

  
<div class="general-section">
  <div class="section-header"><u>Routine General Anaesthetic</u></div>
  <div class="result">
  <strong>Propofol (3-5 mg/kg)</strong>:
  <span id="propofol"></span><span class="static unit"> mg</span>
</div>
  <div class="result">
  <strong>Fentanyl (1-2 mcg/kg)</strong>:
  <span id="fentanyl-ga"></span><span class="static unit"> mcg</span>
</div>
  <div class="result">
  <strong>Rocuronium (0.6 mg/kg)</strong>:
  <span id="rocuronium-ga"></span><span class="static unit"> mg</span>
</div>
  <div class="result">
  <strong>Dexamethasone (0.15 mg/kg)</strong>:
  <span id="dexamethasone"></span><span class="static unit"> mg</span>
</div>
  <div class="result">
  <strong>Ondansetron (0.15 mg/kg)</strong>:
    <span id="ondansetron"></span><span class="static unit"> mg</span>
</div>
    <div class="result">
  <strong>Paracetamol</strong>:
    <span id="ondansetron"></span><span class="static unit"> mg</span>
</div>
  <div class="result">
  <strong>Ibuprofen (10 mg/kg)</strong>:
    <span id="ondansetron"></span><span class="static unit"> mg</span>
</div>
  </div>
  
   <div class="button-container" style="text-align: center; margin-bottom: 20px;">
    <button type="button" class="reset-btn" onclick="resetForm()">Reset</button>
    <button type="button" class="home-btn" onclick="goHome()">Home</button>
  </div>
  
  <footer>
    <small>
      <p>SBP: Systolic blood pressure; HR: Heart rate; RR: Respiratory rate; ETT: Endotracheal tube; LMA: Laryngeal mask airway; RSI: Rapid sequence intubation</p>
      <p>
        <a href="references.html">References</a> - 
        <a href="disclaimer.html">Disclaimer</a>
      </p>
      <p>&copy; 2025 #OneTeam Anaesthesia. All rights reserved.</p>
    </small>
  </footer>

<script>
  let ageUnit = 'years';

  // grab your nodes once
  const ageInput = document.getElementById('age');
  const weightIn = document.getElementById('weight');
  const unitBtn  = document.getElementById('AgeUnitBtn');
  const estBtn   = document.getElementById('EstimateBtn');
  const calcDiv  = document.getElementById('weight-calculations');

  // clear everything and hide all outputs
  function clearWeight() {
    document.querySelectorAll('.calc-note').forEach(el => el.remove());
  calcDiv.innerHTML = '';
    const uncEl  = document.getElementById('ett-uncuffed').parentElement;
const cuffEl = document.getElementById('ett-cuffed').parentElement;
uncEl .style.display = 'none';
cuffEl.style.display = 'none';
  // — Clear laryngoscope blade choice —
const laryngoscopeEl = document.getElementById('laryngoscope');
laryngoscopeEl.textContent = '';
laryngoscopeEl.style.display = 'none';
  // clear all the normal / airway spans
  ['sbp-5','sbp-50','sbp-95','hr-5','hr-95','rr-5','rr-95',
   'ett-uncuffed','ett-cuffed','ett-length','lma','fentanyl','ketamine','rocuronium'
  ].forEach(id => {
    const el = document.getElementById(id);
    el.textContent = '';
  });
    
    ['fentanyl','ketamine','rocuronium',
   'atropine','sux-iv','sux-im',
   'defib','adrenalineiv','fluidbolus','glucose10'
  ].forEach(id => {
    const el   = document.getElementById(id);
    const unit = el.nextElementSibling;           // the <span class="static unit">
    el.textContent   = '';
    el.style.display = 'none';
    if (unit && unit.classList.contains('unit')) {
      unit.style.display = 'none';
    }
  });
    
    ['propofol','fentanyl-ga','rocuronium-ga','dexamethasone','ondansetron']
  .forEach(id => {
    const el   = document.getElementById(id);
    const unit = el.nextElementSibling;        // the <span class="static unit">
    el.textContent   = '';
    el.style.display = 'none';
    if (unit && unit.classList.contains('unit')) {
      unit.style.display = 'none';
    }
  });
    
// hide the “cm” on ETT length until we have a value
const lenUnit = document.querySelector('#ett-length + .unit');
lenUnit && (lenUnit.style.display = 'none');

  // *only* clear & hide the number spans for i-gel & tidal volume
  const igelEl = document.getElementById('igel');
  igelEl.textContent = '';
  igelEl.style.display = 'none';

  const tvEl = document.getElementById('tidalvolume');
  tvEl.textContent = '';
  tvEl.style.display = 'none';

  document.querySelectorAll('.normal-values .static')
    .forEach(el => el.style.display = 'none');
}

  // toggle years ↔ months
  function toggleAgeUnit() {
    clearWeight();
    const raw = ageInput.value.trim();
    const n   = parseFloat(raw);
    if (ageUnit === 'years') {
      ageUnit = 'months';
      unitBtn.textContent = 'months';
      ageInput.value = raw!=='' && !isNaN(n) ? Math.round(n*12) : '';
    } else {
      ageUnit = 'years';
      unitBtn.textContent = 'years';
      ageInput.value = raw!=='' && !isNaN(n) ? Math.round((n/12)*10)/10 : '';
    }
  }

  function estimateWeight() {
  clearWeight();
  const a = parseFloat(ageInput.value);
  if (isNaN(a) || a < 0) {
    alert('Please enter a valid age.');
    return;
  }

  // ── SPECIAL CASE for exactly 0 months/years ──
  if (a === 0) {
    const w = 3.5;
    weightIn.value = w;
    calcDiv.innerHTML = `<p>Estimated weight for a neonate = ${w} <span class="unit">kg</span></p>`;
    return;
  }

  const m = ageUnit === 'months' ? a : a * 12;
  if (m < 12) {
    const w = Math.round((0.5 * m + 4) * 10) / 10;
    weightIn.value = w;
    calcDiv.innerHTML = `<p>(0.5 × Age in months) + 4 = ${w} <span class="unit">kg</span></p>`;
    return;
  }
  const y = m / 12;
  if (y <= 14) {
    const w1 = Math.round((2 * y + 8) * 10) / 10;
    let html = `<p>(2 × Age) + 8 = ${w1} <span class="unit">kg</span></p>`;
    if (y >= 6) {
      const w2 = Math.round((3 * y + 7) * 10) / 10;
      html += `<p>(3 × Age) + 7 = ${w2} <span class="unit">kg</span></p>`;
    }
    weightIn.value = w1;
    calcDiv.innerHTML = html;
    return;
  }
  alert('Age must be between 0 months and 14 years to estimate weight.');
}

  // paediatric normals table
  const paediatricNormals = {
    0:   { respRate:[25,50], heartRate:[120,170], bp:{p5:65, p50:85, p95:105} },
    1:   { respRate:[25,50], heartRate:[120,170], bp:{p5:65, p50:85, p95:105} },
    3:   { respRate:[25,45], heartRate:[115,160], bp:{p5:65, p50:85, p95:105} },
    6:   { respRate:[20,40], heartRate:[110,160], bp:{p5:65, p50:85, p95:105} },
    12:  { respRate:[20,40], heartRate:[110,160], bp:{p5:70, p50:90, p95:105} },
    18:  { respRate:[20,35], heartRate:[100,155], bp:{p5:70, p50:90, p95:105} },
    24:  { respRate:[20,30], heartRate:[100,150], bp:{p5:70, p50:90, p95:110} },
    36:  { respRate:[20,30], heartRate:[90,140],  bp:{p5:70, p50:90, p95:110} },
    48:  { respRate:[20,30], heartRate:[80,135],  bp:{p5:70, p50:90, p95:110} },
    60:  { respRate:[20,30], heartRate:[80,135],  bp:{p5:80, p50:95, p95:120} },
    72:  { respRate:[20,30], heartRate:[80,130],  bp:{p5:80, p50:95, p95:120} },
    84:  { respRate:[20,30], heartRate:[80,130],  bp:{p5:80, p50:95, p95:120} },
    96:  { respRate:[15,25], heartRate:[70,120],  bp:{p5:80, p50:95, p95:120} },
    108: { respRate:[15,25], heartRate:[70,120],  bp:{p5:80, p50:95, p95:120} },
    120: { respRate:[15,25], heartRate:[70,120],  bp:{p5:80, p50:95, p95:120} },
    132: { respRate:[15,25], heartRate:[70,120],  bp:{p5:80, p50:95, p95:120} },
    144: { respRate:[12,24], heartRate:[65,115],  bp:{p5:90, p50:110,p95:140} },
    168: { respRate:[12,24], heartRate:[60,110],  bp:{p5:90, p50:110,p95:140} }
  };

  // pick the nearest key
  function getNormalValues(age, unit) {
    const months = unit==='months'? age : age*12;
    const keys = Object.keys(paediatricNormals).map(k=>+k).sort((a,b)=>a-b);
    if (months < 12) {
      const mks = keys.filter(k=>k<12);
      return paediatricNormals[mks.reduce((a,b)=>Math.abs(b-months)<Math.abs(a-months)?b:a, mks[0])];
    } else {
      const ideal = Math.floor(months/12)*12;
      const below = keys.filter(k=>k<=ideal);
      const key   = below.length? below.pop() : keys.find(k=>k>=12);
      return paediatricNormals[key];
    }
  }

  // show centiles
  function updateNormalCentiles(n) {
    document.getElementById('sbp-5').textContent   = n.bp.p5;
    document.getElementById('sbp-50').textContent  = n.bp.p50;
    document.getElementById('sbp-95').textContent  = n.bp.p95;
    document.getElementById('hr-5').textContent    = n.heartRate[0];
    document.getElementById('hr-95').textContent   = n.heartRate[1];
    document.getElementById('rr-5').textContent    = n.respRate[0];
    document.getElementById('rr-95').textContent   = n.respRate[1];
    document.querySelectorAll('.normal-values .static')
      .forEach(el => el.style.display='inline');
  }

  // airway calcs (unchanged)
  function updateAirwayCalculations(ageYears) {
    const w = parseFloat(weightIn.value)||0;
    const m = ageUnit==='months'? parseFloat(ageInput.value) : ageYears*12;
    let unc='', cuff='', len='';
    const uncEl  = document.getElementById('ett-uncuffed').parentElement;
    const cuffEl = document.getElementById('ett-cuffed').parentElement;
    const lenUnit= document.querySelector('#ett-length + .unit');

    if (isNaN(m) || m <= 0) {
  uncEl.style.display = 'none';
  cuffEl.style.display = 'none';
  lenUnit && (lenUnit.style.display = 'none');
} else if (m<12) {
      if(w<1) unc=2.5,len=6.5;
      else if(w<2) unc=3,len=7;
      else if(w<3) unc=3.5,len=8;
      else if(w<4) unc=3.5,len=9;
      else unc=4,len=10;
    } else {
      unc  = Math.round((ageYears/4+4)*10)/10;
      cuff = Math.round((ageYears/4+3.5)*10)/10;
      len  = Math.round((ageYears/2+12)*10)/10;
    }

    document.getElementById('ett-uncuffed').textContent = unc;
    document.getElementById('ett-cuffed').textContent   = cuff;
    document.getElementById('ett-length').textContent   = len;
    uncEl.style.display  = unc   ? 'inline-block' : 'none';
cuffEl.style.display = cuff  ? 'inline-block' : 'none';
    lenUnit && (lenUnit.style.display = len ? 'inline':'none');

    const orEl = document.getElementById('ett-or');
orEl.style.display = (unc && cuff) ? 'inline' : 'none';
    
    const igel = (w<=0||isNaN(w))? '' :
      w<=5?'1.0 (Neonate, 2-5 kg)':
      w<=10?'1.5 (Infant, 5-12 kg)':
      w<=25?'2.0 (Small Paediatric, 10-25 kg)':
      w<=35?'2.5 (Large Paediatric, 25-35 kg)':
      w<=60?'3.0 (Small Adult, 30-60 kg)':
      w<=90?'4.0 (Medium Adult)':'5.0 (Large Adult, 50-90 kg)';
    
    // block for LMA sizing ---
  const lmaSize = (w <= 0 || isNaN(w)) ? '' :
    w <= 5   ? '1.0 (<5kg)'   :
    w <= 10  ? '1.5 (5-10 kg)' :
    w <= 20  ? '2.0 (10-20 kg)'   :
    w <= 30  ? '2.5 (20-30 kg)' :
    w <= 50  ? '3.0 (30-50 kg)'   :
    w <= 70  ? '4.0 (50-70 kg)'   :
    w <= 100 ? '5.0 (70-100 kg)'   :
               '';
   
    const igelEl = document.getElementById('igel');
if (igel) {
  igelEl.textContent    = igel;
  igelEl.style.display  = 'inline';
} else {
  igelEl.style.display  = 'none';
}
    
    const lmaEl = document.getElementById('lma');
  lmaEl.textContent = lmaSize;
  // show or hide the <div> around it
  lmaEl.parentElement.style.display = lmaSize ? 'block' : 'none';
    
    // tidal volume 6–8 ml/kg
 const tvEl = document.getElementById('tidalvolume');
if (w > 0 && !isNaN(w)) {
  const tvMin = Math.round(6 * w);
  const tvMax = Math.round(8 * w);
  tvEl.textContent      = `${tvMin} – ${tvMax} ml`;
  tvEl.style.display    = 'inline';
} else {
  tvEl.style.display    = 'none';
  
}
      // — LARYNGOSCOPE BLADE SIZING —
  const laryngoscopeEl      = document.getElementById('laryngoscope');
  
  if (w > 0) {
    let blade = '';
    if (w < 1.5)             blade = 'Miller 00 or 0 (Extremely preterm)';
    else if (w < 2.5)      blade = 'Mac 0 / Miller 0 (Preterm)';
    else if (w < 4)        blade = 'Mac 0-1 / Miller 0-1 (Neonate)';
    else if (w < 6)        blade = 'Mac 1 / Miller 1 (Baby, 1–6 months)';
    else if (w < 12)       blade = 'Mac 1-2 / Miller 1–2 (Toddlers, 6 months–2 years)';
    else if (w < 30)       blade = 'Mac 2 (Children, 2–10 years)';
    else if (w <= 60)      blade = 'Mac 3 (Older children/Adolescent, 10+ years)';
   if (blade) {
  laryngoscopeEl.textContent = blade;
  laryngoscopeEl.style.display = 'inline';
} else {
  laryngoscopeEl.style.display = 'none';
}  
  }
     updateEmergencyDrugs(w);
    updateGADrugs(w);
  }
  
function updateEmergencyDrugs(w) {
  // remove any old volume/notes after a unit-span
  function clearNote(unitSpan) {
    if (!unitSpan) return;
    let next = unitSpan.nextElementSibling;
    while (next && next.classList.contains('calc-note')) {
      const toRemove = next;
      next = next.nextElementSibling;
      toRemove.remove();
    }
  }

  // grab all numeric spans + their unit spans
  const fentanylEl     = document.getElementById('fentanyl'),
        fentanylUnit   = fentanylEl.nextElementSibling,
        ketamineEl     = document.getElementById('ketamine'),
        ketamineUnit   = ketamineEl.nextElementSibling,
        rocuroniumEl   = document.getElementById('rocuronium'),
        rocuroniumUnit = rocuroniumEl.nextElementSibling,
        atropineEl     = document.getElementById('atropine'),
        atropineUnit   = atropineEl.nextElementSibling,
        suxIvEl        = document.getElementById('sux-iv'),
        suxIvUnit      = suxIvEl.nextElementSibling,
        suxImEl        = document.getElementById('sux-im'),
        suxImUnit      = suxImEl.nextElementSibling,
        defibEl        = document.getElementById('defib'),
        defibUnit      = defibEl.nextElementSibling,
        adrenalineEl   = document.getElementById('adrenalineiv'),
        adrenalineUnit = adrenalineEl.nextElementSibling,
        bolusEl        = document.getElementById('fluidbolus'),
        bolusUnit      = bolusEl.nextElementSibling,
        glucoseEl      = document.getElementById('glucose10'),
        glucoseUnit    = glucoseEl.nextElementSibling;

  if (w > 0 && !isNaN(w)) {
    //— FENTANYL 1–2 mcg/kg @ 50 mcg/ml —
    clearNote(fentanylUnit);
    const fMin = (1 * w).toFixed(1),
          fMax = (2 * w).toFixed(1),
          vMin = (fMin  / 50).toFixed(2),
          vMax = (fMax  / 50).toFixed(2);
    fentanylEl.textContent     = `${fMin}–${fMax}`;
    fentanylEl.style.display   = 'inline';
    fentanylUnit.style.display = 'inline';
    fentanylUnit.insertAdjacentHTML('afterend',
      `<small class="calc-note"><em> (${vMin}–${vMax} ml of 50 mcg/ml)</em></small>`
    );

     // KETAMINE 1–2 mg/kg @ 10 mg/ml
    clearNote(ketamineUnit);
    const kMin   = (1 * w).toFixed(1),
          kMax   = (2 * w).toFixed(1),
          kVolMin = (kMin / 10).toFixed(2),
          kVolMax = (kMax / 10).toFixed(2);
    ketamineEl.textContent     = `${kMin}–${kMax}`;
    ketamineUnit.style.display = 'inline';
    ketamineEl.style.display   = 'inline';
    ketamineUnit.insertAdjacentHTML('afterend',
      `<small class="calc-note"><em> (${kVolMin}–${kVolMax} ml of 10 mg/ml)</em></small>`
    );

    //— ROCURONIUM 1 mg/kg @ 10 mg/ml —
    clearNote(rocuroniumUnit);
    const rDose = (1 * w).toFixed(1),
          rVol  = (rDose  / 10).toFixed(2);
    rocuroniumEl.textContent     = rDose;
    rocuroniumEl.style.display   = 'inline';
    rocuroniumUnit.style.display = 'inline';
    rocuroniumUnit.insertAdjacentHTML('afterend',
      `<small class="calc-note"><em> (${rVol} ml of 10 mg/ml)</em></small>`
    );

    //— ATROPINE 20 mcg/kg @ 600 mcg/ml —
    clearNote(atropineUnit);
    const aDose = (20 * w).toFixed(1),
          aVol  = (aDose / 600).toFixed(2);
    atropineEl.textContent     = aDose;
    atropineEl.style.display   = 'inline';
    atropineUnit.style.display = 'inline';
    atropineUnit.insertAdjacentHTML('afterend',
      `<small class="calc-note"><em> (${aVol} ml of 600 mcg/ml)</em></small>`
    );

    //— SUXAMETHONIUM IV 1–2 mg/kg @ 50 mg/ml —
    clearNote(suxIvUnit);
    const sIVmin = (1 * w).toFixed(1),
          sIVmax = (2 * w).toFixed(1),
          ivVolMin = (sIVmin / 50).toFixed(2),
          ivVolMax = (sIVmax / 50).toFixed(2);
    suxIvEl.textContent     = `${sIVmin}–${sIVmax}`;
    suxIvEl.style.display   = 'inline';
    suxIvUnit.style.display = 'inline';
    suxIvUnit.insertAdjacentHTML('afterend',
      `<small class="calc-note"><em> (${ivVolMin}–${ivVolMax} ml of 50 mg/ml)</em></small>`
    );

    //— SUXAMETHONIUM IM 4 mg/kg (max 150 mg) @ 50 mg/ml —
    clearNote(suxImUnit);
    let imDose = 4 * w;
    if (imDose > 150) imDose = 150;
    const sIMdose = imDose.toFixed(1),
          imVol    = (sIMdose / 50).toFixed(2);
    suxImEl.textContent     = sIMdose;
    suxImEl.style.display   = 'inline';
    suxImUnit.style.display = 'inline';
    suxImUnit.insertAdjacentHTML('afterend',
      `<small class="calc-note"><em> (${imVol} ml of 50 mg/ml)</em></small>`
    );

    //— DEFIBRILLATION ENERGY 4 J/kg —
    const defibDose = (4 * w).toFixed(1);
    defibEl.textContent     = defibDose;
    defibEl.style.display   = 'inline';
    defibUnit.style.display = 'inline';

    //— ADRENALINE IV 0.1 ml/kg (0.1 mg/ml) —
    clearNote(adrenalineUnit);
    const vol = (0.1 * w).toFixed(2),
          mg  = (vol * 0.1).toFixed(2);
    adrenalineEl.textContent     = vol;
    adrenalineEl.style.display   = 'inline';
    adrenalineUnit.style.display = 'inline';
    adrenalineUnit.insertAdjacentHTML('afterend',
      `<small class="calc-note"><em> (${mg} mg)</em></small>`
    );

    //— FLUID BOLUS 10–20 ml/kg —
    const bolusMin = Math.round(10 * w),
          bolusMax = Math.round(20 * w);
    bolusEl.textContent     = `${bolusMin}–${bolusMax}`;
    bolusEl.style.display   = 'inline';
    bolusUnit.style.display = 'inline';

    //— GLUCOSE 10% 2 ml/kg —
    const gluDose = (2 * w).toFixed(1);
    glucoseEl.textContent     = gluDose;
    glucoseEl.style.display   = 'inline';
    glucoseUnit.style.display = 'inline';

  } else {
    // hide everything if no valid weight
    [fentanylEl, ketamineEl, rocuroniumEl,
     atropineEl, suxIvEl, suxImEl,
     defibEl, adrenalineEl, bolusEl, glucoseEl
    ].forEach(el => {
      el.style.display = 'none';
      const u = el.nextElementSibling;
      if (u && u.classList.contains('unit')) u.style.display = 'none';
      clearNote(u);
    });
  }
}
  
    function updateGADrugs(w) {
  // clear any old notes first
  document.querySelectorAll('.general-section .calc-note').forEach(el => el.remove());

  const drugs = [
    // id,  min-dose, max-dose,   conc per ml,       unit
    { id: 'propofol',    min: 3,   max: 5,    conc: 10,     unit: 'mg'  },
    { id: 'fentanyl-ga', min: 1,   max: 2,    conc: 50,     unit: 'mcg' },
    { id: 'rocuronium-ga', min: 0.6, max: 0.6, conc: 10,     unit: 'mg'  },
    { id: 'dexamethasone', min: 0.15, max: 0.15, conc: 3.3,   unit: 'mg'  },
    { id: 'ondansetron',  min: 0.15, max: 0.15, conc: 2,      unit: 'mg'  },
  ];

  drugs.forEach(({ id, min, max, conc, unit }) => {
    const el    = document.getElementById(id);
    const uSpan = el.nextElementSibling; // the `<span class="static unit">`

    // compute dose
    const dMin = (min * w).toFixed(1);
    const dMax = (max * w).toFixed(1);
    const doseText = (min === max) ? dMin : `${dMin}–${dMax}`;

    // compute volume in ml
    const vMin = (dMin / conc).toFixed(2);
    const vMax = (dMax / conc).toFixed(2);
    const volText = (min === max) ? `${vMin}` : `${vMin}–${vMax}`;

    // update DOM
    el.textContent       = doseText;
    el.style.display     = w > 0 ? 'inline' : 'none';
    if (uSpan) uSpan.style.display = w > 0 ? 'inline' : 'none';

    // append the little italic volume note
    if (w > 0) {
      uSpan.insertAdjacentHTML('afterend',
        `<small class="calc-note"><em> (${volText} ml of ${conc}${unit}/ml)</em></small>`
      );
    }
  });
}

  // event wiring
  unitBtn.addEventListener('click', toggleAgeUnit);
  estBtn .addEventListener('click', () => {
    estimateWeight();
    const a = parseFloat(ageInput.value)||0,
          y = ageUnit==='months'? a/12 : a;
    const normals = getNormalValues(a, ageUnit);
    if(normals) updateNormalCentiles(normals);
    if(!isNaN(y)) updateAirwayCalculations(y);
  });

  ageInput.addEventListener('input', () => {
    const a = parseFloat(ageInput.value);
    if(isNaN(a)) return clearWeight();
    const y = ageUnit==='months'? a/12 : a;
    updateAirwayCalculations(y);
    const normals = getNormalValues(a, ageUnit);
    if(normals) updateNormalCentiles(normals);
  });

  weightIn.addEventListener('input', () => {
    const a = parseFloat(ageInput.value),
          w = parseFloat(weightIn.value);
    if(isNaN(a)||isNaN(w)) return clearWeight();
    const y = ageUnit==='months'? a/12 : a;
    updateAirwayCalculations(y);
    const normals = getNormalValues(a, ageUnit);
    if(normals) updateNormalCentiles(normals);

    let disp = '', m = ageUnit==='months'? a : a*12;
    if(m<12) {
      const e = 0.5*m+4;
      if(Math.abs(e-w)<0.2) disp = `<p>(0.5 × Age in months) + 4 = ${w.toFixed(1)} <span class="unit">kg</span></p>`;
    } else {
      const e1 = 2*y+8;
      if(Math.abs(e1-w)<0.2) disp = `<p>(2 × Age) + 8 = ${w.toFixed(1)} <span class="unit">kg</span></p>`;
      else if(y>=6) {
        const e2 = 3*y+7;
        if(Math.abs(e2-w)<0.2) disp = `<p>(3 × Age) + 7 = ${w.toFixed(1)} <span class="unit">kg</span></p>`;
      }
    }
    calcDiv.innerHTML = disp;
  });

  document.addEventListener('DOMContentLoaded', clearWeight);
  
  // Reset everything back to the initial state
function resetForm() {
  // 1) clear the inputs
  ageInput.value = '';
  weightIn.value = '';
  // 2) reset the toggle back to years
  ageUnit = 'years';
  unitBtn.textContent = 'years';
  // 3) hide all existing outputs
  clearWeight();
}

// Optional: home button handler if you want
function goHome() {
  window.location.href = '/'; // or 'index.html'
}
  
</script>

</body>
</html>
