<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Paediatric anaesthetic calculator</title>
  <link rel="stylesheet" href="styles.css" />
  <link
    href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700&display=swap"
    rel="stylesheet"
  />
  <link
    href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap"
    rel="stylesheet"
  />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <style>
    header.banner {
      background: linear-gradient(130deg, #E65100 0%, #F57C00 100%);
    }
    .unit-toggle, .estimate-btn {
      font-size: 16px;
      margin: 5px;
      padding: 4px 8px;
      cursor: pointer;
    }
    .estimate-btn {
      background: #f0f0f0;
      border: 1px solid #ccc;
      border-radius: 5px;
      width: 80px;
    }
    .unit-toggle {
      width: 80px;
    }
    /* new styles for the calculation display */
    #weight-calculations {
      margin: 8px 5px;
      font-family: inherit;
      line-height: 1.4;
      font-size: 12px;
    }
    #weight-calculations p {
      margin: 2px 0;
    }
    .unit {
      font-weight: 700;
    }
    .normal-values {
  font-family: inherit;
      margin: 0 auto 20px auto;
      padding: 15px;
      border: 1px solid #ccc;
      border-radius: 10px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      background-color: #fff;
      box-sizing: border-box;
}
     .airway-section {
  font-family: inherit;
      margin: 0 auto 20px auto;
      padding: 15px;
      border: 1px solid #ccc;
      border-radius: 10px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      background-color: #fff;
      box-sizing: border-box;
}
    .emergency-section {
  font-family: inherit;
      margin: 0 auto 20px auto;
      padding: 15px;
      border: 1px solid #ccc;
      border-radius: 10px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      background-color: #fff;
      box-sizing: border-box;
}
    .section {
      margin: 0 auto 16px auto;
      padding: 10px;
      border: 1px solid #f0c197;
      border-radius: 10px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      box-sizing: border-box;
      background: linear-gradient(to right, #fffaf5, #fff3e0);
    }
      .section-header {
      font-weight: 700;
        text-align: center;
        margin: 0 0 10px;
    }
    .normal-values .static {
  display: none;
}
.result {
  font-size: 16px;
  font-weight: 400;
  color: #000;
  margin: 5px;
}
    .normal-values .result:first-child {
  margin-top: 0;
}
    .input-group {
  display: flex;
  align-items: center;
  margin: 5px;
}
.accordion {
    font-family: 'Roboto', sans-serif;
    max-width: 600px;
    margin: 0px auto;
  }
  .accordion-item {
    margin-bottom: 16px;
    border: 1px solid #f0c197;
    border-radius: 12px;
    background: linear-gradient(to right, #fffaf5, #fff3e0);
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
    overflow: hidden;
  }
  .accordion-header {
    background: transparent;
    color: #333;
    padding: 16px 18px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    cursor: pointer;
    font-weight: 700;
    font-size: 1.05em;
    transition: background 0.3s ease;
  }
  .accordion-header.active {

    background: rgba(255, 188, 112, 0.15);

  }
  .accordion-title {
    display: flex;
    align-items: center;
    gap: 10px;
  }
  .accordion-title i:first-child {
    color: #F57C00;
    font-size: 1.2em;
  }
  .accordion-header .fa-plus,
  .accordion-header .fa-minus {
    color: #F57C00;
    transition: opacity 0.3s ease;
  }
  .accordion-header .fa-minus {
    display: none;
  }
  .accordion-header.active .fa-plus {
    display: none;
  }
  .accordion-header.active .fa-minus {
    display: inline;
  }
  .accordion-content {
    max-height: 0;
    opacity: 0;
    overflow: hidden;
    background: #fffaf5;
    transition: max-height 0.4s ease, opacity 0.3s ease;
    font-size: 0.95em;
    color: #444;
    padding: 0 18px;
  }
  .accordion-content-inner {
    padding: 16px 0;
  }
  .accordion-content.show {
    opacity: 1;
  }
    .airway-note {
  margin: 4px 0 8px 5px;
  font-size: 12px;
  font-style: italic;
  color: #444;
}
  </style>
</head>
<body>
  <header class="banner">Paediatric anaesthesia</header>

  <div class="section">
  <div class="input-group">
    <label for="age">Age:</label>
    <input type="number" id="age" min="0" placeholder="0" />
    <button class="unit-toggle" id="AgeUnitBtn">years</button>
  </div>

    
    
  <div class="input-group">
    <label for="weight">Weight (kg):</label>
    <input type="number" id="weight" min="0" placeholder="0" />
    <button class="estimate-btn" id="EstimateBtn">Estimate</button>
  </div>

  <!-- new container for showing the two formula lines -->
  <div id="weight-calculations"></div>
  </div>
    
  <div class="accordion">

  <div class="accordion-item">

    <div class="accordion-header">

      <span class="accordion-title">

        <i class="fas fa-stethoscope"></i> Normal physiological values

      </span>

      <span>

        <i class="fas fa-plus"></i>

        <i class="fas fa-minus"></i>

      </span>

    </div>

    <div class="accordion-content">

      <div class="accordion-content-inner">

  <div class="result">
    <strong>SBP</strong>:
  <span id="sbp-50"></span>
    <span class="static unit"> mmHg</span>
  <span class="static">(</span>
    <span id="sbp-5"></span>
    <span class="static">–</span>
    <span id="sbp-95"></span>
    
  <span class="static"><span class="static unit"> mmHg</span>)</span>
    <small>(50th centile, 5th–95th)</small>
</div>

  <div class="result">
    <strong>HR</strong>:
  <span id="hr-5"></span>
  <span class="static">–</span>
  <span id="hr-95"></span>
  <span class="static unit"> bpm</span>
    <small>(5th–95th centile)</small>
</div>
    
  <div class="result">
    <strong>RR</strong>:
  <span id="rr-5"></span>
  <span class="static">–</span>
  <span id="rr-95"></span>
  <span class="static unit"> bpm</span>
    <small>(5th–95th centile)</small>
</div>
      </div>
      </div>
    </div>
  
  <div class="accordion-item">

    <div class="accordion-header">

      <span class="accordion-title">

        <i class="fas fa-mask-face"></i> Airway and Ventilation

      </span>

      <span>

        <i class="fas fa-plus"></i>

        <i class="fas fa-minus"></i>

      </span>

    </div>

    <div class="accordion-content">

      <div class="accordion-content-inner">
<div class="result">
  <strong>ETT size</strong>:
  <span id="ett-uncuffed"></span>
  <small id="uncuffed-label">(Uncuffed)</small>
  <span id="ett-or" style="display:none; margin:0 4px;">or</span>
  <span id="ett-cuffed"></span>
  <small id="cuffed-label">(Cuffed)</small>
</div>

    <div class="result"><strong>ETT length at lips</strong>:
   <span id="ett-length"></span>
    <span class="static unit"> cm</span></div>
    <div class="result"><strong>Laryngoscope blade</strong>:
   <span id="laryngoscope"></span>
    </div>
   <br> 
    <div class="result"><strong>LMA size</strong>:
  <span id="lma"></span></div>
    <div class="result">
  <strong>i-Gel size</strong>:
  <span id="igel"></span>
</div>
    <br>
    <div class="result">
  <strong>Tidal volume (6-8 ml/kg)</strong>:
  <span id="tidalvolume"></span>
  </div>
  </div>
      </div>      
</div>
  
<div class="accordion-item">

    <div class="accordion-header">

      <span class="accordion-title">

        <i class="fas fa-syringe"></i> Emergencies / RSI

      </span>

      <span>

        <i class="fas fa-plus"></i>

        <i class="fas fa-minus"></i>

      </span>

    </div>

    <div class="accordion-content">

      <div class="accordion-content-inner">  
     <div class="result">
  <strong style="background-color:#66ccf0;">Fentanyl (1-2 mcg/kg)</strong>:
  <span id="fentanyl"></span><span class="static unit"> mcg</span>
</div>
    <div class="result">
  <strong style="background-color:#fff000;">Ketamine (1-2 mg/kg)</strong>:
  <span id="ketamine"></span><span class="static unit"> mg</span>
</div>
    <div class="result">
  <strong style="background-color:#e0281d;">Rocuronium (1 mg/kg)</strong>:
  <span id="rocuronium"></span><span class="static unit"> mg</span>
</div>
    <br>
    <div class="result">
  <strong style="background-color:#a8d46f;">Atropine (20 mcg/kg)</strong>:
  <span id="atropine"></span><span class="static unit"> mcg</span>
</div>
    <br>
    <div class="result">
  <strong style="color: #ff1c3d; background-color:black;">Suxamethonium IV (1-2 mg/kg)</strong>:
  <span id="sux-iv"></span><span class="static unit"> mg</span>
</div>
    <div class="result">
  <strong style="color: #ff1c3d; background-color:black;">Suxamethonium IM (4 mg/kg; Max 150 mg)</strong>:
  <span id="sux-im"></span><span class="static unit"> mg</span>
</div>
      <br>

    <div class="result">
  <strong style="color: #D9B3DD; background-color:black;">Adrenaline IV 1:10,000 (0.1 ml/kg)</strong>:
  <span id="adrenalineiv"></span><span class="static unit"> ml</span>
</div>
        <br>
              <div class="result">
  <strong>Defibrillation energy (4 J/kg)</strong>:
  <span id="defib"></span><span class="static unit"> J</span>
</div>
      <div class="result">
  <strong>Fluid bolus (10-20 ml/kg)</strong>:
  <span id="fluidbolus"></span><span class="static unit"> ml</span>
</div>
      <div class="result">
  <strong>Glucose 10% (2 ml/kg)</strong>:
  <span id="glucose10"></span><span class="static unit"> ml</span>
</div>
  </div>
      </div>
  </div>

  
<div class="accordion-item">

    <div class="accordion-header">

      <span class="accordion-title">

        <i class="fas fa-syringe"></i> Routine General Anaesthetic

      </span>

      <span>

        <i class="fas fa-plus"></i>

        <i class="fas fa-minus"></i>

      </span>

    </div>

    <div class="accordion-content">

      <div class="accordion-content-inner general-section">      
 
  <div class="result">
  <strong>Fentanyl (1-2 mcg/kg)</strong>:
  <span id="fentanyl-ga"></span><span class="static unit"> mcg</span>
</div>
  <div class="result">
  <strong>Propofol (3-5 mg/kg)</strong>:
  <span id="propofol"></span><span class="static unit"> mg</span>
</div>
  <div class="result">
  <strong>Rocuronium (0.6 mg/kg)</strong>:
  <span id="rocuronium-ga"></span><span class="static unit"> mg</span>
</div>
  <br>
  <div class="result">
  <strong>Dexamethasone (0.15 mg/kg)</strong>:
  <span id="dexamethasone"></span><span class="static unit"> mg</span>
</div>
  <div class="result">
  <strong>Ondansetron (0.15 mg/kg)</strong>:
    <span id="ondansetron"></span><span class="static unit"> mg</span>
</div>
  <br>
    <div class="result">
  <strong>Paracetamol PO/IV</strong>:
    <span id="paracetamol"></span><span class="static unit"> mg</span>
</div>
  <div class="result">
  <strong>Ibuprofen IV</strong>:
    <span id="ibuprofeniv"></span><span class="static unit"> mg</span>
</div>
  <div class="result">
  <strong>Ibuprofen PO (5-10 mg/kg)</strong>:
    <span id="ibuprofenpo"></span><span class="static unit"> mg</span>
</div>
  </div>
  </div>
    </div>
  
   <div class="button-container" style="text-align: center; margin-bottom: 20px;">
    <button type="button" class="reset-btn" onclick="resetForm()">Reset</button>
    <button type="button" class="home-btn" onclick="goHome()">Home</button>
  </div>
  
  <footer>
    <small>
      <p>SBP: Systolic blood pressure; HR: Heart rate; RR: Respiratory rate; ETT: Endotracheal tube; LMA: Laryngeal mask airway; RSI: Rapid sequence intubation</p>
      <p>
        <a href="references.html">References</a> - 
        <a href="disclaimer.html">Disclaimer</a>
      </p>
      <p>&copy; 2025 #OneTeam Anaesthesia. All rights reserved.</p>
    </small>
  </footer>

<script>
    function stripZeros(str) {
    return str
      .replace(/(\.\d*?[1-9])0+$/ , '$1')   // drop extra zeroes after a significant decimal
      .replace(/\.0+$/            , ''   );// drop ".0", ".00", etc.
  }
  
  let ageUnit = 'years';

  // grab your nodes once
  const ageInput = document.getElementById('age');
  const weightIn = document.getElementById('weight');
  const unitBtn  = document.getElementById('AgeUnitBtn');
  const estBtn   = document.getElementById('EstimateBtn');
  const calcDiv  = document.getElementById('weight-calculations');

  // clear everything and hide all outputs
  function clearWeight() {
  // 1) remove any old small notes (EM, calc, analgesic)
  document
    .querySelectorAll('.calc-note, .analgesic-note, .analgesic-note--ibu, .analgesic-note--po, .airway-note')
    .forEach(el => el.remove());

  // 2) clear the weight-calculation formulas
  calcDiv.innerHTML = '';

  // 3) hide uncuffed/cuffed ETT
  ['ett-uncuffed','uncuffed-label','ett-or','ett-cuffed','cuffed-label']
    .forEach(id => {
      const el = document.getElementById(id);
      if (el) el.style.display = 'none';
    });

  // 4) clear laryngoscope
  const laryngoscopeEl = document.getElementById('laryngoscope');
  laryngoscopeEl.textContent = '';
  laryngoscopeEl.style.display = 'none';

  // 5) clear normal/airway numeric spans (just text)
  [
    'sbp-5','sbp-50','sbp-95',
    'hr-5','hr-95','rr-5','rr-95',
    'ett-uncuffed','ett-cuffed','ett-length',
    'lma','fentanyl','ketamine','rocuronium'
  ].forEach(id => {
    document.getElementById(id).textContent = '';
  });

  // 6) hide emergency drug values + units
  [
    'fentanyl','ketamine','rocuronium',
    'atropine','sux-iv','sux-im',
    'defib','adrenalineiv','fluidbolus','glucose10'
  ].forEach(id => {
    const el   = document.getElementById(id);
    const unit = el.nextElementSibling;
    el.textContent     = '';
    el.style.display   = 'none';
    if (unit && unit.classList.contains('unit')) {
      unit.style.display = 'none';
    }
  });

  // 7) hide GA drug values + units
  [
    'propofol','fentanyl-ga','rocuronium-ga',
    'dexamethasone','ondansetron',
    'paracetamol','ibuprofeniv','ibuprofenpo'
  ].forEach(id => {
    const el   = document.getElementById(id);
    const unit = el.nextElementSibling;
    el.textContent     = '';
    el.style.display   = 'none';
    if (unit && unit.classList.contains('unit')) {
      unit.style.display = 'none';
    }
  });

  // 8) hide i-gel & tidal-volume
  const igelEl = document.getElementById('igel');
  igelEl.textContent = '';
  igelEl.style.display = 'none';

  const tvEl = document.getElementById('tidalvolume');
  tvEl.textContent = '';
  tvEl.style.display = 'none';

  // 9) hide the “cm” unit next to ETT length
  const lenUnit = document.querySelector('#ett-length + .unit');
  if (lenUnit) lenUnit.style.display = 'none';

  // 10) hide static text in normals
  document.querySelectorAll('.normal-values .static')
    .forEach(el => el.style.display = 'none');
}
  
  function updateAnalgesics(w) {
  // remove any old analgesic notes
  document.querySelectorAll('.analgesic-note, .analgesic-note--ibu, .analgesic-note--po').forEach(el => el.remove());

  // PARACETAMOL
  const pEl   = document.getElementById('paracetamol');
  const pUnit = pEl.nextElementSibling; // <span class="static unit">
  let pDose, pNote;

   if (w > 0 && w <= 10) {
    pDose = 10 * w;
    const maxDailyLow = stripZeros((30 * w).toFixed(2));
    pNote = `(10 mg/kg, every 4–6 h; max 30 mg/kg/d = ${maxDailyLow} mg)`;
  } else if (w <= 50) {
    pDose = 15 * w;
    const maxDailyHigh = stripZeros((60 * w).toFixed(2));
    pNote = `(15 mg/kg, every 4–6 h; max 60 mg/kg/d = ${maxDailyHigh} mg)`;
  } else {
    pDose = 1000;
    pNote = `(1 g every 4–6 h; max 4 g/d)`;
  }

  pEl.textContent   = pDose ? stripZeros(pDose.toFixed(2)) : '';
  pEl.style.display = pDose ? 'inline' : 'none';
  if (pUnit) pUnit.style.display = pDose ? 'inline' : 'none';

  if (pDose) {
    pUnit.insertAdjacentHTML('afterend',
      `<small class="analgesic-note"><em> ${pNote}</em></small>`
    );
  }
    
  // — IBUPROFEN IV dosing & notes —
  const iEl   = document.getElementById('ibuprofeniv');
  const iUnit = iEl.nextElementSibling;
  document.querySelectorAll('.analgesic-note--ibu').forEach(el => el.remove());

  const rawAge    = parseFloat(ageInput.value) || 0;
  const ageY      = ageUnit === 'months' ? rawAge/12 : rawAge;
  let ibuText = '', ibuNote = '';

  if (ageY < 6 || w < 20) {
    ibuNote = 'Not recommended for children under 20 kg or below 6 years of age.';
  } else if (ageY < 18) {
    if (w <= 29) {
      ibuText = '200';
      ibuNote = '(TDS, 6–8 hrly, for maximum 3 days; max 600 mg/day.)';
    } else if (w <= 39) {
      ibuText = '200';
      ibuNote = '(QDS, 6 hrly, for maximum 3 days; max 800 mg/day.)';
    } else {
      ibuText = '200–400';
      ibuNote = '(TDS, 6–8 hrly, for maximum 3 days; max 1.2 g/day.)';
    }
  }

  iEl.textContent   = ibuText;
if (ibuText) {
  // numeric dose → show both value and unit
  iEl.style.display   = 'inline';
  if (iUnit) iUnit.style.display = 'inline';
} else {
  // no numeric dose → hide both
  iEl.style.display   = 'none';
  if (iUnit) iUnit.style.display = 'none';
}

if (ibuNote) {
  // warning text always shows
  // append *after* the iEl (so that the small tag
  // floats where iEl used to be)
 iUnit.insertAdjacentHTML('afterend',
  `<small class="analgesic-note--ibu"><em> ${ibuNote}</em></small>`
);
}

  // — IBUPROFEN PO (5–10 mg/kg, cap 400 mg) —
  const poEl   = document.getElementById('ibuprofenpo');
  const poUnit = poEl.nextElementSibling;
  document.querySelectorAll('.analgesic-note--po').forEach(el => el.remove());

  const ageMonths = ageUnit === 'months' ? rawAge : rawAge*12;
  let poText = '', poNote = '';

  if (ageMonths > 3 && w > 0) {
    const dMin = Math.min(5*w, 400);
    const dMax = Math.min(10*w, 400);
    poText = `${dMin.toFixed(0)}–${dMax.toFixed(0)}`;
    poNote = '(Maximum 30 mg/kg/day in 3–4 divided doses)';
  }

  poEl.textContent   = poText;
  poEl.style.display = poText ? 'inline' : 'none';
  if (poUnit) poUnit.style.display = poText ? 'inline' : 'none';

  if (poText) {
    poUnit.insertAdjacentHTML('afterend',
      `<small class="analgesic-note--po"><em> ${poNote}</em></small>`
    );
  }
  }

  // toggle years ↔ months
  function toggleAgeUnit() {
    clearWeight();
    const raw = ageInput.value.trim();
    const n   = parseFloat(raw);
    if (ageUnit === 'years') {
      ageUnit = 'months';
      unitBtn.textContent = 'months';
      ageInput.value = raw!=='' && !isNaN(n) ? Math.round(n*12) : '';
    } else {
      ageUnit = 'years';
      unitBtn.textContent = 'years';
      ageInput.value = raw!=='' && !isNaN(n) ? Math.round((n/12)*10)/10 : '';
    }
  }

  function estimateWeight() {
  clearWeight();
  const a = parseFloat(ageInput.value);
  if (isNaN(a) || a < 0) {
    alert('Please enter a valid age.');
    return;
  }

  // ── SPECIAL CASE for exactly 0 months/years ──
  if (a === 0) {
    const w = 3.5;
    weightIn.value = w;
    calcDiv.innerHTML = `<p>Estimated weight for a neonate = ${w} <span class="unit">kg</span></p>`;
    return;
  }

  const m = ageUnit === 'months' ? a : a * 12;
  if (m < 12) {
    const w     = 0.5 * m + 4;
 const wDisp = stripZeros(w.toFixed(2));             // e.g. "5.75"
  weightIn.value  = wDisp;
  calcDiv.innerHTML =
    `<p>(0.5 × Age in months) + 4 = ${wDisp} <span class="unit">kg</span></p>`;
  return;
  }
  const y = m / 12;
  if (y <= 14) {
    const w1 = Math.round((2 * y + 8) * 10) / 10;
    let html = `<p>(2 × Age) + 8 = ${w1} <span class="unit">kg</span></p>`;
    if (y >= 6) {
      const w2 = Math.round((3 * y + 7) * 10) / 10;
      html += `<p>(3 × Age) + 7 = ${w2} <span class="unit">kg</span></p>`;
    }
    weightIn.value = w1;
    calcDiv.innerHTML = html;
    return;
  }
  alert('Age must be between 0 months and 14 years to estimate weight.');
}

  // paediatric normals table
  const paediatricNormals = {
    0:   { respRate:[25,50], heartRate:[120,170], bp:{p5:65, p50:85, p95:105} },
    1:   { respRate:[25,50], heartRate:[120,170], bp:{p5:65, p50:85, p95:105} },
    3:   { respRate:[25,45], heartRate:[115,160], bp:{p5:65, p50:85, p95:105} },
    6:   { respRate:[20,40], heartRate:[110,160], bp:{p5:65, p50:85, p95:105} },
    12:  { respRate:[20,40], heartRate:[110,160], bp:{p5:70, p50:90, p95:105} },
    18:  { respRate:[20,35], heartRate:[100,155], bp:{p5:70, p50:90, p95:105} },
    24:  { respRate:[20,30], heartRate:[100,150], bp:{p5:70, p50:90, p95:110} },
    36:  { respRate:[20,30], heartRate:[90,140],  bp:{p5:70, p50:90, p95:110} },
    48:  { respRate:[20,30], heartRate:[80,135],  bp:{p5:70, p50:90, p95:110} },
    60:  { respRate:[20,30], heartRate:[80,135],  bp:{p5:80, p50:95, p95:120} },
    72:  { respRate:[20,30], heartRate:[80,130],  bp:{p5:80, p50:95, p95:120} },
    84:  { respRate:[20,30], heartRate:[80,130],  bp:{p5:80, p50:95, p95:120} },
    96:  { respRate:[15,25], heartRate:[70,120],  bp:{p5:80, p50:95, p95:120} },
    108: { respRate:[15,25], heartRate:[70,120],  bp:{p5:80, p50:95, p95:120} },
    120: { respRate:[15,25], heartRate:[70,120],  bp:{p5:80, p50:95, p95:120} },
    132: { respRate:[15,25], heartRate:[70,120],  bp:{p5:80, p50:95, p95:120} },
    144: { respRate:[12,24], heartRate:[65,115],  bp:{p5:90, p50:110,p95:140} },
    168: { respRate:[12,24], heartRate:[60,110],  bp:{p5:90, p50:110,p95:140} }
  };

  // pick the nearest key
  function getNormalValues(age, unit) {
    const months = unit==='months'? age : age*12;
    const keys = Object.keys(paediatricNormals).map(k=>+k).sort((a,b)=>a-b);
    if (months < 12) {
      const mks = keys.filter(k=>k<12);
      return paediatricNormals[mks.reduce((a,b)=>Math.abs(b-months)<Math.abs(a-months)?b:a, mks[0])];
    } else {
      const ideal = Math.floor(months/12)*12;
      const below = keys.filter(k=>k<=ideal);
      const key   = below.length? below.pop() : keys.find(k=>k>=12);
      return paediatricNormals[key];
    }
  }

  // show centiles
  function updateNormalCentiles(n) {
    document.getElementById('sbp-5').textContent   = n.bp.p5;
    document.getElementById('sbp-50').textContent  = n.bp.p50;
    document.getElementById('sbp-95').textContent  = n.bp.p95;
    document.getElementById('hr-5').textContent    = n.heartRate[0];
    document.getElementById('hr-95').textContent   = n.heartRate[1];
    document.getElementById('rr-5').textContent    = n.respRate[0];
    document.getElementById('rr-95').textContent   = n.respRate[1];
    document.querySelectorAll('.normal-values .static')
      .forEach(el => el.style.display='inline');
  }

  // airway calcs (unchanged)
  function updateAirwayCalculations(ageYears) {
     document.querySelectorAll('.airway-note').forEach(el => el.remove());
    const w = parseFloat(weightIn.value)||0;
    const m = ageUnit==='months'? parseFloat(ageInput.value) : ageYears*12;
    let unc='', cuff='', len='';
    const uncEl  = document.getElementById('ett-uncuffed').parentElement;
    const cuffEl = document.getElementById('ett-cuffed').parentElement;
    const lenUnit= document.querySelector('#ett-length + .unit');

   if (isNaN(m) || m < 0) {
  // only hide if age is _negative_ or invalid
  uncEl.style.display    = 'none';
  cuffEl.style.display   = 'none';
  lenUnit && (lenUnit.style.display = 'none');
} else if (m < 12) {
      if(w<1) unc=2.5,len=6.5;
      else if(w<2) unc=3,len=7;
      else if(w<3) unc=3.5,len=8;
      else if(w<4) unc=3.5,len=9;
      else unc=4,len=10;
  cuff = unc - 0.5;
    } else {
       unc  = ageYears/4 + 4;
  cuff = ageYears/4 + 3.5;
  len  = ageYears/2 + 12;
    }
    
// use let so we can override cuffText
let uncText  = unc   ? stripZeros(unc.toFixed(2))   : '';
let cuffText = cuff  ? stripZeros(cuff.toFixed(2))  : '';
let lenText  = len   ? stripZeros(len.toFixed(2))   : '';

// only show uncuffed if under 3.5kg
if (w < 3.5) {
  cuffText = '';
}
    
// write into the DOM
const uncSpan   = document.getElementById('ett-uncuffed');
const uncLabel  = document.getElementById('uncuffed-label');
const cuffSpan  = document.getElementById('ett-cuffed');
const cuffLabel = document.getElementById('cuffed-label');
const orEl      = document.getElementById('ett-or');      // only declared here
const lenSpan   = document.getElementById('ett-length');

// write the values
uncSpan.textContent  = uncText;
cuffSpan.textContent = cuffText;
lenSpan .textContent = lenText;

// show/hide individual spans & labels
uncSpan .style.display = uncText  ? 'inline' : 'none';
uncLabel.style.display = uncText  ? 'inline' : 'none';
cuffSpan.style.display = cuffText ? 'inline' : 'none';
cuffLabel.style.display= cuffText ? 'inline' : 'none';
if (lenUnit) lenUnit.style.display = lenText ? 'inline' : 'none';

// only show the “or” if both uncuffed & cuffed are visible
orEl.style.display = (uncText && cuffText) ? 'inline' : 'none';
    
   if (m === 0) {
  // clear any old airway notes
  document.querySelectorAll('.airway-note').forEach(el => el.remove());

  // 1) size guidance
  let sizeNote = '';
  if (w < 1)        sizeNote = 'Size 2.5: For infants < 1 kg or < 28 weeks of gestational age';
  else if (w < 2)   sizeNote = 'Size 3.0: For infants 1–2 kg or 28–34 weeks of gestational age';
  else              sizeNote = 'Size 3.5: For infants > 2 kg or > 34 weeks of gestational age';

  uncEl.insertAdjacentHTML('afterend',
    `<p class="airway-note"><em>${sizeNote}</em></p>`
  );

  // 2) **new** insertion‐depth formula under the length line
  lenSpan.parentElement.insertAdjacentHTML('afterend',
    `<p class="airway-note"><em>Estimated depth of neonatal ET insertion = 1.17 × birth weight (kg) + 5.58; 7-8-9 rule</em></p>`
  );
}
    
    if (m >= 12) {
    // after the entire ETT‐size line:
    uncEl.insertAdjacentHTML('afterend',
      `<p class="airway-note"><em>Uncuffed ETT size = (Age/4) + 4; decrease by 0.5 for cuffed</em></p>`
    );
    // after the length‐at‐lips line:
    lenSpan.parentElement.insertAdjacentHTML('afterend',
      `<p class="airway-note"><em>(Age/2) + 12</em></p>`
    );
  }
    
    const igel = (w<=0||isNaN(w))? '' :
      w<=5?'1.0 (Neonate, 2-5 kg)':
      w<=10?'1.5 (Infant, 5-12 kg)':
      w<=25?'2.0 (Small Paediatric, 10-25 kg)':
      w<=35?'2.5 (Large Paediatric, 25-35 kg)':
      w<=60?'3.0 (Small Adult, 30-60 kg)':
      w<=90?'4.0 (Medium Adult)':'5.0 (Large Adult, 50-90 kg)';
    
    // block for LMA sizing ---
  const lmaSize = (w <= 0 || isNaN(w)) ? '' :
    w <= 5   ? '1.0 (<5kg)'   :
    w <= 10  ? '1.5 (5-10 kg)' :
    w <= 20  ? '2.0 (10-20 kg)'   :
    w <= 30  ? '2.5 (20-30 kg)' :
    w <= 50  ? '3.0 (30-50 kg)'   :
    w <= 70  ? '4.0 (50-70 kg)'   :
    w <= 100 ? '5.0 (70-100 kg)'   :
               '';
   
    const igelEl = document.getElementById('igel');
if (igel) {
  igelEl.textContent    = igel;
  igelEl.style.display  = 'inline';
} else {
  igelEl.style.display  = 'none';
}
    
    const lmaEl = document.getElementById('lma');
  lmaEl.textContent = lmaSize;
  // show or hide the <div> around it
  lmaEl.parentElement.style.display = lmaSize ? 'block' : 'none';
    
    // tidal volume 6–8 ml/kg
 const tvEl = document.getElementById('tidalvolume');
if (w > 0 && !isNaN(w)) {
  const tvMin = Math.round(6 * w);
  const tvMax = Math.round(8 * w);
  tvEl.textContent      = `${tvMin} – ${tvMax} ml`;
  tvEl.style.display    = 'inline';
} else {
  tvEl.style.display    = 'none';
  
}
      // — LARYNGOSCOPE BLADE SIZING —
  const laryngoscopeEl      = document.getElementById('laryngoscope');
  
  if (w > 0) {
    let blade = '';
    if (w < 1.5)             blade = 'Miller 00 or 0 [Extremely preterm]';
    else if (w < 2.5)      blade = 'Mac 0 (Neonate) / Miller 0 [Preterm]';
    else if (w < 4)        blade = 'Mac 0 (Neonate) – 1 (Baby) / Miller 0-1';
    else if (w < 6)        blade = 'Mac 1 (Baby) / Miller 1 [1–6 months]';
    else if (w < 12)       blade = 'Mac 1 (Baby) – 2 (Child) / Miller 1–2 [6 months–2 years]';
    else if (w < 30)       blade = 'Mac 2 (Child) [2–10 years]';
    else if (w <= 60)      blade = 'Mac 3 (Adult) [10+ years]';
    else if (w > 60)      blade = 'Mac 3 / Mac 4 [Large Adult]';
   if (blade) {
  laryngoscopeEl.textContent = blade;
  laryngoscopeEl.style.display = 'inline';
} else {
  laryngoscopeEl.style.display = 'none';
}  
  }
     updateEmergencyDrugs(w);
    updateGADrugs(w);
    updateAnalgesics(w);
  }
  
function updateEmergencyDrugs(w) {
  // remove any old volume/notes after a unit-span
  function clearNote(unitSpan) {
    if (!unitSpan) return;
    let next = unitSpan.nextElementSibling;
    while (next && next.classList.contains('calc-note')) {
      const toRemove = next;
      next = next.nextElementSibling;
      toRemove.remove();
    }
  }

  // grab all numeric spans + their unit spans
  const fentanylEl     = document.getElementById('fentanyl'),
        fentanylUnit   = fentanylEl.nextElementSibling,
        ketamineEl     = document.getElementById('ketamine'),
        ketamineUnit   = ketamineEl.nextElementSibling,
        rocuroniumEl   = document.getElementById('rocuronium'),
        rocuroniumUnit = rocuroniumEl.nextElementSibling,
        atropineEl     = document.getElementById('atropine'),
        atropineUnit   = atropineEl.nextElementSibling,
        suxIvEl        = document.getElementById('sux-iv'),
        suxIvUnit      = suxIvEl.nextElementSibling,
        suxImEl        = document.getElementById('sux-im'),
        suxImUnit      = suxImEl.nextElementSibling,
        defibEl        = document.getElementById('defib'),
        defibUnit      = defibEl.nextElementSibling,
        adrenalineEl   = document.getElementById('adrenalineiv'),
        adrenalineUnit = adrenalineEl.nextElementSibling,
        bolusEl        = document.getElementById('fluidbolus'),
        bolusUnit      = bolusEl.nextElementSibling,
        glucoseEl      = document.getElementById('glucose10'),
        glucoseUnit    = glucoseEl.nextElementSibling;

  if (w > 0 && !isNaN(w)) {
    //— FENTANYL 1–2 mcg/kg @ 50 mcg/ml —
    clearNote(fentanylUnit);
    const fMin = stripZeros((1 * w).toFixed(1)),
          fMax = stripZeros((2 * w).toFixed(1)),
          vMin = stripZeros((fMin  / 50).toFixed(2)),
          vMax = stripZeros((fMax  / 50).toFixed(2));
    fentanylEl.textContent     = `${fMin}–${fMax}`;
    fentanylEl.style.display   = 'inline';
    fentanylUnit.style.display = 'inline';
    fentanylUnit.insertAdjacentHTML('afterend',
      `<small class="calc-note"><em> (${vMin}–${vMax} ml of 50 mcg/ml)</em></small>`
    );

     // KETAMINE 1–2 mg/kg @ 10 mg/ml
    clearNote(ketamineUnit);
    const kMin   = stripZeros((1 * w).toFixed(1)),
          kMax   = stripZeros((2 * w).toFixed(1)),
          kVolMin = stripZeros((kMin / 10).toFixed(2)),
          kVolMax = stripZeros((kMax / 10).toFixed(2));
    ketamineEl.textContent     = `${kMin}–${kMax}`;
    ketamineUnit.style.display = 'inline';
    ketamineEl.style.display   = 'inline';
    ketamineUnit.insertAdjacentHTML('afterend',
      `<small class="calc-note"><em> (${kVolMin}–${kVolMax} ml of 10 mg/ml)</em></small>`
    );

    //— ROCURONIUM 1 mg/kg @ 10 mg/ml —
    clearNote(rocuroniumUnit);
    const rDose = stripZeros((1 * w).toFixed(1)),
          rVol  = stripZeros((rDose  / 10).toFixed(2));
    rocuroniumEl.textContent     = rDose;
    rocuroniumEl.style.display   = 'inline';
    rocuroniumUnit.style.display = 'inline';
    rocuroniumUnit.insertAdjacentHTML('afterend',
      `<small class="calc-note"><em> (${rVol} ml of 10 mg/ml)</em></small>`
    );

    //— ATROPINE 20 mcg/kg @ 600 mcg/ml —
    clearNote(atropineUnit);
    const aDose = stripZeros((20 * w).toFixed(1)),
          aVol  = stripZeros((aDose / 600).toFixed(2));
    atropineEl.textContent     = aDose;
    atropineEl.style.display   = 'inline';
    atropineUnit.style.display = 'inline';
    atropineUnit.insertAdjacentHTML('afterend',
      `<small class="calc-note"><em> (${aVol} ml of 600 mcg/ml)</em></small>`
    );

    //— SUXAMETHONIUM IV 1–2 mg/kg @ 50 mg/ml —
    clearNote(suxIvUnit);
    const sIVmin = stripZeros((1 * w).toFixed(1)),
          sIVmax = stripZeros((2 * w).toFixed(1)),
          ivVolMin = stripZeros((sIVmin / 50).toFixed(2)),
          ivVolMax = stripZeros((sIVmax / 50).toFixed(2));
    suxIvEl.textContent     = `${sIVmin}–${sIVmax}`;
    suxIvEl.style.display   = 'inline';
    suxIvUnit.style.display = 'inline';
    suxIvUnit.insertAdjacentHTML('afterend',
      `<small class="calc-note"><em> (${ivVolMin}–${ivVolMax} ml of 50 mg/ml)</em></small>`
    );

    //— SUXAMETHONIUM IM 4 mg/kg (max 150 mg) @ 50 mg/ml —
    clearNote(suxImUnit);
    let imDose = 4 * w;
    if (imDose > 150) imDose = 150;
    const sIMdose = stripZeros(imDose.toFixed(1)),
          imVol    = stripZeros((sIMdose / 50).toFixed(2));
    suxImEl.textContent     = sIMdose;
    suxImEl.style.display   = 'inline';
    suxImUnit.style.display = 'inline';
    suxImUnit.insertAdjacentHTML('afterend',
      `<small class="calc-note"><em> (${imVol} ml of 50 mg/ml)</em></small>`
    );

    //— DEFIBRILLATION ENERGY 4 J/kg —
    const defibDose = stripZeros((4 * w).toFixed(1));
    defibEl.textContent     = defibDose;
    defibEl.style.display   = 'inline';
    defibUnit.style.display = 'inline';

    //— ADRENALINE IV 0.1 ml/kg (0.1 mg/ml) —
    clearNote(adrenalineUnit);
    const vol = stripZeros((0.1 * w).toFixed(2)),
          mg  = stripZeros((vol * 0.1).toFixed(2));
    adrenalineEl.textContent     = vol;
    adrenalineEl.style.display   = 'inline';
    adrenalineUnit.style.display = 'inline';
    adrenalineUnit.insertAdjacentHTML('afterend',
      `<small class="calc-note"><em> (${mg} mg)</em></small>`
    );

    //— FLUID BOLUS 10–20 ml/kg —
    const bolusMin = Math.round(10 * w),
          bolusMax = Math.round(20 * w);
    bolusEl.textContent     = `${bolusMin}–${bolusMax}`;
    bolusEl.style.display   = 'inline';
    bolusUnit.style.display = 'inline';

    //— GLUCOSE 10% 2 ml/kg —
    const gluDose = stripZeros((2 * w).toFixed(1));
    glucoseEl.textContent     = gluDose;
    glucoseEl.style.display   = 'inline';
    glucoseUnit.style.display = 'inline';

  } else {
    // hide everything if no valid weight
    [fentanylEl, ketamineEl, rocuroniumEl,
     atropineEl, suxIvEl, suxImEl,
     defibEl, adrenalineEl, bolusEl, glucoseEl
    ].forEach(el => {
      el.style.display = 'none';
      const u = el.nextElementSibling;
      if (u && u.classList.contains('unit')) u.style.display = 'none';
      clearNote(u);
    });
  }
}
  
    function updateGADrugs(w) {
  // clear any old notes first
  document.querySelectorAll('.general-section .calc-note').forEach(el => el.remove());

  const drugs = [
    // id,  min-dose, max-dose,   conc per ml,       unit
    { id: 'propofol',    min: 3,   max: 5,    conc: 10,     unit: 'mg'  },
    { id: 'fentanyl-ga', min: 1,   max: 2,    conc: 50,     unit: 'mcg' },
    { id: 'rocuronium-ga', min: 0.6, max: 0.6, conc: 10,     unit: 'mg'  },
    { id: 'dexamethasone', min: 0.15, max: 0.15, conc: 3.3,   unit: 'mg'  },
    { id: 'ondansetron',  min: 0.15, max: 0.15, conc: 2,      unit: 'mg'  },
  ];

  drugs.forEach(({ id, min, max, conc, unit }) => {
    const el    = document.getElementById(id);
    const uSpan = el.nextElementSibling; // the `<span class="static unit">`

    // compute dose
    const dMin = stripZeros((min * w).toFixed(1));
    const dMax = stripZeros((max * w).toFixed(1));
    const doseText = (min === max) ? dMin : `${dMin}–${dMax}`;

    // compute volume in ml
    const vMin = stripZeros((dMin / conc).toFixed(2));
    const vMax = stripZeros((dMax / conc).toFixed(2));
    const volText = (min === max) ? `${vMin}` : `${vMin}–${vMax}`;

    // update DOM
    el.textContent       = doseText;
    el.style.display     = w > 0 ? 'inline' : 'none';
    if (uSpan) uSpan.style.display = w > 0 ? 'inline' : 'none';

    // append the little italic volume note
    if (w > 0) {
      uSpan.insertAdjacentHTML('afterend',
        `<small class="calc-note"><em> (${volText} ml of ${conc}${unit}/ml)</em></small>`
      );
    }
  });
}

  // event wiring
  unitBtn.addEventListener('click', toggleAgeUnit);
  estBtn .addEventListener('click', () => {
    estimateWeight();
    const a = parseFloat(ageInput.value)||0,
          y = ageUnit==='months'? a/12 : a;
    const normals = getNormalValues(a, ageUnit);
    if(normals) updateNormalCentiles(normals);
    if(!isNaN(y)) updateAirwayCalculations(y);
     expandOpenAccordion();
  });

  ageInput.addEventListener('input', () => {
    weightIn.value = '';
  clearWeight();
    const a = parseFloat(ageInput.value);
    if(isNaN(a)) return clearWeight();
    const y = ageUnit==='months'? a/12 : a;
    updateAirwayCalculations(y);
    const normals = getNormalValues(a, ageUnit);
    if(normals) updateNormalCentiles(normals);
     expandOpenAccordion();
  });

  weightIn.addEventListener('input', () => {
     // 1) if no age has been entered, treat it as zero
  if (ageInput.value.trim() === '') {
    ageInput.value = '0';
  }
    const a = parseFloat(ageInput.value),
          w = parseFloat(weightIn.value);
    if(isNaN(a)||isNaN(w)) return clearWeight();
    const y = ageUnit==='months'? a/12 : a;
    updateAirwayCalculations(y);
    const normals = getNormalValues(a, ageUnit);
    if(normals) updateNormalCentiles(normals);

    let disp = '', m = ageUnit==='months'? a : a*12;
    if(m<12) {
      const e = 0.5*m+4;
      if(Math.abs(e-w)<0.2) disp = `<p>(0.5 × Age in months) + 4 = ${stripZeros(w.toFixed(1))} <span class="unit">kg</span></p>`;
    } else {
      const e1 = 2*y+8;
      if(Math.abs(e1-w)<0.2) disp = `<p>(2 × Age) + 8 = ${stripZeros(w.toFixed(1))} <span class="unit">kg</span></p>`;
      else if(y>=6) {
        const e2 = 3*y+7;
        if(Math.abs(e2-w)<0.2) disp = `<p>(3 × Age) + 7 = ${stripZeros(w.toFixed(1))} <span class="unit">kg</span></p>`;
      }
    }
    calcDiv.innerHTML = disp;
     expandOpenAccordion();
  });

  document.addEventListener('DOMContentLoaded', clearWeight);
  
  // Reset everything back to the initial state
function resetForm() {
  // 1) clear the inputs
  ageInput.value = '';
  weightIn.value = '';
  // 2) reset the toggle back to years
  ageUnit = 'years';
  unitBtn.textContent = 'years';
  // 3) hide all existing outputs
  clearWeight();
}

// Optional: home button handler if you want
function goHome() {
  window.location.href = '/'; // or 'index.html'
}
  
  document.querySelectorAll('.accordion-header').forEach(header => {

    header.addEventListener('click', () => {

      const content = header.nextElementSibling;

      const isOpen = content.classList.contains('show');

      header.classList.toggle('active');

      content.classList.toggle('show');

      // Remove inline max-height after animation for better reset

      if (!isOpen) {

        content.style.maxHeight = content.scrollHeight + "px";

      } else {

        content.style.maxHeight = null;

      }

    });

  });

function expandOpenAccordion() {
  const openContent = document.querySelector('.accordion-content.show');
  if (!openContent) return;
  // reset so browser re-measures
  openContent.style.maxHeight = null;
  // then set to new height
  openContent.style.maxHeight = openContent.scrollHeight + 'px';
}
  
</script>

</body>
</html>
