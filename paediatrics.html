<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Paediatric anaesthetic calculator</title>
  <link rel="stylesheet" href="styles.css" />
  <link
    href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700&display=swap"
    rel="stylesheet"
  />
  <link
    href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap"
    rel="stylesheet"
  />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <style>
    header.banner {
      background: linear-gradient(130deg, #E65100 0%, #F57C00 100%);
    }
    .unit-toggle, .estimate-btn {
      font-size: 16px;
      margin: 5px;
      padding: 4px 8px;
      cursor: pointer;
    }
    .estimate-btn {
      background: #f0f0f0;
      border: 1px solid #ccc;
      border-radius: 5px;
      width: 80px;
    }
    .unit-toggle {
      width: 80px;
    }
    /* new styles for the calculation display */
    #weight-calculations {
      margin: 8px 5px;
      font-family: inherit;
      line-height: 1.4;
      font-size: 12px;
    }
    #weight-calculations p {
      margin: 2px 0;
    }
    .unit {
      font-weight: 400;
      color: #000;
    }
    .normal-values {
  font-family: inherit;
      margin: 0 auto 20px auto;
      padding: 15px;
      border: 1px solid #ccc;
      border-radius: 10px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      background-color: #fff;
      box-sizing: border-box;
}
     .airway-section {
  font-family: inherit;
      margin: 0 auto 20px auto;
      padding: 15px;
      border: 1px solid #ccc;
      border-radius: 10px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      background-color: #fff;
      box-sizing: border-box;
}
    .emergency-section {
  font-family: inherit;
      margin: 0 auto 20px auto;
      padding: 15px;
      border: 1px solid #ccc;
      border-radius: 10px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      background-color: #fff;
      box-sizing: border-box;
}
    .section {
      margin: 0 auto 16px auto;
      padding: 10px;
      border: 1px solid #f0c197;
      border-radius: 10px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      box-sizing: border-box;
      background: linear-gradient(to right, #fffaf5, #fff3e0);
    }
      .section-header {
      font-weight: 700;
        text-align: center;
        margin: 0 0 10px;
    }
    .normal-values .static {
  display: none;
}
.result {
  font-size: 16px;
  font-weight: 400;
  color: #000;
  margin: 5px;
}
    .normal-values .result:first-child {
  margin-top: 0;
}
    .input-group {
  display: flex;
  align-items: center;
  margin: 5px;
}
.accordion {
    font-family: 'Roboto', sans-serif;
    max-width: 600px;
    margin: 0px auto;
  }
  .accordion-item {
    margin-bottom: 16px;
    border: 1px solid #f0c197;
    border-radius: 12px;
    background: linear-gradient(to right, #fffaf5, #fff3e0);
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
    overflow: hidden;
  }
  .accordion-header {
    background: transparent;
    color: #333;
    padding: 16px 18px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    cursor: pointer;
    font-weight: 700;
    font-size: 1.05em;
    transition: background 0.3s ease;
  }
  .accordion-header.active {

    background: rgba(255, 188, 112, 0.15);

  }
  .accordion-title {
    display: flex;
    align-items: center;
    gap: 10px;
  }
  .accordion-title i:first-child {
    color: #F57C00;
    font-size: 1.2em;
  }
  .accordion-header .fa-plus,
  .accordion-header .fa-minus {
    color: #F57C00;
    transition: opacity 0.3s ease;
  }
  .accordion-header .fa-minus {
    display: none;
  }
  .accordion-header.active .fa-plus {
    display: none;
  }
  .accordion-header.active .fa-minus {
    display: inline;
  }
  .accordion-content {
    max-height: 0;
    opacity: 0;
    overflow: hidden;
    background: #fffaf5;
    transition: max-height 0.4s ease, opacity 0.3s ease;
    font-size: 0.95em;
    color: #444;
    padding: 0 18px;
  }
  .accordion-content-inner {
    padding: 16px 0;
  }
  .accordion-content.show {
    opacity: 1;
  }
    .airway-note {
  margin: 4px 0 8px 5px;
  font-size: 12px;
  font-style: italic;
  color: #444;
}
.estimate-toggle {
  display: inline-flex;
  align-items: center;
  cursor: pointer;
  user-select: none;
  margin: 5px;             /* adjust spacing as needed */
}

/* Hide the native checkbox */
.estimate-toggle input[type="checkbox"] {
  opacity: 0;
  width: 0;
  height: 0;
  position: absolute;
}

/* The track + the round knob together live in this span */
.estimate-toggle .slider {
  position: relative;
  width: 40px;    /* total width of the switch */
  height: 20px;   /* total height of the switch */
  background-color: #ccc;
  border-radius: 10px;
  transition: background-color 0.2s ease;
  margin-right: 0px;  /* spacing between switch and text */
  flex-shrink: 0;
}

/* The white circular knob inside the track */
.estimate-toggle .slider::before {
  content: "";
  position: absolute;
  top: 2px;
  left: 2px;
  width: 16px;
  height: 16px;
  background-color: white;
  border-radius: 50%;
  transition: transform 0.2s ease;
}

/* When the checkbox is checked, turn track green */
.estimate-toggle input:checked + .slider {
  background-color: #4caf50;
}

/* When checked, move the knob to the right */
.estimate-toggle input:checked + .slider::before {
  transform: translateX(20px);
}

/* The visible text next to the slider */
.estimate-toggle .toggle-label {
  font-size: 14px;
  color: #333;
   margin-left: -8px;
}
    #weight {
  margin-right: 12px;
}
    .result table {
      font-size:12px;
    }
  </style>
</head>
<body>
  <header class="banner">Paediatric anaesthesia</header>

  <div class="section">
  <div class="input-group">
    <label for="age">Age:</label>
    <input type="number" id="age" min="0" placeholder="0" />
    <button class="unit-toggle" id="AgeUnitBtn">years</button>
  </div>

    
    
  <div class="input-group">
  <label for="weight">Weight (kg):</label>
  <input type="number" id="weight" min="0" placeholder="0" />
     <label class="estimate-toggle">
    <input type="checkbox" id="EstimateToggle" checked>
    <span class="slider"></span>
    <span class="toggle-label">Estimate weight</span>
  </label>
</div>

  <!-- new container for showing the two formula lines -->
  <div id="weight-calculations"></div>
  </div>
    
  <div class="accordion">

  <div class="accordion-item">

    <div class="accordion-header">

      <span class="accordion-title">

        <i class="fas fa-stethoscope"></i> Normal physiological values

      </span>

      <span>

        <i class="fas fa-plus"></i>

        <i class="fas fa-minus"></i>

      </span>

    </div>

    <div class="accordion-content">

      <div class="accordion-content-inner">

  <div class="result">
    <strong>SBP</strong>:
  <span id="sbp-50"></span>
    <span class="static unit"> mmHg</span>
  <span class="static">(</span>
    <span id="sbp-5"></span>
    <span class="static">–</span>
    <span id="sbp-95"></span>
    
  <span class="static"><span class="static unit"> mmHg</span>) *</span>
</div>

  <div class="result">
    <strong>HR</strong>:
  <span id="hr-5"></span>
  <span class="static">–</span>
  <span id="hr-95"></span>
    <span class="static unit"> bpm</span> **
</div>
    
  <div class="result">
    <strong>RR</strong>:
  <span id="rr-5"></span>
  <span class="static">–</span>
  <span id="rr-95"></span>
  <span class="static unit"> bpm</span> **
</div>
        <small>*(50th centile, 5th–95th)<br>**(5th–95th centile)</small>
      </div>
      </div>
    </div>
  
  <div class="accordion-item">

    <div class="accordion-header">

      <span class="accordion-title">

        <i class="fas fa-mask-face"></i> Airway and Ventilation

      </span>

      <span>

        <i class="fas fa-plus"></i>

        <i class="fas fa-minus"></i>

      </span>

    </div>

    <div class="accordion-content">

      <div class="accordion-content-inner">
<div class="result">
  <strong>ETT size</strong>:
  <span id="ett-uncuffed"></span>
  <small id="uncuffed-label">(Uncuffed)</small>
  <span id="ett-or" style="display:none; margin:0 4px;">or</span>
  <span id="ett-cuffed"></span>
  <small id="cuffed-label">(Cuffed)</small>
</div>

    <div class="result"><strong>ETT length at lips</strong>:
   <span id="ett-length"></span>
    <span class="static unit"> cm</span></div>
    <div class="result"><strong>Laryngoscope blade</strong>:<br>
   <span id="laryngoscope"></span>
    </div>
   <br> 
    <div class="result"><strong>LMA size</strong>:
  <span id="lma"></span></div>
    <div class="result">
  <strong>i-Gel size</strong>:
  <span id="igel"></span>
</div>
    <br>
    <div class="result">
  <strong>Tidal volume (6-8 ml/kg)</strong>:
  <span id="tidalvolume"></span>
  </div>
  </div>
      </div>      
</div>
  
<div class="accordion-item">

    <div class="accordion-header">

      <span class="accordion-title">

        <i class="fas fa-syringe"></i> Emergency Intubation

      </span>

      <span>

        <i class="fas fa-plus"></i>

        <i class="fas fa-minus"></i>

      </span>

    </div>

  <div class="accordion-content">
  <div class="accordion-content-inner">
      <div class="result">
    <table style="width: 100%; border-collapse: collapse;">
  <!-- Fentanyl -->
  <tr style="background-color: #98c9ee;">
    <td style="padding: 8px; border: 1px solid #ccc;">
      <strong>Fentanyl</strong>
    </td>
    <td style="padding: 8px; border: 1px solid #ccc;">
      <small>1–2 mcg/kg</small>
    </td>
    <td style="padding: 8px; border: 1px solid #ccc; text-align: right;">
      <span id="fentanyl"></span><span class="static unit"> mcg</span>
    </td>
  </tr>
  <tr style="background-color: #e0effa;">
    <td colspan="3" style="padding: 8px; border: 1px solid #ccc; text-align: center;">
      <small id="fentanyl-vol-extra"></small>
    </td>
  </tr>

  <!-- Ketamine -->
  <tr style="background-color: #ffe733;">
    <td style="padding: 8px; border: 1px solid #ccc;">
      <strong>Ketamine</strong>
    </td>
    <td style="padding: 8px; border: 1px solid #ccc;">
      <small>1–2 mg/kg</small>
    </td>
    <td style="padding: 8px; border: 1px solid #ccc; text-align: right;">
      <span id="ketamine"></span><span class="static unit"> mg</span>
    </td>
  </tr>
  <tr style="background-color: #fff9bf;">
    <td colspan="3" style="padding: 8px; border: 1px solid #ccc; text-align: center;">
      <small id="ketamine-vol-extra"></small>
    </td>
  </tr>

  <!-- Rocuronium -->
  <tr style="background-color: #ec6f73;">
    <td style="padding: 8px; border: 1px solid #ccc;">
      <strong>Rocuronium</strong>
    </td>
    <td style="padding: 8px; border: 1px solid #ccc;">
      <small>1 mg/kg</small>
    </td>
    <td style="padding: 8px; border: 1px solid #ccc; text-align: right;">
      <span id="rocuronium"></span><span class="static unit"> mg</span>
    </td>
  </tr>
  <tr style="background-color: #f8d5d5;">
    <td colspan="3" style="padding: 8px; border: 1px solid #ccc; text-align: center;">
      <small id="rocuronium-vol-extra"></small>
    </td>
  </tr>
</table>

<br>

<table style="width: 100%; border-collapse: collapse;">
  <!-- Atropine -->
  <tr style="background-color: #a3ce6f;">
    <td style="padding: 8px; border: 1px solid #ccc;">
      <strong>Atropine</strong>
    </td>
    <td style="padding: 8px; border: 1px solid #ccc;">
      <small>20 mcg/kg</small>
    </td>
    <td style="padding: 8px; border: 1px solid #ccc; text-align: right;">
      <span id="atropine"></span><span class="static unit"> mcg</span>
    </td>
  </tr>
  <tr style="background-color: #e3f0d4;">
    <td colspan="3" style="padding: 8px; border: 1px solid #ccc; text-align: center;">
      <small id="atropine-vol-extra"></small>
    </td>
  </tr>

  <!-- Adrenaline IV 1:10,000 -->
  <tr style="background-color: #d3ace5;">
    <td style="padding: 8px; border: 1px solid #ccc;">
      <strong>Adrenaline IV 1:10,000</strong>
    </td>
    <td style="padding: 8px; border: 1px solid #ccc;">
      <small>0.1 mL/kg</small>
    </td>
    <td style="padding: 8px; border: 1px solid #ccc; text-align: right;">
      <span id="adrenalineiv"></span><span class="static unit"> mL</span>
    </td>
  </tr>
  <tr style="background-color: #f2e6f7;">
    <td colspan="3" style="padding: 8px; border: 1px solid #ccc; text-align: center;">
      <small id="adrenalineiv-vol-extra"></small>
    </td>
  </tr>
</table>

<br>

<table style="width: 100%; border-collapse: collapse;">
  <!-- Suxamethonium IV -->
  <tr style="background-color: #ec6f73;">
    <td style="padding: 8px; border: 1px solid #ccc;">
      <strong>Suxamethonium IV</strong>
    </td>
    <td style="padding: 8px; border: 1px solid #ccc;">
      <small>1–2 mg/kg</small>
    </td>
    <td style="padding: 8px; border: 1px solid #ccc; text-align: right;">
      <span id="sux-iv"></span><span class="static unit"> mg</span>
    </td>
  </tr>
  <tr style="background-color: #f8d5d5;">
    <td colspan="3" style="padding: 8px; border: 1px solid #ccc; text-align: center;">
      <small id="sux-iv-vol-extra"></small>
    </td>
  </tr>

  <!-- Suxamethonium IM -->
  <tr style="background-color: #ec6f73;">
    <td style="padding: 8px; border: 1px solid #ccc;">
      <strong>Suxamethonium IM</strong>
    </td>
    <td style="padding: 8px; border: 1px solid #ccc;">
      <small>4 mg/kg (Max 150 mg)</small>
    </td>
    <td style="padding: 8px; border: 1px solid #ccc; text-align: right;">
      <span id="sux-im"></span><span class="static unit"> mg</span>
    </td>
  </tr>
  <tr style="background-color: #f8d5d5;">
    <td colspan="3" style="padding: 8px; border: 1px solid #ccc; text-align: center;">
      <small id="sux-im-vol-extra"></small>
    </td>
  </tr>
</table>

<br>

<table style="width: 100%; border-collapse: collapse;">
  <!-- Non‐drug items (single rows) -->
  <tr>
    <td style="padding: 8px; border: 1px solid #ccc; background-color: #bcbdc0;">
      <strong>Fluid bolus</strong>
    </td>
    <td style="padding: 8px; border: 1px solid #ccc; background-color: #e8e6e4;">
      <small>10–20 mL/kg</small>
    </td>
    <td style="padding: 8px; border: 1px solid #ccc; text-align: right; background-color: #e8e6e4;">
      <span id="fluidbolus"></span><span class="static unit"> mL</span>
    </td>
  </tr>
  <tr>
    <td style="padding: 8px; border: 1px solid #ccc; background-color: #bcbdc0;">
      <strong>Glucose 10%</strong>
    </td>
    <td style="padding: 8px; border: 1px solid #ccc; background-color: #e8e6e4;">
      <small>2 mL/kg</small>
    </td>
    <td style="padding: 8px; border: 1px solid #ccc; text-align: right; background-color: #e8e6e4;">
      <span id="glucose10"></span><span class="static unit"> mL</span>
    </td>
  </tr>
  <tr>
    <td style="padding: 8px; border: 1px solid #ccc; background-color: #bcbdc0;">
      <strong>Defibrillation energy</strong>
    </td>
    <td style="padding: 8px; border: 1px solid #ccc; background-color: #e8e6e4;">
      <small>4 J/kg</small>
    </td>
    <td style="padding: 8px; border: 1px solid #ccc; text-align: right; background-color: #e8e6e4;">
      <span id="defib"></span><span class="static unit"> J</span>
    </td>
  </tr>
</table>
  </div>
</div>
    </div>
  </div>
  
<div class="accordion-item">

    <div class="accordion-header">

      <span class="accordion-title">

        <i class="fas fa-syringe"></i> Routine General Anaesthetic

      </span>

      <span>

        <i class="fas fa-plus"></i>

        <i class="fas fa-minus"></i>

      </span>

    </div>

    <div class="accordion-content">

      <div class="accordion-content-inner general-section">      
 
  <div class="result">
    
    <table style="width: 100%; border-collapse: collapse;">

          <!-- Fentanyl GA -->
          <tr style="background-color: #98c9ee;">
            <td style="padding: 8px; border: 1px solid #ccc;">
              <strong>Fentanyl</strong>
            </td>
            <td style="padding: 8px; border: 1px solid #ccc;">
              <small>1–2 mcg/kg</small>
            </td>
            <td style="padding: 8px; border: 1px solid #ccc; text-align: right;">
              <span id="fentanyl-ga"></span>
              <span class="static unit">&nbsp;mcg</span>
            </td>
          </tr>
          <tr style="background-color: #e0f0ff;">
            <td colspan="3" style="padding: 8px; border: 1px solid #ccc; text-align: center;">
              <small id="fentanyl-ga-extra"></small>
            </td>
          </tr>

          <!-- Propofol GA -->
          <tr style="background-color: #ffe733;">
            <td style="padding: 8px; border: 1px solid #ccc;">
              <strong>Propofol</strong>
            </td>
            <td style="padding: 8px; border: 1px solid #ccc;">
              <small>3–5 mg/kg</small>
            </td>
            <td style="padding: 8px; border: 1px solid #ccc; text-align: right;">
              <span id="propofol"></span>
              <span class="static unit">&nbsp;mg</span>
            </td>
          </tr>
          <tr style="background-color: #fff8cc;">
            <td colspan="3" style="padding: 8px; border: 1px solid #ccc; text-align: center;">
              <small id="propofol-ga-extra"></small>
            </td>
          </tr>

          <!-- Rocuronium GA -->
          <tr style="background-color: #ec6f73;">
            <td style="padding: 8px; border: 1px solid #ccc;">
              <strong>Rocuronium</strong>
            </td>
            <td style="padding: 8px; border: 1px solid #ccc;">
              <small>0.6 mg/kg</small>
            </td>
            <td style="padding: 8px; border: 1px solid #ccc; text-align: right;">
              <span id="rocuronium-ga"></span>
              <span class="static unit">&nbsp;mg</span>
            </td>
          </tr>
          <tr style="background-color: #ffdada;">
            <td colspan="3" style="padding: 8px; border: 1px solid #ccc; text-align: center;">
              <small id="rocuronium-ga-extra"></small>
            </td>
          </tr>

          <!-- Ondansetron GA -->
          <tr style="background-color: #fdd7a0;">
            <td style="padding: 8px; border: 1px solid #ccc;">
              <strong>Ondansetron</strong>
            </td>
            <td style="padding: 8px; border: 1px solid #ccc;">
              <small>0.15 mg/kg</small>
            </td>
            <td style="padding: 8px; border: 1px solid #ccc; text-align: right;">
              <span id="ondansetron"></span>
              <span class="static unit">&nbsp;mg</span>
            </td>
          </tr>
          <tr style="background-color: #fff3e0;">
            <td colspan="3" style="padding: 8px; border: 1px solid #ccc; text-align: center;">
              <small id="ondansetron-ga-extra"></small>
            </td>
          </tr>

          <!-- Dexamethasone GA -->
          <tr style="background-color: #ffffff;">
            <td style="padding: 8px; border: 1px solid #ccc;">
              <strong>Dexamethasone</strong>
            </td>
            <td style="padding: 8px; border: 1px solid #ccc;">
              <small>0.15 mg/kg</small>
            </td>
            <td style="padding: 8px; border: 1px solid #ccc; text-align: right;">
              <span id="dexamethasone"></span>
              <span class="static unit">&nbsp;mg</span>
            </td>
          </tr>
          <tr style="background-color: #f5f5f5;">
            <td colspan="3" style="padding: 8px; border: 1px solid #ccc; text-align: center;">
              <small id="dexamethasone-ga-extra"></small>
            </td>
          </tr>

          <tr style="background-color: #e0ffe0;">
  <td style="padding: 8px; border: 1px solid #ccc;">
    <strong>Paracetamol PO/IV</strong>
  </td>
  <td style="padding: 8px; border: 1px solid #ccc;">
    <small>Per age/weight</small>
  </td>
  <td style="padding: 8px; border: 1px solid #ccc; text-align: right;">
    <span id="paracetamol"></span><span class="static unit"> mg</span>
  </td>
</tr>
<tr style="background-color: #e6ffe6;">
  <td colspan="3" style="padding: 8px; border: 1px solid #ccc; text-align: center;">
    <small id="paracetamol-note"></small>
  </td>
</tr>

<!-- Ibuprofen IV -->
<tr style="background-color: #ffe0e0;">
  <td style="padding: 8px; border: 1px solid #ccc;">
    <strong>Ibuprofen IV</strong>
  </td>
  <td style="padding: 8px; border: 1px solid #ccc;">
    <small>Per age/weight</small>
  </td>
  <td style="padding: 8px; border: 1px solid #ccc; text-align: right;">
    <span id="ibuprofeniv"></span><span class="static unit"> mg</span>
  </td>
</tr>
<tr style="background-color: #ffe6e6;">
  <td colspan="3" style="padding: 8px; border: 1px solid #ccc; text-align: center;">
    <small id="ibuprofeniv-note"></small>
  </td>
</tr>

<!-- Ibuprofen PO -->
<tr style="background-color: #e0e0ff;">
  <td style="padding: 8px; border: 1px solid #ccc;">
    <strong>Ibuprofen PO</strong>
  </td>
  <td style="padding: 8px; border: 1px solid #ccc;">
    <small>5–10 mg/kg</small>
  </td>
  <td style="padding: 8px; border: 1px solid #ccc; text-align: right;">
    <span id="ibuprofenpo"></span><span class="static unit"> mg</span>
  </td>
</tr>
<tr style="background-color: #e6e6ff;">
  <td colspan="3" style="padding: 8px; border: 1px solid #ccc; text-align: center;">
    <small id="ibuprofenpo-note"></small>
  </td>
</tr>
        </table>
  </div>
  </div>
    </div>
  </div>
  
   <div class="button-container" style="text-align: center; margin-bottom: 20px;">
    <button type="button" class="reset-btn" onclick="resetForm()">Reset</button>
    <button type="button" class="home-btn" onclick="goHome()">Home</button>
  </div>
  
  <footer>
    <small>
      <p>SBP: Systolic blood pressure; HR: Heart rate; RR: Respiratory rate; ETT: Endotracheal tube; LMA: Laryngeal mask airway; RSI: Rapid sequence intubation</p>
      <p>
        <a href="references.html">References</a> - 
        <a href="disclaimer.html">Disclaimer</a>
      </p>
      <p>&copy; 2025 #OneTeam Anaesthesia. All rights reserved.</p>
    </small>
  </footer>

<script>
    function stripZeros(str) {
    return str
      .replace(/(\.\d*?[1-9])0+$/ , '$1')   // drop extra zeroes after a significant decimal
      .replace(/\.0+$/            , ''   );// drop ".0", ".00", etc.
  }
  
  let ageUnit = 'years';
  let autoEstimate = true;

  // grab your nodes once
  const ageInput = document.getElementById('age');
  const weightIn = document.getElementById('weight');
  const unitBtn  = document.getElementById('AgeUnitBtn');
  const estToggle = document.getElementById('EstimateToggle');
  const calcDiv  = document.getElementById('weight-calculations');

  // clear everything and hide all outputs
  function clearWeight() {
  // 1) remove any old small notes (EM, calc, analgesic)
  document
    .querySelectorAll('.calc-note, .analgesic-note, .analgesic-note--ibu, .analgesic-note--po, .airway-note')
    .forEach(el => el.remove());

    [
  'fentanyl-vol-extra',
  'ketamine-vol-extra',
  'rocuronium-vol-extra',
  'atropine-vol-extra',
  'adrenalineiv-vol-extra',
  'sux-iv-vol-extra',
  'sux-im-vol-extra'
].forEach(id => {
  const el = document.getElementById(id);
  if (el) el.textContent = '';
});
    
  // 2) clear the weight-calculation formulas
  calcDiv.innerHTML = '';
    
    [
    'fentanyl-ga-extra',
    'propofol-ga-extra',
    'rocuronium-ga-extra',
    'ondansetron-ga-extra',
    'dexamethasone-ga-extra'
  ].forEach(id => {
    const el = document.getElementById(id);
    if (el) el.textContent = '';
  });

  // 3) hide uncuffed/cuffed ETT
  ['ett-uncuffed','uncuffed-label','ett-or','ett-cuffed','cuffed-label']
    .forEach(id => {
      const el = document.getElementById(id);
      if (el) el.style.display = 'none';
    });

  // 4) clear laryngoscope
  const laryngoscopeEl = document.getElementById('laryngoscope');
  laryngoscopeEl.textContent = '';
  laryngoscopeEl.style.display = 'none';

  // 5) clear normal/airway numeric spans (just text)
  [
    'sbp-5','sbp-50','sbp-95',
    'hr-5','hr-95','rr-5','rr-95',
    'ett-uncuffed','ett-cuffed','ett-length',
    'lma','fentanyl','ketamine','rocuronium'
  ].forEach(id => {
    document.getElementById(id).textContent = '';
  });

  // 6) hide emergency drug values + units
  [
    'fentanyl','ketamine','rocuronium',
    'atropine','sux-iv','sux-im',
    'defib','adrenalineiv','fluidbolus','glucose10'
  ].forEach(id => {
    const el   = document.getElementById(id);
    const unit = el.nextElementSibling;
    el.textContent     = '';
    el.style.display   = 'none';
    if (unit && unit.classList.contains('unit')) {
      unit.style.display = 'none';
    }
  });
    
      // 7) hide the new “volume” spans (and their “mL” unit) in the table
  [
    'fentanyl-volume', 'ketamine-volume', 'rocuronium-volume',
    'atropine-volume', 'sux-iv-volume', 'sux-im-volume',
    'adrenalineiv-volume'
  ].forEach(id => {
    const volEl = document.getElementById(id);
    if (volEl) {
      volEl.textContent = '';
      volEl.style.display = 'none';
      const unitAfter = volEl.nextElementSibling;
      if (unitAfter && unitAfter.classList.contains('unit')) {
        unitAfter.style.display = 'none';
      }
    }
  });

  // 7) hide GA drug values + units
  [
    'propofol','fentanyl-ga','rocuronium-ga',
    'dexamethasone','ondansetron',
    'paracetamol','ibuprofeniv','ibuprofenpo'
  ].forEach(id => {
    const el   = document.getElementById(id);
    const unit = el.nextElementSibling;
    el.textContent     = '';
    el.style.display   = 'none';
    if (unit && unit.classList.contains('unit')) {
      unit.style.display = 'none';
    }
  });

  // 8) hide i-gel & tidal-volume
  const igelEl = document.getElementById('igel');
  igelEl.innerHTML = '';
  igelEl.style.display = 'none';

  const tvEl = document.getElementById('tidalvolume');
  tvEl.textContent = '';
  tvEl.style.display = 'none';

  // 9) hide the “cm” unit next to ETT length
  const lenUnit = document.querySelector('#ett-length + .unit');
  if (lenUnit) lenUnit.style.display = 'none';

  // 10) hide static text in normals
  document.querySelectorAll('.normal-values .static')
    .forEach(el => el.style.display = 'none');
}
  
  function updateAnalgesics(w) {
  // 1) Remove any old notes (<small class="analgesic-note*">) in the page
  document
    .querySelectorAll('.analgesic-note, .analgesic-note--ibu, .analgesic-note--po')
    .forEach(el => el.remove());

  // 2) Clear out the “-note” cells for Paracetamol & Ibuprofen IV/PO
  [
    'paracetamol-note',
    'ibuprofeniv-note',
    'ibuprofenpo-note'
  ].forEach(extraId => {
    const el = document.getElementById(extraId);
    if (el) el.textContent = '';
  });

  // — PARACETAMOL dosing & note —
  const pEl   = document.getElementById('paracetamol');
  const pUnit = pEl.nextElementSibling; // “ mg”
  let pDose, pNote;

  if (w > 0 && w <= 10) {
    pDose = 10 * w;
    const maxDailyLow = stripZeros((30 * w).toFixed(2));
    pNote = `10 mg/kg every 4–6 h; max 30 mg/kg/day = ${maxDailyLow} mg`;
  } else if (w <= 50) {
    pDose = 15 * w;
    const maxDailyHigh = stripZeros((60 * w).toFixed(2));
    pNote = `15 mg/kg every 4–6 h; max 60 mg/kg/day = ${maxDailyHigh} mg`;
  } else if (w > 50) {
    pDose = 1000;
    pNote = `1 g every 4–6 h; max 4 g/day`;
  } else {
    pDose = 0;
    pNote = '';
  }

  if (pDose > 0) {
    pEl.textContent   = stripZeros(pDose.toFixed(2));
    pEl.style.display = 'inline';
    if (pUnit) pUnit.style.display = 'inline';

    // Put the entire note into the <small id="paracetamol-note"> cell:
    const paracell = document.getElementById('paracetamol-note');
    paracell.innerHTML = `<em>${pNote}</em>`;
  } else {
    pEl.textContent   = '';
    pEl.style.display = 'none';
    if (pUnit) pUnit.style.display = 'none';
  }

  // — IBUPROFEN IV dosing & note —
  const iEl   = document.getElementById('ibuprofeniv');
  const iUnit = iEl.nextElementSibling; // “ mg”
  let ibuText = '', ibuNote = '';

  const rawAge = parseFloat(ageInput.value) || 0;
  const ageY   = ageUnit === 'months' ? rawAge/12 : rawAge;

  if (ageY < 6 || w < 20) {
    // Not recommended under 20 kg or below 6 years
    ibuNote = 'Not recommended for children under 20 kg or below 6 years of age.';
    ibuText = ''; 
  } else if (ageY < 18) {
    if (w <= 29) {
      ibuText = '200';
      ibuNote = '200 mg TDS, 6–8 h; max 600 mg/day';
    } else if (w <= 39) {
      ibuText = '200';
      ibuNote = '200 mg QDS, 6 h; max 800 mg/day';
    } else {
      ibuText = '200–400';
      ibuNote = '200–400 mg TDS, 6–8 h; max 1200 mg/day';
    }
  }

  if (ibuText) {
    iEl.textContent   = ibuText;
    iEl.style.display = 'inline';
    if (iUnit) iUnit.style.display = 'inline';
  } else {
    iEl.textContent   = '';
    iEl.style.display = 'none';
    if (iUnit) iUnit.style.display = 'none';
  }

  // Write the Ibuprofen IV note into its colspan cell:
  const ibuivCell = document.getElementById('ibuprofeniv-note');
  ibuivCell.innerHTML = ibuNote ? `<em>${ibuNote}</em>` : '';

  // — IBUPROFEN PO dosing & note —
  const poEl   = document.getElementById('ibuprofenpo');
  const poUnit = poEl.nextElementSibling; // “ mg”
  let poText = '', poNote = '';

  const ageMonths = ageUnit === 'months' ? rawAge : rawAge * 12;
  if (ageMonths > 3 && w > 0) {
    const dMin = Math.min(5 * w, 400);
    const dMax = Math.min(10 * w, 400);
    poText = `${dMin.toFixed(0)}–${dMax.toFixed(0)}`;
    poNote = 'Maximum 30 mg/kg/day in 3–4 divided doses';
  }

  if (poText) {
    poEl.textContent   = poText;
    poEl.style.display = 'inline';
    if (poUnit) poUnit.style.display = 'inline';
  } else {
    poEl.textContent   = '';
    poEl.style.display = 'none';
    if (poUnit) poUnit.style.display = 'none';
  }

  // Write the Ibuprofen PO note into its colspan cell:
  const ibupopc = document.getElementById('ibuprofenpo-note');
  ibupopc.innerHTML = poNote ? `<em>${poNote}</em>` : '';
}

  // toggle years ↔ months
  function toggleAgeUnit() {
    clearWeight();
    const raw = ageInput.value.trim();
    const n   = parseFloat(raw);
    if (ageUnit === 'years') {
      ageUnit = 'months';
      unitBtn.textContent = 'months';
      ageInput.value = raw!=='' && !isNaN(n) ? Math.round(n*12) : '';
    } else {
      ageUnit = 'years';
      unitBtn.textContent = 'years';
      ageInput.value = raw!=='' && !isNaN(n) ? Math.round((n/12)*10)/10 : '';
    }
  }

  function estimateWeight() {
  clearWeight();
  const a = parseFloat(ageInput.value);
  if (isNaN(a) || a < 0) {
    alert('Please enter a valid age.');
    return;
  }

  // ── SPECIAL CASE for exactly 0 months/years ──
  if (a === 0) {
  const w = 3.5;
  weightIn.value = w;
  calcDiv.innerHTML = `<p>Estimated weight for a neonate = ${w} <span class="unit">kg</span></p>`;

  if (autoEstimate) {                          // ← ADD this block
    const y = ageUnit === 'months' ? 0/12 : 0;
    const normals = getNormalValues(a, ageUnit);
    if (normals) updateNormalCentiles(normals);
    if (!isNaN(y)) updateAirwayCalculations(y);
    expandOpenAccordion();
  }
  return;
}

  const m = ageUnit === 'months' ? a : a * 12;
  
    if (m < 12) {
  const w     = 0.5 * m + 4;
  const wDisp = stripZeros(w.toFixed(2));
  weightIn.value  = wDisp;
  calcDiv.innerHTML =
    `<p>(0.5 × Age in months) + 4 = ${wDisp} <span class="unit">kg</span></p>`;

  if (autoEstimate) {                          // ← ADD this block
    const y = ageUnit === 'months' ? (a/12) : a;
    const normals = getNormalValues(a, ageUnit);
    if (normals) updateNormalCentiles(normals);
    if (!isNaN(y)) updateAirwayCalculations(y);
    expandOpenAccordion();
  }
  return;
}
    
  const y = m / 12;
if (y <= 14) {
  const w1 = Math.round((2 * y + 8) * 10) / 10;
  let html = `<p>(2 × Age) + 8 = ${w1} <span class="unit">kg</span></p>`;
  if (y >= 6) {
    const w2 = Math.round((3 * y + 7) * 10) / 10;
    html += `<p>(3 × Age) + 7 = ${w2} <span class="unit">kg</span></p>`;
  }
  weightIn.value = w1;
  calcDiv.innerHTML = html;

  if (autoEstimate) {                          // ← ADD this block
    const normals = getNormalValues(a, ageUnit);
    if (normals) updateNormalCentiles(normals);
    if (!isNaN(y)) updateAirwayCalculations(y);
    expandOpenAccordion();
  }
  return;
}
  }

  // paediatric normals table
  const paediatricNormals = {
    0:   { respRate:[25,50], heartRate:[120,170], bp:{p5:65, p50:85, p95:105} },
    1:   { respRate:[25,50], heartRate:[120,170], bp:{p5:65, p50:85, p95:105} },
    3:   { respRate:[25,45], heartRate:[115,160], bp:{p5:65, p50:85, p95:105} },
    6:   { respRate:[20,40], heartRate:[110,160], bp:{p5:65, p50:85, p95:105} },
    12:  { respRate:[20,40], heartRate:[110,160], bp:{p5:70, p50:90, p95:105} },
    18:  { respRate:[20,35], heartRate:[100,155], bp:{p5:70, p50:90, p95:105} },
    24:  { respRate:[20,30], heartRate:[100,150], bp:{p5:70, p50:90, p95:110} },
    36:  { respRate:[20,30], heartRate:[90,140],  bp:{p5:70, p50:90, p95:110} },
    48:  { respRate:[20,30], heartRate:[80,135],  bp:{p5:70, p50:90, p95:110} },
    60:  { respRate:[20,30], heartRate:[80,135],  bp:{p5:80, p50:95, p95:120} },
    72:  { respRate:[20,30], heartRate:[80,130],  bp:{p5:80, p50:95, p95:120} },
    84:  { respRate:[20,30], heartRate:[80,130],  bp:{p5:80, p50:95, p95:120} },
    96:  { respRate:[15,25], heartRate:[70,120],  bp:{p5:80, p50:95, p95:120} },
    108: { respRate:[15,25], heartRate:[70,120],  bp:{p5:80, p50:95, p95:120} },
    120: { respRate:[15,25], heartRate:[70,120],  bp:{p5:80, p50:95, p95:120} },
    132: { respRate:[15,25], heartRate:[70,120],  bp:{p5:80, p50:95, p95:120} },
    144: { respRate:[12,24], heartRate:[65,115],  bp:{p5:90, p50:110,p95:140} },
    168: { respRate:[12,24], heartRate:[60,110],  bp:{p5:90, p50:110,p95:140} }
  };

  // pick the nearest key
  function getNormalValues(age, unit) {
    const months = unit==='months'? age : age*12;
    const keys = Object.keys(paediatricNormals).map(k=>+k).sort((a,b)=>a-b);
    if (months < 12) {
      const mks = keys.filter(k=>k<12);
      return paediatricNormals[mks.reduce((a,b)=>Math.abs(b-months)<Math.abs(a-months)?b:a, mks[0])];
    } else {
      const ideal = Math.floor(months/12)*12;
      const below = keys.filter(k=>k<=ideal);
      const key   = below.length? below.pop() : keys.find(k=>k>=12);
      return paediatricNormals[key];
    }
  }

  // show centiles
  function updateNormalCentiles(n) {
    document.getElementById('sbp-5').textContent   = n.bp.p5;
    document.getElementById('sbp-50').textContent  = n.bp.p50;
    document.getElementById('sbp-95').textContent  = n.bp.p95;
    document.getElementById('hr-5').textContent    = n.heartRate[0];
    document.getElementById('hr-95').textContent   = n.heartRate[1];
    document.getElementById('rr-5').textContent    = n.respRate[0];
    document.getElementById('rr-95').textContent   = n.respRate[1];
    document.querySelectorAll('.normal-values .static')
      .forEach(el => el.style.display='inline');
  }

  // airway calcs (unchanged)
  function updateAirwayCalculations(ageYears) {
     document.querySelectorAll('.airway-note').forEach(el => el.remove());
    const w = parseFloat(weightIn.value)||0;
    const m = ageUnit==='months'? parseFloat(ageInput.value) : ageYears*12;
    let unc='', cuff='', len='';
    const uncEl  = document.getElementById('ett-uncuffed').parentElement;
    const cuffEl = document.getElementById('ett-cuffed').parentElement;
    const lenUnit= document.querySelector('#ett-length + .unit');

   if (isNaN(m) || m < 0) {
  // only hide if age is _negative_ or invalid
  uncEl.style.display    = 'none';
  cuffEl.style.display   = 'none';
  lenUnit && (lenUnit.style.display = 'none');
} else if (m < 12) {
      if(w<1) unc=2.5,len=6.5;
      else if(w<2) unc=3,len=7;
      else if(w<3) unc=3.5,len=8;
      else if(w<4) unc=3.5,len=9;
      else unc=4,len=10;
  cuff = unc - 0.5;
    } else {
       unc  = ageYears/4 + 4;
  cuff = ageYears/4 + 3.5;
  len  = ageYears/2 + 12;
    }
    
// use let so we can override cuffText
let uncText  = unc   ? stripZeros(unc.toFixed(2))   : '';
let cuffText = cuff  ? stripZeros(cuff.toFixed(2))  : '';
let lenText  = len   ? stripZeros(len.toFixed(2))   : '';

// only show uncuffed if under 3.5kg
if (w < 3.5) {
  cuffText = '';
}
    
// write into the DOM
const uncSpan   = document.getElementById('ett-uncuffed');
const uncLabel  = document.getElementById('uncuffed-label');
const cuffSpan  = document.getElementById('ett-cuffed');
const cuffLabel = document.getElementById('cuffed-label');
const orEl      = document.getElementById('ett-or');      // only declared here
const lenSpan   = document.getElementById('ett-length');

// write the values
uncSpan.textContent  = uncText;
cuffSpan.textContent = cuffText;
lenSpan .textContent = lenText;

// show/hide individual spans & labels
uncSpan .style.display = uncText  ? 'inline' : 'none';
uncLabel.style.display = uncText  ? 'inline' : 'none';
cuffSpan.style.display = cuffText ? 'inline' : 'none';
cuffLabel.style.display= cuffText ? 'inline' : 'none';
if (lenUnit) lenUnit.style.display = lenText ? 'inline' : 'none';

// only show the “or” if both uncuffed & cuffed are visible
orEl.style.display = (uncText && cuffText) ? 'inline' : 'none';
    
   if (m === 0) {
  // clear any old airway notes
  document.querySelectorAll('.airway-note').forEach(el => el.remove());

  // 1) size guidance
  let sizeNote = '';
  if (w < 1)        sizeNote = 'Size 2.5: For infants < 1 kg or < 28 weeks of gestational age';
  else if (w < 2)   sizeNote = 'Size 3.0: For infants 1–2 kg or 28–34 weeks of gestational age';
  else              sizeNote = 'Size 3.5: For infants > 2 kg or > 34 weeks of gestational age';

  uncEl.insertAdjacentHTML('afterend',
    `<p class="airway-note"><em>${sizeNote}</em></p>`
  );

  // 2) **new** insertion‐depth formula under the length line
  lenSpan.parentElement.insertAdjacentHTML('afterend',
    `<p class="airway-note"><em>Estimated depth of neonatal ET insertion = 1.17 × birth weight (kg) + 5.58; 7-8-9 rule</em></p>`
  );
}
    
    if (m >= 12) {
    // after the entire ETT‐size line:
    uncEl.insertAdjacentHTML('afterend',
      `<p class="airway-note"><em>Uncuffed ETT size = (Age/4) + 4; decrease by 0.5 for cuffed</em></p>`
    );
    // after the length‐at‐lips line:
    lenSpan.parentElement.insertAdjacentHTML('afterend',
      `<p class="airway-note"><em>(Age/2) + 12</em></p>`
    );
  }
    
    const igel = (w<=0||isNaN(w))? '' :
      w<=5?'1.0 <small>(Neonate, 2-5 kg)</small>':
      w<=10?'1.5 <small>(Infant, 5-12 kg)</small>':
      w<=25?'2.0 <small>(Small Paediatric, 10-25 kg)</small>':
      w<=35?'2.5 <small>(Large Paediatric, 25-35 kg)</small>':
      w<=60?'3.0 <small>(Small Adult, 30-60 kg)</small>':
      w<=90?'4.0 <small>(Medium Adult, 50-90kg)</small>':'<small>5.0 (Large Adult, ≥90 kg)</small>';
    
    // block for LMA sizing ---
  const lmaSize = (w <= 0 || isNaN(w)) ? '' :
    w <= 5   ? '1.0 <small>(<5kg)</small>'   :
    w <= 10  ? '1.5 <small>(5-10 kg)</small>' :
    w <= 20  ? '2.0 <small>(10-20 kg)</small>'   :
    w <= 30  ? '2.5 <small>(20-30 kg)</small>' :
    w <= 50  ? '3.0 <small>(30-50 kg)</small>'   :
    w <= 70  ? '4.0 <small>(50-70 kg)</small>'   :
    w <= 100 ? '5.0 <small>(70-100 kg)</small>'   :
               '';
   
    const igelEl = document.getElementById('igel');
if (igel) {
  igelEl.innerHTML    = igel;
  igelEl.style.display  = 'inline';
} else {
  igelEl.style.display  = 'none';
}
    
    const lmaEl = document.getElementById('lma');
  lmaEl.innerHTML = lmaSize;
  // show or hide the <div> around it
  lmaEl.parentElement.style.display = lmaSize ? 'block' : 'none';
    
    // tidal volume 6–8 ml/kg
 const tvEl = document.getElementById('tidalvolume');
if (w > 0 && !isNaN(w)) {
  const tvMin = Math.round(6 * w);
  const tvMax = Math.round(8 * w);
  tvEl.textContent      = `${tvMin} – ${tvMax} ml`;
  tvEl.style.display    = 'inline';
} else {
  tvEl.style.display    = 'none';
  
}
      // — LARYNGOSCOPE BLADE SIZING —
  const laryngoscopeEl      = document.getElementById('laryngoscope');
  
  if (w > 0) {
    let blade = '';
    if (w < 1.5)             blade = 'Miller 00 or 0 [Extremely preterm]';
    else if (w < 2.5)      blade = 'Mac 0 (Neonate) / Miller 0 [Preterm]';
    else if (w < 4)        blade = 'Mac 0 (Neonate) – 1 (Baby) / Miller 0-1';
    else if (w < 6)        blade = 'Mac 1 (Baby) / Miller 1 [1–6 months]';
    else if (w < 12)       blade = 'Mac 1 (Baby) – 2 (Child) / Miller 1–2 [6 months–2 years]';
    else if (w < 30)       blade = 'Mac 2 (Child) [2–10 years]';
    else if (w <= 60)      blade = 'Mac 3 (Adult) [10+ years]';
    else if (w > 60)      blade = 'Mac 3 / Mac 4 [Large Adult]';
   if (blade) {
  laryngoscopeEl.textContent = blade;
  laryngoscopeEl.style.display = 'inline';
} else {
  laryngoscopeEl.style.display = 'none';
}  
  }
     updateEmergencyDrugs(w);
    updateGADrugs(w);
    updateAnalgesics(w);
  }
  
function updateEmergencyDrugs(w) {
  // Helper that removes any old <em>…</em> from previous runs
  function clearOldLine(id) {
    const el = document.getElementById(id);
    if (el) {
      el.textContent = '';
    }
  }

  // 1) Clear out all “-vol-extra” <small> cells first
  [
    'fentanyl-vol-extra',
    'ketamine-vol-extra',
    'rocuronium-vol-extra',
    'atropine-vol-extra',
    'adrenalineiv-vol-extra',
    'sux-iv-vol-extra',
    'sux-im-vol-extra'
  ].forEach(clearOldLine);

  // 2) Grab all the numeric <span> elements for the emergency drugs
  const fentanylEl   = document.getElementById('fentanyl'),
        ketamineEl   = document.getElementById('ketamine'),
        rocuroniumEl = document.getElementById('rocuronium'),
        atropineEl   = document.getElementById('atropine'),
        suxIvEl      = document.getElementById('sux-iv'),
        suxImEl      = document.getElementById('sux-im'),
        defibEl      = document.getElementById('defib'),
        adrenalineEl = document.getElementById('adrenalineiv');

  // 3) Grab each “vol-extra” <small> placeholder
  const fentanylExtra   = document.getElementById('fentanyl-vol-extra'),
        ketamineExtra   = document.getElementById('ketamine-vol-extra'),
        rocuroniumExtra = document.getElementById('rocuronium-vol-extra'),
        atropineExtra   = document.getElementById('atropine-vol-extra'),
        adrenalineExtra = document.getElementById('adrenalineiv-vol-extra'),
        suxIvExtra      = document.getElementById('sux-iv-vol-extra'),
        suxImExtra      = document.getElementById('sux-im-vol-extra');

  if (w > 0 && !isNaN(w)) {
    // — FENTANYL: 1–2 mcg/kg @ 50 mcg/mL —
    const fMin     = 1   * w,                  // in mcg
          fMax     = 2   * w,                  // in mcg
          fVolMin  = (fMin   / 50).toFixed(2),  // in mL
          fVolMax  = (fMax   / 50).toFixed(2);  // in mL

    // Write the numeric dose (mcg) + unit
    fentanylEl.textContent   = `${stripZeros(fMin.toFixed(1))}–${stripZeros(fMax.toFixed(1))}`;
    fentanylEl.style.display = 'inline';
    fentanylEl.nextElementSibling.style.display = 'inline'; // “ mcg”

    // Put the “(X–Y mL of 50 mcg/mL)” inside <small id="fentanyl-vol-extra">
    fentanylExtra.innerHTML = `<em>${stripZeros(fVolMin)}–${stripZeros(fVolMax)} mL of 50 mcg/mL</em>`;

    // — KETAMINE: 1–2 mg/kg @ 10 mg/mL —
    const kMin     = 1   * w,                 // mg
          kMax     = 2   * w,                 // mg
          kVolMin  = (kMin   / 10).toFixed(2), // mL
          kVolMax  = (kMax   / 10).toFixed(2); // mL

    ketamineEl.textContent   = `${stripZeros(kMin.toFixed(1))}–${stripZeros(kMax.toFixed(1))}`;
    ketamineEl.style.display = 'inline';
    ketamineEl.nextElementSibling.style.display = 'inline'; // “ mg”

    ketamineExtra.innerHTML = `<em>${stripZeros(kVolMin)}–${stripZeros(kVolMax)} mL of 10 mg/mL</em>`;

    // — ROCURONIUM: 1 mg/kg @ 10 mg/mL —
    const rDose    = 1   * w,                 // mg
          rVol     = (rDose / 10).toFixed(2);  // mL

    rocuroniumEl.textContent   = stripZeros(rDose.toFixed(1));
    rocuroniumEl.style.display = 'inline';
    rocuroniumEl.nextElementSibling.style.display = 'inline'; // “ mg”

    rocuroniumExtra.innerHTML = `<em>${stripZeros(rVol)} mL of 10 mg/mL</em>`;

    // — ATROPINE: 20 mcg/kg @ 600 mcg/mL —
    const aDose    = 20  * w,                   // mcg
          aVol     = (aDose / 600).toFixed(2);    // mL

    atropineEl.textContent   = stripZeros(aDose.toFixed(1));
    atropineEl.style.display = 'inline';
    atropineEl.nextElementSibling.style.display = 'inline'; // “ mcg”

    atropineExtra.innerHTML = `<em>${stripZeros(aVol)} mL of 600 mcg/mL</em>`;

    // — SUXAMETHONIUM IV: 1–2 mg/kg @ 50 mg/mL —
    const sIVmin   = 1   * w,                // mg
          sIVmax   = 2   * w,                // mg
          ivVolMin = (sIVmin  / 50).toFixed(2), // mL
          ivVolMax = (sIVmax  / 50).toFixed(2); // mL

    suxIvEl.textContent   = `${stripZeros(sIVmin.toFixed(1))}–${stripZeros(sIVmax.toFixed(1))}`;
    suxIvEl.style.display = 'inline';
    suxIvEl.nextElementSibling.style.display = 'inline'; // “ mg”

    suxIvExtra.innerHTML = `<em>${stripZeros(ivVolMin)}–${stripZeros(ivVolMax)} mL of 50 mg/mL</em>`;

    // — SUXAMETHONIUM IM: 4 mg/kg (max 150 mg) @ 50 mg/mL —
    let imDose = 4 * w;
    if (imDose > 150) imDose = 150;
    const imVol = (imDose / 50).toFixed(2); // mL

    suxImEl.textContent   = stripZeros(imDose.toFixed(1));
    suxImEl.style.display = 'inline';
    suxImEl.nextElementSibling.style.display = 'inline'; // “ mg”

    suxImExtra.innerHTML = `<em>${stripZeros(imVol)} mL of 50 mg/mL</em>`;

    // — DEFIBRILLATION ENERGY 4 J/kg — (no “of X” needed; it’s joules)
    const defibDose = 4 * w; // J
    defibEl.textContent     = stripZeros(defibDose.toFixed(1));
    defibEl.style.display   = 'inline';
    defibEl.nextElementSibling.style.display = 'inline'; // “ J”

    // — ADRENALINE IV 1:10,000 is 0.1 mg/mL; dose = 0.1 mL/kg × w —
    const adrVol = (0.1 * w).toFixed(2), // mL
          adrMg  = (adrVol * 0.1).toFixed(2); // mg

    adrenalineEl.textContent   = stripZeros(adrVol); 
    adrenalineEl.style.display = 'inline';
    adrenalineEl.nextElementSibling.style.display = 'inline'; // “ mL”

    adrenalineExtra.innerHTML = `<em>${stripZeros(adrVol)} mL of 0.1 mg/mL</em>`;

// — FLUID BOLUS 10–20 mL/kg —
    const bolusEl   = document.getElementById('fluidbolus'),
          bolusUnit = bolusEl.nextElementSibling; // “ mL”
    const bolusMin  = Math.round(10 * w),
          bolusMax  = Math.round(20 * w);

    bolusEl.textContent    = `${bolusMin}–${bolusMax}`;
    bolusEl.style.display  = 'inline';
    if (bolusUnit && bolusUnit.classList.contains('unit')) {
      bolusUnit.style.display = 'inline';
    }

    // — GLUCOSE 10% 2 mL/kg —
    const glucoseEl   = document.getElementById('glucose10'),
          glucoseUnit = glucoseEl.nextElementSibling; // “ mL”
    const gluDose     = stripZeros((2 * w).toFixed(1));

    glucoseEl.textContent    = gluDose;
    glucoseEl.style.display  = 'inline';
    if (glucoseUnit && glucoseUnit.classList.contains('unit')) {
      glucoseUnit.style.display = 'inline';
    }
  }
  else {
    // hide fentanyl/ketamine/etc.
    [fentanylEl, ketamineEl, rocuroniumEl,
     atropineEl, suxIvEl, suxImEl,
     defibEl, adrenalineEl].forEach(el => {
      el.style.display = 'none';
      const unitSpan = el.nextElementSibling;
      if (unitSpan && unitSpan.classList.contains('unit')) {
        unitSpan.style.display = 'none';
      }
    });
    // clear all “-vol-extra” text
    [fentanylExtra, ketamineExtra, rocuroniumExtra,
     atropineExtra, adrenalineExtra, suxIvExtra, suxImExtra]
      .forEach(clearOldLine);

    // hide bolus/glucose
    const bolusEl   = document.getElementById('fluidbolus'),
          bolusUnit = bolusEl.nextElementSibling;
    bolusEl.style.display = 'none';
    if (bolusUnit && bolusUnit.classList.contains('unit')) {
      bolusUnit.style.display = 'none';
    }

    const glucoseEl   = document.getElementById('glucose10'),
          glucoseUnit = glucoseEl.nextElementSibling;
    glucoseEl.style.display = 'none';
    if (glucoseUnit && glucoseUnit.classList.contains('unit')) {
      glucoseUnit.style.display = 'none';
    }
  }
}
  
    function updateGADrugs(w) {
  // 1) first, clear out any old “extra” notes
  [
    'fentanyl-ga-extra',
    'propofol-ga-extra',
    'rocuronium-ga-extra',
    'ondansetron-ga-extra',
    'dexamethasone-ga-extra'
  ].forEach(extraId => {
    const el = document.getElementById(extraId);
    if (el) el.textContent = '';
  });

  // 2) list of GA drugs + their dosing/concentration info
  const drugs = [
    { 
      id:           'fentanyl-ga',
      minDose:      1,    // mcg/kg
      maxDose:      2,    // mcg/kg
      conc:         50,   // mcg per mL
      unitLabel:    'mcg',
      extraId:      'fentanyl-ga-extra'
    },
    {
      id:           'propofol',
      minDose:      3,    // mg/kg
      maxDose:      5,    // mg/kg
      conc:         10,   // mg per mL
      unitLabel:    'mg',
      extraId:      'propofol-ga-extra'
    },
    {
      id:           'rocuronium-ga',
      minDose:      0.6,  // mg/kg  (single‐value)
      maxDose:      0.6,  // same
      conc:         10,   // mg per mL
      unitLabel:    'mg',
      extraId:      'rocuronium-ga-extra'
    },
    {
      id:           'ondansetron',
      minDose:      0.15, // mg/kg
      maxDose:      0.15, // same
      conc:         2,    // mg per mL
      unitLabel:    'mg',
      extraId:      'ondansetron-ga-extra'
    },
    {
      id:           'dexamethasone',
      minDose:      0.15, // mg/kg
      maxDose:      0.15, // same
      conc:         3.3,  // mg per mL
      unitLabel:    'mg',
      extraId:      'dexamethasone-ga-extra'
    }
  ];

  // 3) if w > 0, populate each dose AND its colspan-3 “extra” cell
  if (w > 0 && !isNaN(w)) {
    drugs.forEach(({ id, minDose, maxDose, conc, unitLabel, extraId }) => {
      // a) compute dose text
      const dMin    = stripZeros((minDose * w).toFixed(1));
      const dMax    = stripZeros((maxDose * w).toFixed(1));
      const doseText = (minDose === maxDose) ? dMin : `${dMin}–${dMax}`;

      // b) write dose into the <span id="…"> and show its unit
      const spanEl  = document.getElementById(id);
      const unitSpan= spanEl.nextElementSibling; // the “ mg” or “ mcg”
      spanEl.textContent       = doseText;
      spanEl.style.display     = 'inline';
      if (unitSpan && unitSpan.classList.contains('unit')) {
        unitSpan.style.display = 'inline';
      }

      // c) compute volume (ml) text
      //    if min === max, single value; otherwise “X–Y”
      const vMin    = stripZeros((dMin / conc).toFixed(2));
      const vMax    = stripZeros((dMax / conc).toFixed(2));
      const volText = (minDose === maxDose) ? `${vMin}` : `${vMin}–${vMax}`;

      // d) write into the colspan-3 <small id="…-extra">
      const extraEl = document.getElementById(extraId);
      extraEl.innerHTML = `<em>${volText} mL of ${conc}${unitLabel}/mL</em>`;
    });
  }
  else {
    // 4) if no valid weight, hide all dose spans + units, leave extras blank
    drugs.forEach(({ id, extraId }) => {
      const spanEl = document.getElementById(id);
      spanEl.style.display = 'none';
      const unitSpan = spanEl.nextElementSibling;
      if (unitSpan && unitSpan.classList.contains('unit')) {
        unitSpan.style.display = 'none';
      }
      // extra cell was already cleared at top
    });
  }
}

  // event wiring
  unitBtn.addEventListener('click', toggleAgeUnit);
  
 estToggle.addEventListener('change', () => {
   autoEstimate = estToggle.checked;

   if (autoEstimate) {
     weightIn.disabled = true;
     // Immediately estimate (if age is valid)
     const n = parseFloat(ageInput.value);
     if (!isNaN(n) && n >= 0) {
       estimateWeight();
     }
   } else {
     weightIn.disabled = false;
     // Do not clear existing outputs; user can manually type weight
   }
 });

 ageInput.addEventListener('input', () => {
  const rawAge = ageInput.value.trim();
  const rawW   = weightIn.value.trim();

    if (autoEstimate) {                            // ← ADD this entire if‐block
    const n = parseFloat(rawAge);
    if (!isNaN(n) && n >= 0) {
      estimateWeight();
    } else {
      clearWeight();
    }
    return;
  }
   
  // ── If age is entered but weight is blank → clear everything and stop ──
  if (rawAge !== '' && rawW === '') {
    return clearWeight();
  }

  // ── If both age and weight are blank → clear everything and stop ──
  if (rawAge === '' && rawW === '') {
    return clearWeight();
  }

  // At this point: either both age & weight exist, or weight exists and age blank.

  // Parse age
  const a = parseFloat(rawAge);
  if (isNaN(a)) {
    return clearWeight();
  }

  // Convert age to “years” for airway/centiles
  const y = (ageUnit === 'months') ? (a / 12) : a;

  updateAirwayCalculations(y);

  const normals = getNormalValues(a, ageUnit);
  if (normals) {
    updateNormalCentiles(normals);
  }

  expandOpenAccordion();
});

  weightIn.addEventListener('input', () => {
     if (autoEstimate) {                            // ← ADD this line
    return;                                      // ← ADD: do nothing if Auto is ON
  }
    
    // 1) if no age has been entered, treat it as zero
  // ── NEW: if no age entered, assume age = 0 only if weight < 5kg ──
  const rawAge = ageInput.value.trim();
  const rawW   = weightIn.value.trim();

  if (rawW === '') {
    // if weight is blank, nothing to show
    return clearWeight();
  }

  // parse weight now that we know it's non‐blank
  const w = parseFloat(rawW);
  if (isNaN(w)) {
    return clearWeight();
  }

  if (rawAge === '') {
    // age was blank: only proceed if weight < 5 kg
    if (w < 5) {
      ageInput.value = '0';      // ← assume neonate
    } else {
      // if weight ≥ 5kg and no age → show nothing
      return clearWeight();
    }
  }
    const a    = parseFloat(ageInput.value),
      wnum = parseFloat(weightIn.value);
    if(isNaN(a)||isNaN(w)) return clearWeight();
    const y = ageUnit==='months'? a/12 : a;
    updateAirwayCalculations(y);
    const normals = getNormalValues(a, ageUnit);
    if(normals) updateNormalCentiles(normals);

    let disp = '', m = ageUnit==='months'? a : a*12;
    if(m<12) {
      const e = 0.5*m+4;
      if(Math.abs(e-w)<0.2) disp = `<p>(0.5 × Age in months) + 4 = ${stripZeros(w.toFixed(1))} <span class="unit">kg</span></p>`;
    } else {
      const e1 = 2*y+8;
      if(Math.abs(e1-w)<0.2) disp = `<p>(2 × Age) + 8 = ${stripZeros(w.toFixed(1))} <span class="unit">kg</span></p>`;
      else if(y>=6) {
        const e2 = 3*y+7;
        if(Math.abs(e2-w)<0.2) disp = `<p>(3 × Age) + 7 = ${stripZeros(w.toFixed(1))} <span class="unit">kg</span></p>`;
      }
    }
    calcDiv.innerHTML = disp;
     expandOpenAccordion();
  });

  document.addEventListener('DOMContentLoaded', () => {
  clearWeight();
  weightIn.disabled = true;          // ← ADD: make sure weight is editable by default
  estToggle.checked = true;    // ← ADD: initial button text
});
  
  // Reset everything back to the initial state
function resetForm() {
  // 1) clear the inputs
  ageInput.value = '';
  weightIn.value = '';
  // 2) reset the toggle back to years
  ageUnit = 'years';
  unitBtn.textContent = 'years';
  // 3) hide all existing outputs
  clearWeight();
  
// 4) collapse any open accordion panels
  document.querySelectorAll('.accordion-header.active').forEach(header => {
    header.classList.remove('active');
    const content = header.nextElementSibling; // the .accordion-content
    content.classList.remove('show');
    content.style.maxHeight = null;
  });
  
}

// Optional: home button handler if you want
function goHome() {
  window.location.href = '/'; // or 'index.html'
}
  
  document.querySelectorAll('.accordion-header').forEach(header => {

    header.addEventListener('click', () => {

      const content = header.nextElementSibling;

      const isOpen = content.classList.contains('show');

      header.classList.toggle('active');

      content.classList.toggle('show');

      // Remove inline max-height after animation for better reset

      if (!isOpen) {

        content.style.maxHeight = content.scrollHeight + "px";

      } else {

        content.style.maxHeight = null;

      }

    });

  });

function expandOpenAccordion() {
  const openContent = document.querySelector('.accordion-content.show');
  if (!openContent) return;
  // reset so browser re-measures
  openContent.style.maxHeight = null;
  // then set to new height
  openContent.style.maxHeight = openContent.scrollHeight + 'px';
}
  
</script>

</body>
</html>
